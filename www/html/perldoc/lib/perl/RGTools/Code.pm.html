<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Code.pm</title>
<link rev="made" href="mailto:root@localhost" />
</head>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #F0F0F0;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
<body style="background-color: white">
<a name="-top-"></a>
<h1>Code.pm</h1>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name__uplink_">NAME &lt;UPLINK&gt;</a></li>
	<li><a href="#synopsis__uplink_">SYNOPSIS &lt;UPLINK&gt;</a></li>
	<li><a href="#description__uplink_">DESCRIPTION &lt;UPLINK&gt;</a></li>
	<li><a href="#known_issues__uplink_">KNOWN ISSUES &lt;UPLINK&gt;</a></li>
	<li><a href="#future_improvements__uplink_">FUTURE IMPROVEMENTS &lt;UPLINK&gt;</a></li>
	<li><a href="#authors__uplink_">AUTHORS &lt;UPLINK&gt;</a></li>
	<li><a href="#created__uplink_">CREATED &lt;UPLINK&gt;</a></li>
	<li><a href="#revision__uplink_">REVISION &lt;UPLINK&gt;</a></li>
	<li><a href="#known_issues__uplink_">KNOWN ISSUES &lt;UPLINK&gt;</a></li>
	<li><a href="#future_improvements__uplink_">FUTURE IMPROVEMENTS &lt;UPLINK&gt;</a></li>
	<li><a href="#authors__uplink_">AUTHORS &lt;UPLINK&gt;</a></li>
	<li><a href="#created__uplink_">CREATED &lt;UPLINK&gt;</a></li>
	<li><a href="#revision__uplink_">REVISION &lt;UPLINK&gt;</a></li>
</ul>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-Code-">package Code</a>
<ul>
<li><a href="#new-">new</a></li>
<li><a href="#load_code-">load_code</a></li>
<li><a href="#description-">description</a></li>
<li><a href="#define_custom_modules-">define_custom_modules</a></li>
<li><a href="#parse_perldoc-">parse_perldoc</a></li>
<li><a href="#get_attributes-">get_attributes</a></li>
<li><a href="#get_methods-">get_methods</a></li>
<li><a href="#get_blocks-">get_blocks</a></li>
<li><a href="#parse_blocks-">parse_blocks</a></li>
<li><a href="#parse_sub-">parse_sub</a></li>
<li><a href="#get_sub_name-">get_sub_name</a></li>
<li><a href="#get_sub_description_and_code_snip-">get_sub_description_and_code_snip</a></li>
<li><a href="#get_sub_type-">get_sub_type</a></li>
<li><a href="#get_sub_arguments-">get_sub_arguments</a></li>
<li><a href="#parse_non_sub-">parse_non_sub</a></li>
<li><a href="#get_perl_interpreter-">get_perl_interpreter</a></li>
<li><a href="#build_perldoc_header_and_footer-">build_perldoc_header_and_footer</a></li>
<li><a href="#get_package_definition-">get_package_definition</a></li>
<li><a href="#get_system_variables-">get_system_variables</a></li>
<li><a href="#get_superclasses-">get_superclasses</a></li>
<li><a href="#get_modules_ref-">get_modules_ref</a></li>
<li><a href="#get_global_vars-">get_global_vars</a></li>
<li><a href="#get_modular_vars_and_constants-">get_modular_vars_and_constants</a></li>
<li><a href="#get_main-">get_main</a></li>
<li><a href="#get_comments-">get_comments</a></li>
<li><a href="#generate_code-">generate_code</a></li>
<li><a href="#generate_perldoc-">generate_perldoc</a></li>
<li><a href="#save_code-">save_code</a></li>
<li><a href="#_get_attributes-">_get_attributes</a></li>
<li><a href="#_section_label-">_section_label</a></li>
</ul>
</li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<hr />
<pre><span class="c">################################################################################</span>
<span class="c"># Code.pm</span>
<span class="c">#</span>
<span class="c"># This object represents a Perl source code.  It has the ability to insert Perldoc and re-organize a source file.</span>
<span class="c">#</span>
<span class="c">###################################################################################################################################</span>
<span class="c"># $Id: Code.pm,v 1.36 2004/08/27 18:26:55 rguin Exp $</span>
<span class="c">###################################################################################################################################</span>
<a name="package-Code-"></a><span class="k">package </span><span class="i">Code</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># perldoc_header             #</span>
<span class="c">##############################</span>

</pre><p></p>
<hr />
<h1><a name="name__uplink_">NAME &lt;UPLINK&gt;</a></h1>
<p>Code.pm - This object represents a Perl source code.  It has the ability to insert Perldoc and re-organize a source file.</p>
<p>
</p>
<hr />
<h1><a name="synopsis__uplink_">SYNOPSIS &lt;UPLINK&gt;</a></h1>
<pre>
 my $code = Code-&gt;new('Code.pm');   # Create a new Code object with the specified source
 $code-&gt;define_custom_modules(-dirs=&gt;['alDente','SDB','RGTools']); #Define custom modules
 $code-&gt;generate_code(-perldoc=&gt;2); # Generate the code (insert perldoc and re-organize)
 $code-&gt;save_code(-overwrite=&gt;1);   # Save the generated code</pre>
<p>
</p>
<hr />
<h1><a name="description__uplink_">DESCRIPTION &lt;UPLINK&gt;</a></h1>
This object represents a Perl source code.  It has the ability to insert Perldoc and re-organize a source file.<BR><pre>
<span class="c">##############################</span>
<span class="c"># superclasses               #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># system_variables           #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># standard_modules_ref       #</span>
<span class="c">##############################</span>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Data::Dumper</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Cwd</span> <span class="q">'abs_path'</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># custom_modules_ref         #</span>
<span class="c">##############################</span>
<span class="k">use</span> <span class="w">RGTools::RGIO</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># global_vars                #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># modular_vars               #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># constants                  #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># main_header                #</span>
<span class="c">##############################</span>
<span class="k">my</span> <span class="i">$file</span><span class="sc">;</span>
<span class="k">my</span> <span class="i">%Referenced</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># constructor                #</span>
<span class="c">##############################</span>

<span class="c">#</span>
<span class="c"># Adjust input to separately specify directory and file name...</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">##########</span>
<a name="new-"></a><span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
<span class="c">##########</span>
    <span class="k">my</span> <span class="i">$this</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$file</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$dir</span>  = <span class="i">$args</span>{-<span class="w">dir</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$ext</span>  = <span class="i">$args</span>{-<span class="w">ext</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$name</span> = <span class="i">$args</span>{-<span class="w">filename</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span><span class="i">$class</span><span class="s">)</span> = <span class="k">ref</span><span class="s">(</span><span class="i">$this</span><span class="s">)</span> || <span class="i">$this</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">dir</span>} = <span class="i">$dir</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">ext</span>} = <span class="i">$ext</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$name</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$name</span> =~ <span class="q">/(.*)\.(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">name</span>} = <span class="i">$1</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">ext</span>}  = <span class="i">$2</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">name</span>} = <span class="i">$name</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">ext</span>}  = <span class="q">''</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$file</span> =~ <span class="q">/(.*\/)(.*)\.(.*)/</span> <span class="s">)</span> <span class="s">{</span>

        <span class="i">$self</span>-&gt;{<span class="w">dir</span>}         = <span class="i">abs_path</span><span class="s">(</span><span class="i">$1</span><span class="s">)</span> . <span class="q">&quot;/&quot;</span><span class="sc">;</span>    <span class="c">#Dir of the code [String]</span>
        <span class="i">$self</span>-&gt;{<span class="w">name</span>}        = <span class="q">&quot;$2.$3&quot;</span><span class="sc">;</span>               <span class="c">#Name of the file [String]</span>
        <span class="i">$self</span>-&gt;{<span class="w">module_name</span>} = <span class="i">$2</span><span class="sc">;</span>                    <span class="c">#Name of module [String]</span>
        <span class="i">$self</span>-&gt;{<span class="w">ext</span>}         = <span class="i">$3</span><span class="sc">;</span>                    <span class="c">#Extension of the code [String]</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">print</span> <span class="q">&quot;Error Undefined file\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">fullname</span>}          = <span class="q">&quot;$self-&gt;{dir}$self-&gt;{name}&quot;</span><span class="sc">;</span>    <span class="c">#The full name of the file including dir [String]</span>
    <span class="i">$self</span>-&gt;{<span class="w">brief_description</span>} = <span class="q">''</span><span class="sc">;</span>                             <span class="c">#A brief description of the code (i.e. the first line of the description found at the top of the file) [String]</span>
    <span class="i">$self</span>-&gt;{<span class="w">description</span>}       = <span class="q">''</span><span class="sc">;</span>                             <span class="c">#The description of code at the top of the file.</span>

    <span class="i">$self</span>-&gt;{<span class="w">code</span>}           = <span class="q">''</span><span class="sc">;</span>                                <span class="c">#The entire source code read from the source file [without the perldoc String]</span>
    <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}        = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                                <span class="c">#The current perldoc of the source file</span>
    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} = <span class="q">''</span><span class="sc">;</span>                                <span class="c">#The entire source code regenerated by this script [String]</span>

    <span class="i">$self</span>-&gt;{<span class="w">perl_interpreter</span>}   = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                            <span class="c">#Perl interpreter [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">package_definition</span>} = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                            <span class="c">#Package definition [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}       = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                            <span class="c">#Superclasses as in the @ISA array [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">perldoc_header</span>}     = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                            <span class="c">#Perldoc header [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}     = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                            <span class="c">#Perldoc footer [Hash]</span>

    <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>} = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#References to Perl modules [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}   = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#References to custom modules [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">custom_modules</span>}       = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#Define custom modules [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}          = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#Global variables used [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}         = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#Modular level variables [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">constants</span>}            = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#Constants used [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">main_header</span>}          = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#Main body header of the code [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">main_footer</span>}          = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#Main body footer of the code [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}           = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                          <span class="c">#All the attributes of the class [Hash]</span>

    <span class="i">$self</span>-&gt;{<span class="w">constructor</span>}       = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                             <span class="c">#Constructor of the class [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">public_methods</span>}    = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                             <span class="c">#Public methods of the class [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">public_functions</span>}  = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                             <span class="c">#Public functions of the class [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">private_methods</span>}   = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                             <span class="c">#Private methods of the class [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">private_functions</span>} = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                             <span class="c">#Private functions of the class [Hash]</span>

    <span class="i">$self</span>-&gt;{<span class="w">sections_order</span>} = <span class="s">[</span>
        <span class="q">'perl_interpreter'</span><span class="cm">,</span> <span class="q">'package_definition'</span><span class="cm">,</span> <span class="q">'perldoc_header'</span><span class="cm">,</span> <span class="q">'superclasses'</span><span class="cm">,</span>     <span class="q">'system_variables'</span><span class="cm">,</span> <span class="q">'standard_modules_ref'</span><span class="cm">,</span> <span class="q">'custom_modules_ref'</span><span class="cm">,</span> <span class="q">'global_vars'</span><span class="cm">,</span> <span class="q">'modular_vars'</span><span class="cm">,</span> <span class="q">'constants'</span><span class="cm">,</span>
        <span class="q">'main_header'</span><span class="cm">,</span>      <span class="q">'constructor'</span><span class="cm">,</span>        <span class="q">'public_methods'</span><span class="cm">,</span> <span class="q">'public_functions'</span><span class="cm">,</span> <span class="q">'private_methods'</span><span class="cm">,</span>  <span class="q">'private_functions'</span><span class="cm">,</span>    <span class="q">'main_footer'</span><span class="cm">,</span>        <span class="q">'perldoc_footer'</span>
    <span class="s">]</span><span class="sc">;</span>                                                           <span class="c">#The order of sections to be appeared in the code. [ArrayRef]</span>

    <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}  = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                                       <span class="c"># Blocks of the code [Hash]</span>
    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>} = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>                                       <span class="c"># Index hash of various properties [Hash]</span>

    <span class="k">bless</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$class</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">name</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span><span class="i">-&gt;load_code</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">fullname</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$self</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># public_methods             #</span>
<span class="c">##############################</span>

<span class="c">#####################################################################</span>
<a name="load_code-"></a><span class="k">sub </span><span class="m">load_code</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Loads the code from the file</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">-f</span> <span class="i">$self</span>-&gt;{<span class="w">fullname</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">open</span><span class="s">(</span> <span class="w">FILE</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">fullname</span>} <span class="s">)</span> || <span class="k">die</span><span class="s">(</span><span class="q">&quot;Cannot open $self-&gt;{fullname}&quot;</span><span class="s">)</span><span class="sc">;</span>

        <span class="k">my</span> <span class="i">$inside_perldoc</span>        = <span class="n">0</span><span class="sc">;</span>    <span class="c">#Flag to indicate whether we are inside a Perldoc section or not</span>
        <span class="k">my</span> <span class="i">$non_comments_found</span>    = <span class="n">0</span><span class="sc">;</span>    <span class="c">#Flag to indicate whether a non-comments line is found.</span>
        <span class="k">my</span> <span class="i">$desc_first_line_found</span> = <span class="n">0</span><span class="sc">;</span>    <span class="c">#Flag to indicate whether the first line of description is found.</span>
        <span class="k">while</span> <span class="s">(</span><span class="q">&lt;FILE&gt;</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$line</span> = <span class="i">$_</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^=cut/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$line</span><span class="sc">;</span>
                <span class="i">$inside_perldoc</span> = <span class="n">0</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^=/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$line</span><span class="sc">;</span>
                <span class="i">$inside_perldoc</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">elsif</span> <span class="s">(</span><span class="i">$inside_perldoc</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$line</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">code</span>} .= <span class="i">$line</span><span class="sc">;</span>
                <span class="k">unless</span> <span class="s">(</span><span class="i">$non_comments_found</span><span class="s">)</span> <span class="s">{</span>
                    <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#+(.*)/</span> <span class="s">)</span> <span class="s">{</span>
                        <span class="k">my</span> <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                        <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/\S/</span> &amp;&amp; <span class="i">$desc</span> !~ <span class="q">/^\s*$self-&gt;{module_name}(?:\.$self-&gt;{ext})*\s*\#*\s*$/i</span> &amp;&amp; <span class="i">$desc</span> !~ <span class="q">/\$Id.*Exp\s*\$/i</span> &amp;&amp; <span class="i">$desc</span> !~ <span class="q">/CVS.*\$Revision.*\$/i</span> &amp;&amp; <span class="i">$desc</span> !~ <span class="q">/CVS.*\$Date.*\$/i</span> <span class="s">)</span> <span class="s">{</span>
                            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)\s*$/$1/</span><span class="sc">;</span>    <span class="c">#Get rid of leading and trailing spaces</span>
                            <span class="i">$self</span>-&gt;{<span class="w">description</span>} .= <span class="q">&quot;$desc\n&quot;</span><span class="sc">;</span>
                            <span class="k">unless</span> <span class="s">(</span><span class="i">$desc_first_line_found</span><span class="s">)</span> <span class="s">{</span>
                                <span class="i">$self</span>-&gt;{<span class="w">brief_description</span>} .= <span class="q">&quot;$desc\n&quot;</span><span class="sc">;</span>    <span class="c">#Get the first line of the description be the brief description</span>
                                <span class="i">$desc_first_line_found</span> = <span class="n">1</span><span class="sc">;</span>
                            <span class="s">}</span>
                        <span class="s">}</span>
                    <span class="s">}</span>
                    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*[^\#]/</span> &amp;&amp; <span class="i">$line</span> !~ <span class="q">/^\s*$/</span> <span class="s">)</span> <span class="s">{</span>
                        <span class="i">$non_comments_found</span> = <span class="n">1</span><span class="sc">;</span>
                    <span class="s">}</span>
                <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>

        <span class="k">close</span><span class="s">(</span><span class="w">FILE</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$section</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">sections_order</span>} } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$section_label</span> = <span class="i">_section_label</span><span class="s">(</span><span class="i">$section</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">code</span>} =~ <span class="q">s/$section_label//g</span><span class="sc">;</span>    <span class="c">### remove previously generated section labels.</span>
    <span class="s">}</span>

    <span class="k">return</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Access description of code if it exists...</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">###############</span>
<a name="description-"></a><span class="k">sub </span><span class="m">description</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$verbose</span> = <span class="i">$args</span>{-<span class="w">verbose</span>}<span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$verbose</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">description</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">brief_description</span>}<span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="define_custom_modules-"></a><span class="k">sub </span><span class="m">define_custom_modules</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Defines what custom modules are</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$dirs_ref</span>  = <span class="i">$args</span>{-<span class="w">dirs</span>}<span class="sc">;</span>     <span class="c"># Define custom modules by directories [ArrayRef]</span>
    <span class="k">my</span> <span class="i">$files_ref</span> = <span class="i">$args</span>{-<span class="w">files</span>}<span class="sc">;</span>    <span class="c"># Define custom modules by files [ArrayRef]</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$dir</span> <span class="s">(</span> <span class="i">@</span>{<span class="i">$dirs_ref</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">custom_modules</span>}-&gt;{<span class="w">dirs</span>}-&gt;{<span class="i">$dir</span>} = <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$file</span> <span class="s">(</span> <span class="i">@</span>{<span class="i">$files_ref</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">custom_modules</span>}-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$file</span>} = <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="parse_perldoc-"></a><span class="k">sub </span><span class="m">parse_perldoc</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Parse the =head1 sections of the current perldoc into a hash</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$current_command</span> = <span class="q">''</span><span class="sc">;</span>    <span class="c"># Stores the current perldoc command</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">code</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^=head1\s+([A-Z\s_]+).*/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$command</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="i">$command</span> =~ <span class="q">s/(.*)\s+$/$1/</span><span class="sc">;</span>    <span class="c">#Get rid of trailing space.</span>
            <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="i">$command</span>} .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$current_command</span> = <span class="i">$command</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^=/</span> <span class="s">)</span> <span class="s">{</span>          <span class="c">#Any perldoc commands not starting with '=head1'</span>
            <span class="i">$current_command</span> = <span class="q">''</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span><span class="i">$current_command</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="i">$current_command</span>} .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span> <span class="s">}</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#################</span>
<a name="get_attributes-"></a><span class="k">sub </span><span class="m">get_attributes</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$verbose</span> = <span class="i">$args</span>{<span class="q">'-verbose'</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$format</span> = <span class="i">$args</span>{<span class="q">'-format'</span>} || <span class="q">'text'</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@attributes</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">attributes</span>} }<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$verbose</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@details</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$attribute</span> <span class="s">(</span><span class="i">@attributes</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$format</span> =~ <span class="q">/html/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">push</span><span class="s">(</span> <span class="i">@details</span><span class="cm">,</span> <span class="q">&quot;&lt;B&gt;$attribute&lt;/B&gt;&lt;P&gt;&quot;</span> . <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$attribute</span>}-&gt;{<span class="w">description</span>} <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">push</span><span class="s">(</span> <span class="i">@details</span><span class="cm">,</span> <span class="q">&quot;$attribute\n*****\n&quot;</span> . <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$attribute</span>}-&gt;{<span class="w">description</span>} . <span class="q">&quot;\n&quot;</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">return</span> \<span class="i">@details</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> \<span class="i">@attributes</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############</span>
<a name="get_methods-"></a><span class="k">sub </span><span class="m">get_methods</span> <span class="s">{</span>
<span class="c">##############</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$verbose</span> = <span class="i">$args</span>{-<span class="w">verbose</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$format</span> = <span class="i">$args</span>{<span class="q">'-format'</span>} || <span class="q">'text'</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@methods</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">public_methods</span>} }<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$verbose</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@details</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$method</span> <span class="s">(</span><span class="i">@methods</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$code</span> = <span class="i">$self</span>-&gt;{<span class="w">public_methods</span>}-&gt;{<span class="i">$method</span>}-&gt;{<span class="w">code</span>}<span class="sc">;</span>
            <span class="k">my</span> <span class="i">$comments</span> = <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">direction</span> <span class="cm">=&gt;</span> <span class="q">'fwd'</span> <span class="s">)</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$format</span> =~ <span class="q">/html/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$comments</span> =~ <span class="q">s/\n/&lt;BR&gt;/g</span><span class="sc">;</span>
                <span class="k">push</span><span class="s">(</span> <span class="i">@details</span><span class="cm">,</span> <span class="q">&quot;&lt;B&gt;$method&lt;/B&gt;&lt;P&gt;$comments&quot;</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">push</span> <span class="i">@details</span><span class="cm">,</span> <span class="q">&quot;$method\n******************\n$comments\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">return</span> \<span class="i">@details</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> \<span class="i">@methods</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_blocks-"></a><span class="k">sub </span><span class="m">get_blocks</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse the entire code base and extract blocks of code</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$inside_sub</span>          = <span class="n">0</span><span class="sc">;</span>    <span class="c">#Flag indicating whether we are inside a sub.</span>
    <span class="k">my</span> <span class="i">$open_bracket_count</span>  = <span class="n">0</span><span class="sc">;</span>    <span class="c">#Number of open brackets encountered</span>
    <span class="k">my</span> <span class="i">$close_bracket_count</span> = <span class="n">0</span><span class="sc">;</span>    <span class="c">#Number of close brackets encounted</span>
    <span class="k">my</span> <span class="i">$i</span>                   = <span class="n">1</span><span class="sc">;</span>    <span class="c">#Index of the blocks</span>
    <span class="k">my</span> <span class="i">%temp_blocks</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$line_number</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">code</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$line_number</span>++<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*sub\s+(\w+)\s*\{/</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#look for beginning of a sub</span>
            <span class="i">$open_bracket_count</span>++<span class="sc">;</span>
            <span class="i">$inside_sub</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="i">$i</span>++<span class="sc">;</span>

            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">type</span>}        = <span class="q">'sub'</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">line_number</span>} = <span class="i">$line_number</span><span class="sc">;</span>

            <span class="k">my</span> <span class="i">$comments</span> = <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$self</span>-&gt;{<span class="w">code</span>}<span class="cm">,</span>
                -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
            <span class="s">)</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$comment_lines</span> = <span class="n">0</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$comments</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$comment_lines</span> = <span class="k">int</span><span class="s">(</span> <span class="k">my</span> <span class="i">@list</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$comments</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>

            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">line_number</span>} = <span class="i">$line_number</span> - <span class="i">$comment_lines</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">code</span>}        = <span class="q">&quot;$comments$line\n&quot;</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$i</span> == <span class="n">2</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">## first one after header...</span>
                <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="n">1</span>}-&gt;{<span class="w">code</span>} =~ <span class="q">s /$comments$//</span><span class="sc">;</span>    <span class="c">## remove comments from end of first block</span>
                                                                    <span class="c">#print $self-&gt;{blocks}-&gt;{1}-&gt;{code};</span>
            <span class="s">}</span>

        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> !<span class="i">$inside_sub</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/\s*(\S)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## put all code found BETWEEN subroutines at the beginning (block 1)</span>
            <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$i</span> &gt; <span class="n">1</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="i">$1</span> =~ <span class="q">/^\#/</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">next</span><span class="sc">;</span>
            <span class="s">}</span>    <span class="c">## leave mid routine comments...</span>
            <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*return/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">next</span><span class="sc">;</span>
            <span class="s">}</span>    <span class="c">## do not include return statement in mid-routine code</span>
            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="n">1</span>}-&gt;{<span class="w">code</span>} .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="n">1</span>}-&gt;{<span class="w">type</span>}        = <span class="q">'non_sub'</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="n">1</span>}-&gt;{<span class="w">line_number</span>} = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span><span class="i">$inside_sub</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">code</span>} .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$line</span> =~ <span class="q">s/\\\#//g</span><span class="sc">;</span>    <span class="c">## remove escaped hashes so comments can be id'd</span>
            <span class="i">$line</span> =~ <span class="q">s/\$\#//g</span><span class="sc">;</span>    <span class="c">## remove hashes right after dollar signs so can properly count brackets</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/(.*?)\#/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$line</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="s">}</span>                      <span class="c">## do not include the comments for bracket counting</span>

            <span class="i">$open_bracket_count</span>  += <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\{/g</span><span class="sc">;</span>
            <span class="i">$close_bracket_count</span> += <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\}/g</span><span class="sc">;</span>

            <span class="i">$open_bracket_count</span>  -= <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\\\{/g</span><span class="sc">;</span>    <span class="c">## exclude escaped brackets (sheesh...)</span>
            <span class="i">$close_bracket_count</span> -= <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\\\}/g</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$open_bracket_count</span> == <span class="i">$close_bracket_count</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#if number of open anc close brackets matched then we found the end of a sub</span>
                <span class="i">$inside_sub</span>                  = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$open_bracket_count</span>          = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$close_bracket_count</span>         = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">end</span>} = <span class="i">$line_number</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="parse_blocks-"></a><span class="k">sub </span><span class="m">parse_blocks</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse the blocks and extract information</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>    = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perldoc</span> = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span> ? <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$i</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$block</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">blocks</span>} } <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$code</span>           = <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$block</span>}-&gt;{<span class="w">code</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$type</span>           = <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$block</span>}-&gt;{<span class="w">type</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$line_number</span>    = <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$block</span>}-&gt;{<span class="w">line_number</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$secondary_type</span> = <span class="i">$self</span>-&gt;{<span class="w">blocks</span>}-&gt;{<span class="i">$block</span>}-&gt;{<span class="w">secondary_type</span>}<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/\bsub\b/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## for now skip pre-code for first sub (included in header block</span>
            <span class="i">$self</span><span class="i">-&gt;parse_sub</span><span class="s">(</span>
                -<span class="w">code</span>          <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">perldoc</span>       <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span>
                -<span class="w">line_number</span>   <span class="cm">=&gt;</span> <span class="i">$line_number</span><span class="cm">,</span>
                -<span class="w">skip_pre_code</span> <span class="cm">=&gt;</span> !<span class="i">$i</span>
            <span class="s">)</span><span class="sc">;</span>
            <span class="i">$i</span>++<span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/non_sub/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span><span class="i">-&gt;parse_non_sub</span><span class="s">(</span>
                -<span class="w">code</span>           <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">perldoc</span>        <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span>
                -<span class="w">secondary_type</span> <span class="cm">=&gt;</span> <span class="i">$secondary_type</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="parse_sub-"></a><span class="k">sub </span><span class="m">parse_sub</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Parse a sub and extract infomation</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span>          = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$line_number</span>   = <span class="i">$args</span>{-<span class="w">line_number</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$skip_pre_code</span> = <span class="i">$args</span>{-<span class="w">skip_pre_code</span>}<span class="sc">;</span>    <span class="c">## ignore comments prior to block</span>

    <span class="k">my</span> <span class="i">$perldoc</span> = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span> ? <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$type</span> = <span class="i">$self</span><span class="i">-&gt;get_sub_type</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$i</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="i">$type</span>} }<span class="sc">;</span>
    <span class="i">$i</span>++<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$name</span> = <span class="i">$self</span><span class="i">-&gt;get_sub_name</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$i</span>} = <span class="i">$name</span><span class="sc">;</span>
    <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>}<span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code_snip</span>} <span class="s">)</span> = <span class="i">$self</span><span class="i">-&gt;get_sub_description_and_code_snip</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} = <span class="q">&quot;$code\n&quot;</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$args_ref</span><span class="cm">,</span> <span class="i">$args_index_ref</span> <span class="s">)</span> = <span class="i">$self</span><span class="i">-&gt;get_sub_arguments</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">arguments</span>} } = <span class="i">%</span>{<span class="i">$args_ref</span>}<span class="sc">;</span>
    <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">arguments</span>} } = <span class="i">%</span>{<span class="i">$args_index_ref</span>}<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/constructor/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$att_ref</span><span class="cm">,</span> <span class="i">$att_index_ref</span> <span class="s">)</span> = <span class="i">$self</span><span class="i">-&gt;_get_attributes</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">attributes</span>} } = <span class="i">%</span>{<span class="i">$att_ref</span>}<span class="sc">;</span>
        <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">attributes</span>} } = <span class="i">%</span>{<span class="i">$att_index_ref</span>}<span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$perldoc</span><span class="s">)</span> <span class="s">{</span>    <span class="c">## &amp;&amp; $type !~ /private/i) { # Only generate perldoc if scope is not private</span>
        <span class="k">print</span> <span class="q">&quot;parse $name : $type ($i)\n&quot;</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/private/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="i">$Referenced</span>{<span class="i">$name</span>} <span class="s">)</span> <span class="s">{</span><span class="k">return</span><span class="s">}</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$i</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#If we are dealing with the first sub of the type, then we need to insert the perldoc header and footer for the section.</span>
            <span class="k">my</span> <span class="i">$phi</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$pfi</span> = <span class="n">1</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/constructor/i</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># If we are dealing with constructor then also need to build perldoc for attributes.</span>
                <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$phi</span>++ } = <span class="q">&quot;=head2 ATTRIBUTES &lt;UPLINK&gt;&quot;</span><span class="sc">;</span>

                <span class="k">my</span> <span class="i">$att_text</span><span class="sc">;</span>
                <span class="k">my</span> <span class="i">$att_count</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">attributes</span>} }<span class="sc">;</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$att_count</span> &gt; <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$att_text</span> .= <span class="q">&quot;=over&quot;</span><span class="sc">;</span>

                    <span class="k">my</span> <span class="i">$att_pi</span> = <span class="n">1</span><span class="sc">;</span>
                    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$att</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">attributes</span>} } <span class="s">)</span> <span class="s">{</span>
                        <span class="k">my</span> <span class="i">$att_name</span> = <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$att</span>}<span class="sc">;</span>
                        <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$att_name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$att_pi</span>++ } = <span class="q">&quot;=item $att_name ($self-&gt;{attributes}-&gt;{$att_name}-&gt;{type})&quot;</span><span class="sc">;</span>
                        <span class="k">my</span> <span class="i">$desc</span> = <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$att_name</span>}-&gt;{<span class="w">description</span>}<span class="sc">;</span>
                        <span class="k">if</span> <span class="s">(</span><span class="i">$desc</span><span class="s">)</span> <span class="s">{</span> <span class="i">$desc</span> .= <span class="q">' '</span> <span class="s">}</span>
                        <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$att_name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$att_pi</span>++ } = <span class="i">$desc</span> . <span class="q">&quot;[Default = $self-&gt;{attributes}-&gt;{$att_name}-&gt;{default}]&quot;</span><span class="sc">;</span>
                        <span class="i">$att_text</span> .= <span class="i">$self</span><span class="i">-&gt;generate_perldoc</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">attributes</span>}-&gt;{<span class="i">$att_name</span>}-&gt;{<span class="w">perldoc</span>} <span class="s">)</span><span class="sc">;</span>
                    <span class="s">}</span>

                    <span class="i">$att_text</span> .= <span class="q">&quot;=back&quot;</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span>
                    <span class="i">$att_text</span> = <span class="q">&quot;None\n&quot;</span><span class="sc">;</span>
                <span class="s">}</span>

                <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$phi</span>++ } = <span class="i">$att_text</span><span class="sc">;</span>
                <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$phi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>
            <span class="s">}</span>

            <span class="k">my</span> <span class="i">$type_name</span> = <span class="i">$type</span><span class="sc">;</span>
            <span class="i">$type_name</span> =~ <span class="q">tr/a-z/A-Z/</span><span class="sc">;</span>    <span class="c"># Translate the type to all upper case</span>
            <span class="i">$type_name</span> =~ <span class="q">s/_/ /g</span><span class="sc">;</span>        <span class="c"># Replace underscores with space</span>

            <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$phi</span>++ } = <span class="q">&quot;=head2 $type_name &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>

            <span class="c">#	    if ($type =~/public_(methods|functions)/) {</span>
            <span class="c">#		print &quot;(+$name)&quot;;</span>
            <span class="c">#		$self-&gt;{$type}-&gt;{perldoc_header}-&gt;{1} .= &quot;=for html &lt;font size='-1'&gt;&lt;strong&gt;&lt;A href='#$name'&gt;$name; &lt;/A&gt;&lt;/strong&gt;&lt;/font&gt;&lt;BR&gt;\n&quot;;</span>
            <span class="c">#	    }</span>
            <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$phi</span>++ } = <span class="q">&quot;=over&quot;</span><span class="sc">;</span>

            <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pfi</span>++ } = <span class="q">&quot;=back&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pfi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="c">### Add links to public_methods.. ###</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/public_(functions|methods)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="n">1</span>} .= <span class="q">&quot;=for html &lt;font size='-1'&gt;&lt;strong&gt;&lt;A href='#$name'&gt;$name; &lt;/A&gt;&lt;/strong&gt;&lt;/font&gt;&lt;BR&gt;\n\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">my</span> <span class="i">$pi</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$pi</span>++ } = <span class="q">&quot;\n=for html &lt;A NAME='$name'&gt;\n\n=item $name\n&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$args_text</span> = <span class="q">&quot;=for html\n&quot;</span><span class="sc">;</span>
        <span class="i">$args_text</span> .= <span class="q">&quot;&lt;B&gt;Arguments:&lt;/B&gt;&lt;BR&gt;\n********************&lt;BR&gt;\n&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$args_count</span> = <span class="s">(</span><span class="s">)</span>
            = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">arguments</span>} }<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$args_count</span> &gt; <span class="n">0</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$args_text</span> .= <span class="q">&quot;&lt;Font size =-2&gt;&quot;</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$arg</span> <span class="s">(</span>
                <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span>
                <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">arguments</span>} }
                <span class="s">)</span>
            <span class="s">{</span>
                <span class="k">my</span> <span class="i">$arg_name</span> = <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">arguments</span>}-&gt;{<span class="i">$arg</span>}<span class="sc">;</span>
                <span class="k">my</span> <span class="i">$last_arg</span> = <span class="n">1</span> <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">arguments</span>}-&gt;{ <span class="i">$arg</span> + <span class="n">1</span> } <span class="s">)</span><span class="sc">;</span>

                <span class="c">#		if ($self-&gt;{$type}-&gt;{$name}-&gt;{arguments}-&gt;{$arg_name}-&gt;{pre_comments}) {</span>
                <span class="c">#		    $args_text .= &quot;&lt;Font color=blue&gt;$self-&gt;{$type}-&gt;{$name}-&gt;{arguments}-&gt;{$arg_name}-&gt;{pre_comments}&lt;/Font&gt;&lt;BR&gt;\n&quot;; #Default value</span>
                <span class="c">#		}</span>
                <span class="i">$args_text</span> .= <span class="q">&quot;- &lt;B&gt;$arg_name&lt;/B&gt;($self-&gt;{$type}-&gt;{$name}-&gt;{arguments}-&gt;{$arg_name}-&gt;{type}): &quot;</span><span class="sc">;</span>    <span class="c"># Name (Type)</span>
                <span class="k">my</span> <span class="i">$desc</span> = <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">arguments</span>}-&gt;{<span class="i">$arg_name</span>}-&gt;{<span class="w">description</span>}<span class="sc">;</span>
                <span class="k">if</span> <span class="s">(</span><span class="i">$desc</span><span class="s">)</span> <span class="s">{</span> <span class="i">$desc</span> .= <span class="q">' '</span> <span class="s">}</span>
                <span class="i">$args_text</span> .= <span class="i">$desc</span><span class="sc">;</span>
                <span class="i">$args_text</span> .= <span class="q">&quot; [Default = &lt;B&gt;$self-&gt;{$type}-&gt;{$name}-&gt;{arguments}-&gt;{$arg_name}-&gt;{default}&lt;/B&gt;]&lt;BR&gt;\n&quot;</span><span class="sc">;</span>    <span class="c"># Default value</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">arguments</span>}-&gt;{<span class="i">$arg_name</span>}-&gt;{<span class="w">post_comments</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$args_text</span> .= <span class="q">&quot;$self-&gt;{$type}-&gt;{$name}-&gt;{arguments}-&gt;{$arg_name}-&gt;{post_comments}\n&quot;</span><span class="sc">;</span>                  <span class="c">#Default value</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="i">$args_text</span> .= <span class="q">&quot;&lt;/Font&gt;&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$args_text</span> .= <span class="q">&quot;- None&lt;BR&gt;\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">my</span> <span class="i">$sub_desc</span><span class="sc">;</span>
        <span class="i">$sub_desc</span> = <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>}<span class="sc">;</span>

        <span class="c">#$sub_desc =~ s/\n{1}/\n\n/g; #Make sure each line of the description is separted by a blank line in the perldoc</span>
        <span class="i">$sub_desc</span> =~ <span class="q">s/\n/&lt;BR&gt;/g</span><span class="sc">;</span>    <span class="c">#Replace newline characters with &lt;BR&gt; tags.</span>
        <span class="i">$sub_desc</span>                                     = <span class="q">&quot;=for html\n$sub_desc&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$pi</span>++ } = <span class="i">$sub_desc</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$pi</span>++ } = <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code_snip</span>}<span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$pi</span>++ } = <span class="q">&quot;$args_text&lt;BR&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="i">$type</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">perldoc</span>}-&gt;{ <span class="i">$pi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_sub_name-"></a><span class="k">sub </span><span class="m">get_sub_name</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse a sub and get the name of the sub.</span>
    <span class="c">#Returns: Name of the sub [String]</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="i">$code</span> =~ <span class="q">/.*^\s*sub\s+(\w+)\s*\{/ms</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_sub_description_and_code_snip-"></a><span class="k">sub </span><span class="m">get_sub_description_and_code_snip</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse a sub and get the description and code snip</span>
    <span class="c">#Returns: An array that contains the description of the sub [String] and code snip [String]</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$description</span>      = <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$code_snip</span>        = <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$inside_code_snip</span> = <span class="n">0</span><span class="sc">;</span>    <span class="c"># Flag to indicate whether we are inside a code snip section;</span>

    <span class="k">my</span> <span class="i">$all_description</span> = <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">direction</span> <span class="cm">=&gt;</span> <span class="q">'rev'</span> <span class="s">)</span> . <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">direction</span> <span class="cm">=&gt;</span> <span class="q">'forward'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$all_description</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#+\s*&lt;snip&gt;/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$inside_code_snip</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#+\s*&lt;\/snip&gt;/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$inside_code_snip</span> = <span class="n">0</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#+(\s*)(.*[a-zA-Z0-9]+.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$inside_code_snip</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$code_snip</span> .= <span class="q">&quot; $2\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$description</span> .= <span class="q">&quot;$2\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#{1}\s*$/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$inside_code_snip</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$code_snip</span> .= <span class="q">&quot; \n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$description</span> .= <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="s">(</span> <span class="i">$description</span><span class="cm">,</span> <span class="i">$code_snip</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_sub_type-"></a><span class="k">sub </span><span class="m">get_sub_type</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse a sub and get the type of the sub</span>
    <span class="c">#Returns: The type of the sub [String]</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="i">$code</span> =~ <span class="q">/.*^\s*sub\s+(\w+)\s*\{/ms</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$scope</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$name</span> = <span class="i">$1</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$name</span> =~ <span class="q">/^_.*/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$scope</span> = <span class="q">'private'</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$scope</span> = <span class="q">'public'</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$name</span> =~ <span class="q">/\bnew\b/i</span> || <span class="i">$code</span> =~ <span class="q">/.*^\s*bless\s+(?:\$self|\$this).*/ms</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$type</span> = <span class="q">'constructor'</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$code</span> =~ <span class="q">/.*^\s*my\s+(?:\$self|\$this)\s*=\s*shift\s*;.*/ms</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$type</span> = <span class="i">$scope</span> . <span class="q">&quot;_methods&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$type</span> = <span class="i">$scope</span> . <span class="q">&quot;_functions&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$type</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_sub_arguments-"></a><span class="k">sub </span><span class="m">get_sub_arguments</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Parse a sub and get the arguments of the sub;</span>
    <span class="c"># Returns: An array that contains the arguments of the sub [HashRef] and the index to those arguments [HashRef]</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sub_name</span> = <span class="i">$args</span>{-<span class="w">name</span>} || <span class="n">0</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">%arguments</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%arguments_index</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$args_hash_found</span> = <span class="q">''</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$i</span> = <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$start</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$done</span>  = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$code</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*$/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>    <span class="c">## Ignore blank lines ##</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$sub_name</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^sub $sub_name /</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">## if this subroutine was specifically asked for, we have found it.</span>
            <span class="i">$start</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$sub_name</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^sub /</span> <span class="s">)</span> <span class="s">{</span>           <span class="c">## .. or if we have specified a name, and a new subroutine is found.</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$start</span><span class="s">)</span> <span class="s">{</span>
                <span class="k">last</span><span class="sc">;</span>
            <span class="s">}</span>                                               <span class="c"># (we already found the routine required so we are done)</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">next</span><span class="sc">;</span>
            <span class="s">}</span>                                               <span class="c"># (we haven't found the desired routine yet, so keep looking)</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$sub_name</span> &amp;&amp; !<span class="i">$start</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>    <span class="c">## .. or if we have specified a name and it has not yet been found, keep looking</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$start</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>    <span class="c">## .. or else we are looking in the right spot .. (keep going)...</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+(\$self|\$this)\s*=\s*shift\s*;.*/</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Do not count '$self=shift' and '$this=shift' as argument</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$start</span> &amp;&amp; !<span class="i">$done</span> &amp;&amp; <span class="k">defined</span> <span class="i">$arguments_index</span>{ <span class="i">$i</span> - <span class="n">1</span> } &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^\s*(\#.*)$/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## include comments if inside argument list block... ##</span>
            <span class="k">my</span> <span class="i">$comment</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$name</span>    = <span class="i">$arguments_index</span>{ <span class="i">$i</span> - <span class="n">1</span> }<span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$comment</span> =~ <span class="q">/\S/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">post_comments</span>} .= <span class="q">&quot;## &lt;Font color=blue&gt;$comment&lt;/Font&gt;&lt;BR&gt;&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>    <span class="c">## Ignore comments unless in arguments block ##</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+(\S+)\s*=\s*(shift)\s*(.*);\s*\#*(.*)/</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+(\S+)\s*=\s*(\@_|\$_).*;\s*\#*(.*)/</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+(\S+)\s*=\s*(.+)(\@_|\$_).*;\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## look for arguments of the sub in regular format ##</span>
            <span class="k">my</span> <span class="i">$name</span>  = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$value</span> = <span class="i">$2</span> . <span class="i">$3</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span>  = <span class="i">$4</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
            <span class="k">print</span> <span class="q">&quot;($name; $value; $desc; $type) : $line\n&quot;</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$2</span> =~ <span class="q">/(\@|\%)/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">my</span> <span class="i">$type</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$name</span> =~ <span class="q">s/($type)(\w+)/$1\$$2/</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/(.*)\s*\[(.*)\]/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$type</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)/$1/</span><span class="sc">;</span>    <span class="c">#Trim leading spaces</span>
            <span class="i">$desc</span> =~ <span class="q">s/&lt;/&amp;lt;/g</span><span class="sc">;</span>
            <span class="i">$desc</span> =~ <span class="q">s/&gt;/&amp;gt;/g</span><span class="sc">;</span>
            <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">default</span>}     = <span class="i">$value</span><span class="sc">;</span>
            <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
            <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">type</span>}        = <span class="i">$type</span><span class="sc">;</span>
            <span class="i">$arguments_index</span>{ <span class="i">$i</span>++ }       = <span class="i">$name</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$value</span> =~ <span class="q">/\@_/</span> &amp;&amp; <span class="i">$name</span> =~ <span class="q">/%(\w+)/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$args_hash_found</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">print</span> <span class="q">&quot;HASH = ($name) $args_hash_found.\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$args_hash_found</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)*\s+(\S+)\s*=\s*([\@\%\{\$]*$args_hash_found[-&gt;]*[\{].*[\}]+)(.*)\s*;\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## Look for arguments in the %args format</span>
            <span class="k">my</span> <span class="i">$name</span>  = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$value</span> = <span class="i">$2</span> . <span class="i">$3</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span>  = <span class="i">$4</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/(.*)\s*\[(.*)\]/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$type</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">print</span> <span class="q">&quot;[$name; $value; $desc; $type]\n&quot;</span><span class="sc">;</span>
            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)/$1/</span><span class="sc">;</span>    <span class="c">#Trim leading spaces</span>
            <span class="i">$desc</span> =~ <span class="q">s/&lt;/&amp;lt;/g</span><span class="sc">;</span>
            <span class="i">$desc</span> =~ <span class="q">s/&gt;/&amp;gt;/g</span><span class="sc">;</span>
            <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">default</span>}     = <span class="i">$value</span><span class="sc">;</span>
            <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
            <span class="i">$arguments</span>{<span class="i">$name</span>}{<span class="w">type</span>}        = <span class="i">$type</span><span class="sc">;</span>
            <span class="i">$arguments_index</span>{ <span class="i">$i</span>++ }       = <span class="i">$name</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/\&amp;?(\w+)\(\\?%$args_hash_found/</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/(?:\&amp;|-&gt;|)([\w^&gt;]+)\(\S*?=\&gt;\\%args/</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$reference</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">print</span> <span class="q">&quot;(references $reference) : $line\n&quot;</span><span class="sc">;</span>

            <span class="c">#	    $arguments_index{$i++} = $reference;</span>
            <span class="k">my</span> <span class="i">$lastarg</span> = <span class="i">$arguments_index</span>{ <span class="i">$i</span> - <span class="n">1</span> }<span class="sc">;</span>    <span class="c">## append to last comment (to avoid formatting with arg = [Default= ] etc.)</span>
            <span class="i">$lastarg</span> =~ <span class="q">s/^\s+//g</span><span class="sc">;</span>
            <span class="i">$lastarg</span> =~ <span class="q">s/\s+$//g</span><span class="sc">;</span>

            <span class="i">$arguments</span>{<span class="i">$lastarg</span>}{<span class="w">post_comments</span>} .= <span class="q">&quot;&lt;FONT color=red&gt;## parameters are also passed on to &lt;A Href=#$reference&gt;$reference&lt;/A&gt; ##&lt;/Font&gt;&lt;BR&gt;&quot;</span><span class="sc">;</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$Referenced</span>{<span class="i">$reference</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$reference</span> =~ <span class="q">/^_/</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$Referenced</span>{<span class="i">$reference</span>} = <span class="n">1</span><span class="sc">;</span> <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">%arguments</span> &amp;&amp; <span class="i">$line</span> !~ <span class="q">/^\S/</span> <span class="s">)</span> <span class="s">{</span>

            <span class="c"># If arguments are found and we are at a non-blank line not describing arguments, then we are done!</span>
            <span class="c">## ... and clear any comments after last argument if applicable</span>
            <span class="c">#	    if ( defined $arguments{$arguments_index{$i-1}}{post_comments} ) {</span>
            <span class="c">#		$arguments{$arguments_index{$i-1}}{post_comments} = '';</span>
            <span class="c">#	    }</span>
            <span class="i">$done</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>

    <span class="s">}</span>

    <span class="k">return</span> <span class="s">(</span> \<span class="i">%arguments</span><span class="cm">,</span> \<span class="i">%arguments_index</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="parse_non_sub-"></a><span class="k">sub </span><span class="m">parse_non_sub</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse the portion of the code that is not inside a sub</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span>           = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$secondary_type</span> = <span class="i">$args</span>{-<span class="w">secondary_type</span>} || <span class="q">'header'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perldoc</span>        = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span> ? <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>

    <span class="i">$self</span><span class="i">-&gt;get_perl_interpreter</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;get_package_definition</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$code</span> = <span class="i">$self</span><span class="i">-&gt;get_system_variables</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;get_superclasses</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">perldoc</span> <span class="cm">=&gt;</span> <span class="i">$perldoc</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;get_modules_ref</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">perldoc</span> <span class="cm">=&gt;</span> <span class="i">$perldoc</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;get_global_vars</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">perldoc</span> <span class="cm">=&gt;</span> <span class="i">$perldoc</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#$self-&gt;get_modular_vars_and_constants(-code=&gt;$code);</span>
    <span class="i">$self</span><span class="i">-&gt;get_main</span><span class="s">(</span> -<span class="w">code</span> <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span> -<span class="w">secondary_type</span> <span class="cm">=&gt;</span> <span class="i">$secondary_type</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_perl_interpreter-"></a><span class="k">sub </span><span class="m">get_perl_interpreter</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets the perl interpreter</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$i</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">perl_interpreter</span>} }<span class="sc">;</span>
    <span class="i">$i</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="i">$code</span> =~ <span class="q">/^(\s*\#\!.*perl.*)\n/</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">perl_interpreter</span>}-&gt;{<span class="w">perl_interpreter</span>}-&gt;{<span class="w">code</span>} = <span class="i">$1</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">perl_interpreter</span>}-&gt;{<span class="i">$i</span>} = <span class="q">'perl_interpreter'</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="build_perldoc_header_and_footer-"></a><span class="k">sub </span><span class="m">build_perldoc_header_and_footer</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Builds the Perldoc header and footer</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span>   = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$author</span> = <span class="i">$args</span>{-<span class="w">author</span>}<span class="sc">;</span>

    <span class="c">###Header</span>
    <span class="k">my</span> <span class="i">$ph_index</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">perldoc_header</span>} }<span class="sc">;</span>
    <span class="i">$ph_index</span> += <span class="n">1</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$text</span><span class="sc">;</span>

    <span class="c">#if (exists $self-&gt;{perldoc}-&gt;{commands}-&gt;{'NAME'}) {</span>
    <span class="c">#$self-&gt;{perldoc_header}-&gt;{perldoc_header}-&gt;{$ph_index++} = $self-&gt;{perldoc}-&gt;{commands}-&gt;{'NAME'};</span>
    <span class="c">#}</span>
    <span class="c">#else {</span>
    <span class="i">$text</span> = <span class="q">&quot;=head1 NAME &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
    <span class="i">$text</span> .= <span class="q">&quot;$self-&gt;{name} - $self-&gt;{brief_description}&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$ph_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>

    <span class="c">#}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'SYNOPSIS'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$ph_index</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'SYNOPSIS'</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$text</span> = <span class="q">&quot;=head1 SYNOPSIS &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
        <span class="i">$text</span> .= <span class="q">&quot;\t&lt;&lt;SYNOPSIS&gt;&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$ph_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#if (exists $self-&gt;{perldoc}-&gt;{commands}-&gt;{'DESCRIPTION'}) {</span>
    <span class="c">#$self-&gt;{perldoc_header}-&gt;{perldoc_header}-&gt;{$ph_index++} = $self-&gt;{perldoc}-&gt;{commands}-&gt;{'DESCRIPTION'};</span>
    <span class="c">#}</span>
    <span class="c">#else {</span>
    <span class="k">my</span> <span class="i">$desc</span> = <span class="i">$self</span>-&gt;{<span class="w">description</span>}<span class="sc">;</span>
    <span class="i">$desc</span> =~ <span class="q">s/\n/&lt;BR&gt;/g</span><span class="sc">;</span>    <span class="c">#Replace newline characters with &lt;BR&gt; tags.</span>
    <span class="i">$text</span> = <span class="q">&quot;=head1 DESCRIPTION &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
    <span class="i">$text</span> .= <span class="q">&quot;=for html\n$desc&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$ph_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>

    <span class="c">#}</span>

    <span class="i">$self</span>-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$ph_index</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{<span class="n">1</span>} = <span class="q">'perldoc_header'</span><span class="sc">;</span>

    <span class="c">###Footer</span>
    <span class="k">my</span> <span class="i">$pf_index</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">perldoc_footer</span>} }<span class="sc">;</span>
    <span class="i">$pf_index</span> += <span class="n">1</span><span class="sc">;</span>
    <span class="i">$text</span> = <span class="q">''</span><span class="sc">;</span>    <span class="c">## clear variable...</span>

    <span class="c">### Include internal references if input parameters may be passed to them ##</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'KNOWN ISSUES'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'KNOWN ISSUES'</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$text</span> = <span class="q">&quot;=head1 KNOWN ISSUES &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
        <span class="i">$text</span> .= <span class="q">&quot;&lt;&lt;KNOWN ISSUES&gt;&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'FUTURE IMPROVEMENTS'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'FUTURE IMPROVEMENTS'</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$text</span> = <span class="q">&quot;=head1 FUTURE IMPROVEMENTS &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
        <span class="i">$text</span> .= <span class="q">&quot;&lt;&lt;FUTURE IMPROVEMENTS&gt;&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$author_list</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'AUTHORS'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$author_list</span> = <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'AUTHORS'</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$author_list</span> = <span class="q">&quot;=head1 AUTHORS &lt;UPLINK&gt;\n\n&lt;&lt;AUTHORS&gt;&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$author</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$author_list</span> =~ <span class="q">s /&lt;&lt;AUTHORS&gt;&gt;/$author/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$author_list</span> =~ <span class="q">/$author/</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># skip (already exists)</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$author_list</span> .= <span class="q">&quot;$author\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$author_list</span> =~ <span class="q">s/,/\n/g</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$author_list</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'CREATED'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'CREATED'</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$text</span> = <span class="q">&quot;=head1 CREATED &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
        <span class="i">$text</span> .= <span class="i">today</span><span class="s">(</span><span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'REVISION'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">perldoc</span>}-&gt;{<span class="w">commands</span>}-&gt;{<span class="q">'REVISION'</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$text</span> = <span class="q">&quot;=head1 REVISION &lt;UPLINK&gt;\n\n&quot;</span><span class="sc">;</span>
        <span class="i">$text</span> .= <span class="q">'$Id: Code.pm,v 1.36 2004/08/27 18:26:55 rguin Exp $ (Release: $Name:  $)'</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="i">$text</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{ <span class="i">$pf_index</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">perldoc_footer</span>}-&gt;{<span class="n">1</span>} = <span class="q">'perldoc_footer'</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_package_definition-"></a><span class="k">sub </span><span class="m">get_package_definition</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets the package definition</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$i</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">package_definition</span>} }<span class="sc">;</span>
    <span class="i">$i</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$code</span> =~ <span class="q">/^(.*)(\s*package\s+)(.*?)(;\S*).*$/ms</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$name</span> = <span class="i">$3</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">package_definition</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} = <span class="q">&quot;$1$2$3$4\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">package_definition</span>}-&gt;{<span class="i">$i</span>} = <span class="q">&quot;$name&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_system_variables-"></a><span class="k">sub </span><span class="m">get_system_variables</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets the package definition</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$i</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">system_variables</span>} }<span class="sc">;</span>
    <span class="i">$i</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$check</span> = <span class="i">$code</span><span class="sc">;</span>
    <span class="k">while</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$check</span> =~ <span class="q">s/(.*)^(require Exporter;.*?)$(.*)/$1$3/ms</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$check</span> =~ <span class="q">s/(.*)^(\s*(?:\@|%)EXPORT(?:|_OK|_TAGS)\s*=\s*(?:qw)*\(.*?\);.*?)$(.*)/$1$3/ms</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>

        <span class="c">#($check =~s/(.*)^(\s*\@EXPORT(?:|_OK|_TAGS)\s*=\s*qw*\(.*?\).*?)$(.*)/$1$3/ms) ) {</span>
        <span class="k">my</span> <span class="i">$lines</span> = <span class="i">$2</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">system_variables</span>}-&gt;{<span class="i">$i</span>}-&gt;{<span class="w">code</span>} = <span class="q">&quot;$lines\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">system_variables</span>}-&gt;{<span class="i">$i</span>} = <span class="q">&quot;$i&quot;</span><span class="sc">;</span>

        <span class="i">$i</span>++<span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$code</span> = <span class="i">$check</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$code</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#################################################################</span>
<a name="get_superclasses-"></a><span class="k">sub </span><span class="m">get_superclasses</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets the superclasses</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perldoc</span> = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span> ? <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$i</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">superclasses</span>} }<span class="sc">;</span>
    <span class="i">$i</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$code</span> =~ <span class="q">/^(.*?)(\s*\@ISA\s*=\s*(?:qw*)\()(.*?)(\);\s*)$/ms</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$precode</span>      = <span class="i">$1</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$declare</span>      = <span class="i">$2</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$superclasses</span> = <span class="i">$3</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$comments</span>     = <span class="i">$4</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$line_number</span>  = <span class="s">(</span><span class="s">)</span> = <span class="i">$precode</span> =~ <span class="q">/\n/msg</span><span class="sc">;</span>    <span class="c"># Figure out the current line number</span>
        <span class="i">$line_number</span> += <span class="n">2</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$superclass</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\s/</span><span class="cm">,</span> <span class="i">$superclasses</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="i">$i</span>} = <span class="q">&quot;$superclass&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="i">$superclass</span>}-&gt;{<span class="w">code</span>} = <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
            <span class="s">)</span> . <span class="q">&quot;$declare$superclasses$comments\n&quot;</span><span class="sc">;</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="i">$i</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="i">$superclass</span>}-&gt;{<span class="w">skip_generation</span>} = <span class="n">1</span><span class="sc">;</span>
            <span class="s">}</span>                                           <span class="c">#Skip code generation unless it is the first one of the group</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$perldoc</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$pdi</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=head2 SUPERCLASSES &lt;UPLINK&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=over&quot;</span><span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$i</span> <span class="s">(</span>
            <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span>
            <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">superclasses</span>} }
            <span class="s">)</span>
        <span class="s">{</span>
            <span class="k">my</span> <span class="i">$sc</span> = <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="i">$i</span>}<span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=item $sc&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=back&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">superclasses</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_modules_ref-"></a><span class="k">sub </span><span class="m">get_modules_ref</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Gets references to modules</span>
    <span class="c"># (This only gets called for the initial code (excludes subroutines)</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perldoc</span> = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span> ? <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$pm_index</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">standard_modules_ref</span>} }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$cm_index</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">custom_modules_ref</span>} }<span class="sc">;</span>

    <span class="i">$pm_index</span> += <span class="n">1</span><span class="sc">;</span>
    <span class="i">$cm_index</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$line_number</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$code</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$line_number</span>++<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^use vars.*\(.*\)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>    <span class="c"># use vars are not references to modules</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^use\s+(.*);\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$name</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)/$1/</span><span class="sc">;</span>    <span class="c"># Remove leading spaces from description</span>

            <span class="i">$line</span> = <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$name</span> =~ <span class="q">/^(.*)::(.*)/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">my</span> <span class="i">$dir</span>  = <span class="i">$1</span><span class="sc">;</span>
                <span class="k">my</span> <span class="i">$file</span> = <span class="i">$2</span><span class="sc">;</span>
                <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">custom_modules</span>}-&gt;{<span class="w">dirs</span>}-&gt;{<span class="i">$dir</span>} || <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">custom_modules</span>}-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$file</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                    <span class="c">## include comments immediately preceeding this line if available.. ##</span>
                    <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                        -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                        -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
                    <span class="s">)</span> . <span class="i">$line</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{ <span class="i">$cm_index</span>++ } = <span class="i">$name</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                        -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                        -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
                    <span class="s">)</span> . <span class="i">$line</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{ <span class="i">$pm_index</span>++ } = <span class="i">$name</span><span class="sc">;</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$self</span>-&gt;{<span class="w">custom_modules</span>}-&gt;{<span class="w">files</span>}-&gt;{<span class="i">$name</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                        -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                        -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
                    <span class="s">)</span> . <span class="i">$line</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{ <span class="i">$cm_index</span>++ } = <span class="i">$name</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{ <span class="i">$pm_index</span>++ } = <span class="i">$name</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                        -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                        -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
                    <span class="s">)</span> . <span class="i">$line</span><span class="sc">;</span>
                <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$perldoc</span><span class="s">)</span> <span class="s">{</span>

        <span class="c"># Standard modules</span>
        <span class="k">my</span> <span class="i">$pdi</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=head2 STANDARD MODULES REFERENCE &lt;UPLINK&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=over&quot;</span><span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$i</span> <span class="s">(</span>
            <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span>
            <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">standard_modules_ref</span>} }
            <span class="s">)</span>
        <span class="s">{</span>
            <span class="k">my</span> <span class="i">$smf</span> = <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="i">$i</span>}<span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=item $smf&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="i">$smf</span>}-&gt;{<span class="w">description</span>}<span class="sc">;</span>
        <span class="s">}</span>

        <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=back&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">standard_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>

        <span class="c"># Custom modules</span>

        <span class="i">$pdi</span>                                                      = <span class="n">1</span><span class="sc">;</span>                                            <span class="c">## reset variable ...</span>
        <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=head2 CUSTOM MODULES REFERENCE &lt;UPLINK&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=over&quot;</span><span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$i</span> <span class="s">(</span>
            <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span>
            <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">custom_modules_ref</span>} }
            <span class="s">)</span>
        <span class="s">{</span>
            <span class="k">my</span> <span class="i">$cmf</span> = <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="i">$i</span>}<span class="sc">;</span>
            <span class="k">my</span> <span class="s">(</span><span class="i">$href</span><span class="s">)</span> = <span class="i">$cmf</span> =~ <span class="q">/(?:\w*:?:?)(\w+)$/</span><span class="sc">;</span>
            <span class="i">$href</span> .= <span class="q">&quot;.html&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=for html &lt;font size='-1'&gt;&lt;strong&gt;&lt;a href='$href'&gt;$cmf&lt;/a&gt;&lt;/strong&gt;&lt;/font&gt;&lt;br&gt;&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=for html &lt;dd&gt;&lt;font size='-1'&gt;$self-&gt;{custom_modules_ref}-&gt;{$cmf}-&gt;{description}&lt;br&gt;&lt;/font&gt;&quot;</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="i">$cmf</span>}-&gt;{<span class="w">description</span>} <span class="k">ne</span> <span class="q">''</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=for html &lt;br&gt;&quot;</span><span class="sc">;</span>
            <span class="s">}</span>

            <span class="c">#$self-&gt;{custom_modules_ref}-&gt;{perldoc_header}-&gt;{$pdi++} = &quot;=item $cmf&quot;;</span>
            <span class="c">#$self-&gt;{custom_modules_ref}-&gt;{perldoc_header}-&gt;{$pdi++} = $self-&gt;{custom_modules_ref}-&gt;{$cmf}-&gt;{description};</span>
        <span class="s">}</span>

        <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=back&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">custom_modules_ref</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_global_vars-"></a><span class="k">sub </span><span class="m">get_global_vars</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets global variables</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perldoc</span> = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span> ? <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$gvi</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">global_vars</span>} }<span class="sc">;</span>
    <span class="i">$gvi</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$line_number</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$code</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$line_number</span>++<span class="sc">;</span>

        <span class="k">my</span> <span class="i">$gvs</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$desc</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*use\s+vars.*\((.*)\);\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$gvs</span>  = <span class="i">$1</span><span class="sc">;</span>
            <span class="i">$desc</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)\s*$/$1/</span><span class="sc">;</span>    <span class="c">#Get rid of leading and trailing spaces</span>
            <span class="k">my</span> <span class="i">$group_index</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$gv</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\s/</span><span class="cm">,</span> <span class="i">$gvs</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                <span class="c">## include comments immediately preceeding these lines ##</span>
                <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                    -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                    -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
                <span class="s">)</span> . <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
                <span class="k">unless</span> <span class="s">(</span> <span class="i">$group_index</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">skip_generation</span>} = <span class="n">1</span><span class="sc">;</span>
                <span class="s">}</span>                           <span class="c">#Skip code generation unless it is the first one of the group</span>
                <span class="i">$group_index</span>++<span class="sc">;</span>
                <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">global_vars</span>}-&gt;{ <span class="i">$gvi</span>++ } = <span class="i">$gv</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*our.*\((.*)\);\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$gvs</span>  = <span class="i">$1</span><span class="sc">;</span>
            <span class="i">$desc</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)\s*$/$1/</span><span class="sc">;</span>    <span class="c">#Get rid of leading and trailing spaces</span>
            <span class="k">my</span> <span class="i">$group_index</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$gv</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/,/</span><span class="cm">,</span> <span class="i">$gvs</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                <span class="c">## include comments immediately preceeding these lines ##</span>
                <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                    -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                    -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
                <span class="s">)</span> . <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
                <span class="k">unless</span> <span class="s">(</span> <span class="i">$group_index</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">skip_generation</span>} = <span class="n">1</span><span class="sc">;</span>
                <span class="s">}</span>                           <span class="c">#Skip code generation unless it is the first one of the group</span>
                <span class="i">$group_index</span>++<span class="sc">;</span>
                <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">global_vars</span>}-&gt;{ <span class="i">$gvi</span>++ } = <span class="i">$gv</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$perldoc</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$pdi</span> = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=head2 GLOBAL VARIABLES &lt;UPLINK&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=over&quot;</span><span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$i</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">global_vars</span>} } <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$gv</span> = <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$i</span>}<span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=item $gv&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="i">$gv</span>}-&gt;{<span class="w">description</span>}<span class="sc">;</span>
        <span class="s">}</span>

        <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=back&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">global_vars</span>}-&gt;{<span class="w">perldoc_header</span>}-&gt;{ <span class="i">$pdi</span>++ } = <span class="q">&quot;=cut&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_modular_vars_and_constants-"></a><span class="k">sub </span><span class="m">get_modular_vars_and_constants</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets modular variables and constants</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$mvi</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">modular_vars</span>} }<span class="sc">;</span>
    <span class="i">$mvi</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$ci</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">constants</span>} }<span class="sc">;</span>
    <span class="i">$ci</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$open_bracket_count</span>  = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$close_bracket_count</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$inside_block</span>        = <span class="n">0</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$line_number</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$code</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$line_number</span>++<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/\{/g</span> || <span class="i">$line</span> =~ <span class="q">/\}/g</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$open_bracket_count</span>  += <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\{/g</span><span class="sc">;</span>
            <span class="i">$close_bracket_count</span> += <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\}/g</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$open_bracket_count</span> == <span class="i">$close_bracket_count</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$inside_block</span>        = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$open_bracket_count</span>  = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$close_bracket_count</span> = <span class="n">0</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$inside_block</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> !<span class="i">$inside_block</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+([\$|\@|\%]{1}[A-Z_]+)\s*=\s*(.*)\s*;\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$name</span>  = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$value</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span>  = <span class="i">$3</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/(.*)\s*\[(.*)\]/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$type</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$self</span>-&gt;{<span class="w">constants</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">default</span>}     = <span class="i">$value</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">constants</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">constants</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">type</span>}        = <span class="i">$type</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">constants</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
            <span class="s">)</span> . <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">constants</span>}-&gt;{ <span class="i">$ci</span>++ } = <span class="i">$name</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> !<span class="i">$inside_block</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+([\$|\@|\%]{1}\w+)\s*;\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$name</span> = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/(.*)\s*\[(.*)\]/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$type</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">default</span>}     = <span class="q">''</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">type</span>}        = <span class="i">$type</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
            <span class="s">)</span> . <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">modular_vars</span>}-&gt;{ <span class="i">$mvi</span>++ } = <span class="i">$name</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> !<span class="i">$inside_block</span> &amp;&amp; <span class="i">$line</span> =~ <span class="q">/^\s*(?:my|local)\s+([\$|\@|\%]{1}\w+)\s*=\s*(.*)\s*;\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$name</span>  = <span class="i">$1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$value</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span>  = <span class="i">$3</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/(.*)\s*\[(.*)\]/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$type</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">default</span>}     = <span class="i">$value</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">type</span>}        = <span class="i">$type</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">modular_vars</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
            <span class="s">)</span> . <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="w">modular_vars</span>}-&gt;{ <span class="i">$mvi</span>++ } = <span class="i">$name</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_main-"></a><span class="k">sub </span><span class="m">get_main</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Gets the main body and return value of the code</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$secondary_type</span> = <span class="i">$args</span>{-<span class="w">secondary_type</span>} || <span class="q">'header'</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$mi</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{ <span class="q">&quot;main_&quot;</span> . <span class="i">$secondary_type</span> } }<span class="sc">;</span>
    <span class="i">$mi</span> += <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$open_bracket_count</span>  = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$close_bracket_count</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$inside_block</span>        = <span class="n">0</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$line_number</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$code</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$line_number</span>++<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/\{/g</span> || <span class="i">$line</span> =~ <span class="q">/\}/g</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#Determine whether we are inside a block</span>
            <span class="i">$open_bracket_count</span>  += <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\{/g</span><span class="sc">;</span>
            <span class="i">$close_bracket_count</span> += <span class="s">(</span><span class="s">)</span> = <span class="i">$line</span> =~ <span class="q">/\}/g</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="i">$open_bracket_count</span> == <span class="i">$close_bracket_count</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$inside_block</span>        = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$open_bracket_count</span>  = <span class="n">0</span><span class="sc">;</span>
                <span class="i">$close_bracket_count</span> = <span class="n">0</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$inside_block</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#\!.*perl.*$/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>    <span class="c">#Perl scripts directive</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#+/</span> || <span class="i">$line</span> =~ <span class="q">/^\s*$/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>                                             <span class="c">#Comments or blank lines</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*package\s+.*;/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span> <span class="c">#Perl modules directive</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^use\s+.*;\s*\#*.*/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>                                             <span class="c">#References to other modules</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*use\s+vars.*\(.*\);\s*\#*.*/</span> || <span class="i">$line</span> =~ <span class="q">/^\s*our.*\(.*\);\s*\#*.*/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>                                             <span class="c">#Global variables</span>
                                                      <span class="c">#elsif (!$inside_block &amp;&amp; $line =~ /^\s*(?:my|local)\s+[\$|\@|\%]{1}[A-Z_]+\s*=\s*.*\s*;\s*\#*.*/) {next} #Modular level constants</span>
                                                      <span class="c">#elsif (!$inside_block &amp;&amp; ($line =~ /^\s*(?:my|local)\s+[\$|\@|\%]{1}\w+\s*;\s*\#*.*/ || $line =~ /^\s*(?:my|local)\s+[\$|\@|\%]{1}\w+\s*=\s*.*\s*;\s*\#*.*/)) {next} #Modular level variables</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^(\s*\@ISA\s*=\s*(?:qw*)\()(.*?)(\);\s*)$/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>                                             <span class="c">#Superclasses</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^(\s*\@Export\w*\s*=\s*(?:qw*)\()(.*?)(\);\s*)$/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">next</span><span class="sc">;</span>
        <span class="s">}</span>                                             <span class="c"># Exporter</span>
        <span class="k">else</span> <span class="s">{</span>                                        <span class="c"># This is coding lines for the main body of the code</span>
            <span class="k">my</span> <span class="i">$section</span> = <span class="q">&quot;main_&quot;</span> . <span class="i">$secondary_type</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$name</span>    = <span class="q">&quot;main_&quot;</span> . <span class="i">$secondary_type</span> . <span class="q">&quot;_&quot;</span> . <span class="i">$mi</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$name</span>}-&gt;{<span class="w">code</span>} .= <span class="i">$self</span><span class="i">-&gt;get_comments</span><span class="s">(</span>
                -<span class="w">code</span>        <span class="cm">=&gt;</span> <span class="i">$code</span><span class="cm">,</span>
                -<span class="w">line_number</span> <span class="cm">=&gt;</span> <span class="i">$line_number</span>
            <span class="s">)</span> . <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
            <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="i">$section</span>}-&gt;{ <span class="i">$mi</span>++ } = <span class="i">$name</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="get_comments-"></a><span class="k">sub </span><span class="m">get_comments</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Gets the comments that preceed the first executable lines of code</span>
    <span class="c"># Returns: The comments that start off the next given block.</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span>        = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>                 <span class="c"># The code to extract the comments from</span>
    <span class="k">my</span> <span class="i">$line_number</span> = <span class="i">$args</span>{-<span class="w">line_number</span>} || <span class="n">1</span><span class="sc">;</span>     <span class="c"># Optional line number at which to start</span>
    <span class="k">my</span> <span class="i">$search</span>      = <span class="i">$args</span>{ - <span class="w">search</span> }<span class="sc">;</span>            <span class="c"># The block of code to search for which is preceeded by the comments</span>
    <span class="k">my</span> <span class="i">$direction</span>   = <span class="i">$args</span>{-<span class="w">direction</span>} || <span class="q">'rev'</span><span class="sc">;</span>

    <span class="i">$search</span> = <span class="q">&quot;\Q$search\E&quot;</span><span class="sc">;</span>                        <span class="c"># Need to escape special characters during the regexp searching.</span>
    <span class="k">my</span> <span class="i">@lines</span> = <span class="k">split</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="i">$code</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$comments</span> = <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$nextline</span><span class="sc">;</span>

    <span class="i">$line_number</span>--<span class="sc">;</span>                                 <span class="c">## adjust to represent index rather than line #</span>

    <span class="k">if</span>   <span class="s">(</span> <span class="i">$direction</span> =~ <span class="q">/^f/i</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$nextline</span> = <span class="i">$lines</span>[ ++<span class="i">$line_number</span> ] <span class="s">}</span>
    <span class="k">else</span>                         <span class="s">{</span> <span class="i">$nextline</span> = <span class="i">$lines</span>[ --<span class="i">$line_number</span> ] <span class="s">}</span>

    <span class="k">while</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$line_number</span> &gt; <span class="n">0</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="s">(</span> <span class="i">$nextline</span> =~ <span class="q">/^\s*\#+/</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$nextline</span> =~ <span class="q">/^\s*$/</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$nextline</span> =~ <span class="q">/^sub /</span> <span class="s">)</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="i">$line_number</span> &lt;= <span class="k">int</span><span class="s">(</span><span class="i">@lines</span><span class="s">)</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$direction</span> =~ <span class="q">/^f/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$comments</span> .= <span class="q">&quot;$nextline\n&quot;</span> <span class="k">unless</span> <span class="s">(</span> <span class="i">$nextline</span> =~ <span class="q">/^sub /</span> <span class="s">)</span><span class="sc">;</span>    <span class="c">## skip definition line</span>
            <span class="i">$nextline</span> = <span class="i">$lines</span>[ ++<span class="i">$line_number</span> ]<span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$comments</span> = <span class="q">&quot;$nextline\n$comments&quot;</span> <span class="k">unless</span> <span class="s">(</span> <span class="i">$nextline</span> =~ <span class="q">/^sub /</span> <span class="s">)</span><span class="sc">;</span>    <span class="c">## skip definition line;</span>
            <span class="i">$nextline</span> = <span class="i">$lines</span>[ --<span class="i">$line_number</span> ]<span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$comments</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="generate_code-"></a><span class="k">sub </span><span class="m">generate_code</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Builds the code.</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$author</span> = <span class="i">$args</span>{-<span class="w">author</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perldoc</span>
        = <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">perldoc</span>} <span class="s">)</span>
        ? <span class="i">$args</span>{-<span class="w">perldoc</span>}
        <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>    <span class="c"># 3 perldoc levels: 0 = No perldoc; 1 = perldoc header &amp; footer; 2 = ALL perldoc</span>

    <span class="i">$self</span><span class="i">-&gt;parse_perldoc</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;get_blocks</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;parse_blocks</span><span class="s">(</span> -<span class="w">perldoc</span> <span class="cm">=&gt;</span> <span class="n">2</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$perldoc</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span><span class="i">-&gt;build_perldoc_header_and_footer</span><span class="s">(</span> -<span class="w">author</span> <span class="cm">=&gt;</span> <span class="i">$author</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#print Dumper @{$self-&gt;{sections_order}};</span>

<span class="c">## hide the block headings for some of the sections... ##</span>
    <span class="k">my</span> <span class="i">%Hide</span><span class="sc">;</span>
    <span class="i">$Hide</span>{<span class="w">perl_interpreter</span>}   = <span class="n">1</span><span class="sc">;</span>
    <span class="i">$Hide</span>{<span class="w">package_definition</span>} = <span class="n">1</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$section</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">sections_order</span>} } <span class="s">)</span> <span class="s">{</span>
        <span class="k">unless</span> <span class="s">(</span> <span class="i">$Hide</span>{<span class="i">$section</span>} <span class="s">)</span> <span class="s">{</span>    <span class="c">## don't include labels for these sections</span>
            <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">_section_label</span><span class="s">(</span><span class="i">$section</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">print</span> <span class="i">_section_label</span><span class="s">(</span><span class="i">$section</span><span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$perldoc</span> &amp;&amp; <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="w">perldoc_header</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$perldoc</span> == <span class="n">2</span> || <span class="i">$section</span> =~ <span class="q">/perldoc_header|perldoc_footer/</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># If perldoc level is 1 then only print if section is perldoc header or footer</span>
                <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span><span class="i">-&gt;generate_perldoc</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="w">perldoc_header</span>} <span class="s">)</span><span class="sc">;</span>
                <span class="k">print</span> <span class="q">&quot;added perldoc..&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>

        <span class="k">my</span> <span class="i">$max_index</span> = <span class="s">(</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="i">$section</span>} }<span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="i">$section</span>} } <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$item</span> = <span class="i">$self</span>-&gt;{<span class="w">indexes</span>}-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$key</span>}<span class="sc">;</span>

            <span class="c">#print &quot;&gt;&gt;&gt;&gt;&gt;$section ($item)\n&quot;;</span>
            <span class="c">#print $self-&gt;{$section}-&gt;{$item}-&gt;{code};</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$item</span>}-&gt;{<span class="w">skip_generation</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$perldoc</span> == <span class="n">2</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span><span class="i">-&gt;generate_perldoc</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$item</span>}-&gt;{<span class="w">perldoc</span>} <span class="s">)</span><span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$item</span>}-&gt;{<span class="w">pre_code</span>}<span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$item</span>}-&gt;{<span class="w">code</span>}<span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span>
                    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$item</span>}-&gt;{<span class="w">pre_code</span>}<span class="sc">;</span>
                    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="i">$item</span>}-&gt;{<span class="w">code</span>}<span class="sc">;</span>
                <span class="s">}</span>

                <span class="c">#Insert blank line between sections</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$key</span> == <span class="i">$max_index</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="q">&quot;\n&quot;</span><span class="sc">;</span> <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$perldoc</span> &amp;&amp; <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="w">perldoc_footer</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$perldoc</span> == <span class="n">2</span> || <span class="i">$section</span> =~ <span class="q">/perldoc_header|perldoc_footer/</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># If perldoc level is 1 then only print if section is perldoc header or footer</span>
                <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="i">$self</span><span class="i">-&gt;generate_perldoc</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="i">$section</span>}-&gt;{<span class="w">perldoc_footer</span>} <span class="s">)</span><span class="sc">;</span>
                <span class="k">print</span> <span class="q">&quot;footer;&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">print</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} =~ <span class="q">s/\n{3,}/\n\n/sg</span><span class="sc">;</span>                                     <span class="c"># Get rid of extra blank lines</span>
    <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} =~ <span class="q">s/^\s*(.*)\s*$/$1/s</span><span class="sc">;</span>                                  <span class="c"># Get rid of leading and trailing spaces</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$file</span> =~ <span class="q">/\.pm$/</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>} .= <span class="q">&quot;\nreturn 1;\n&quot;</span> <span class="s">}</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="generate_perldoc-"></a><span class="k">sub </span><span class="m">generate_perldoc</span> <span class="s">{</span>                                                               <span class="c">#</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Generates the perldoc from a Perldoc object</span>
    <span class="c"># Returns: The formatted Perldoc [String]</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$pd_ref</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$perldoc</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$command</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$pd_ref</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$perldoc</span> .= <span class="q">&quot;\n\n&quot;</span> . <span class="i">$pd_ref</span>-&gt;{<span class="i">$command</span>} . <span class="q">&quot;\n\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$perldoc</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################################################################</span>
<a name="save_code-"></a><span class="k">sub </span><span class="m">save_code</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c"># Saves the code to the file</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$overwrite</span> = <span class="i">$args</span>{-<span class="w">overwrite</span>} || <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$perltidy</span> = <span class="i">$args</span>{-<span class="w">perltidy</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$newfile</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$overwrite</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$newfile</span> = <span class="i">$self</span>-&gt;{<span class="w">fullname</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$newfile</span> = <span class="q">&quot;$self-&gt;{fullname}.pod&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># print Dumper $self-&gt;{blocks};</span>

    <span class="k">open</span><span class="s">(</span> <span class="w">FILE</span><span class="cm">,</span> <span class="q">&quot;&gt;$newfile&quot;</span> <span class="s">)</span> || <span class="k">die</span><span class="s">(</span><span class="q">&quot;Cannot open $newfile&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">FILE</span> <span class="i">$self</span>-&gt;{<span class="w">generated_code</span>}<span class="sc">;</span>
    <span class="k">close</span><span class="s">(</span><span class="w">FILE</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$perltidy</span><span class="s">)</span> <span class="s">{</span><span class="q">`$perltidy $newfile`</span><span class="s">}</span>

<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># public_functions           #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># private_methods            #</span>
<span class="c">##############################</span>

<span class="c">#####################################################################</span>
<a name="_get_attributes-"></a><span class="k">sub </span><span class="m">_get_attributes</span> <span class="s">{</span>
<span class="c">#####################################################################</span>
    <span class="c">#</span>
    <span class="c">#Parse a constructor and gets the attributes of the class</span>
    <span class="c">#Returns: An array that contains the attributes of the class [HashRef] and the index to the attributes[HashRef]</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$code</span> = <span class="i">$args</span>{-<span class="w">code</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">%attributes</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%attributes_index</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$i</span> = <span class="n">1</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/\n/</span><span class="cm">,</span> <span class="i">$code</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/^\s*\#/</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/\$self-&gt;\{(.*?)\}(.*)\s*=\s*(.*)\s*;\s*\#*(.*)/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$name</span>  = <span class="q">&quot;$1$2&quot;</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$value</span> = <span class="i">$3</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$desc</span>  = <span class="i">$4</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$type</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$desc</span> =~ <span class="q">/(.*)\s*\[(.*)\]/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$desc</span> = <span class="i">$1</span><span class="sc">;</span>
                <span class="i">$type</span> = <span class="i">$2</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$desc</span> =~ <span class="q">s/^\s*(.*)\s*$/$1/</span><span class="sc">;</span>    <span class="c">#Get rid of leading and trailing spaces</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$attributes</span>{<span class="i">$name</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="i">$attributes</span>{<span class="i">$name</span>}{<span class="w">default</span>}     = <span class="i">$value</span><span class="sc">;</span>
                <span class="i">$attributes</span>{<span class="i">$name</span>}{<span class="w">description</span>} = <span class="i">$desc</span><span class="sc">;</span>
                <span class="i">$attributes</span>{<span class="i">$name</span>}{<span class="w">type</span>}        = <span class="i">$type</span><span class="sc">;</span>
                <span class="i">$attributes_index</span>{ <span class="i">$i</span>++ }       = <span class="i">$name</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="s">(</span> \<span class="i">%attributes</span><span class="cm">,</span> \<span class="i">%attributes_index</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># private_functions          #</span>
<span class="c">##############################</span>

<span class="c">###################################</span>
<span class="c"># Generate label for each section</span>
<span class="c"># Return : label [string]</span>
<span class="c">#################</span>
<a name="_section_label-"></a><span class="k">sub </span><span class="m">_section_label</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="k">my</span> <span class="i">$section</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$length</span> = <span class="n">30</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$label</span> = <span class="q">&quot;#&quot;</span> x <span class="i">$length</span><span class="sc">;</span>
    <span class="i">$label</span> .= <span class="q">&quot;\n\# &quot;</span><span class="sc">;</span>

    <span class="i">$label</span> .= <span class="k">sprintf</span> <span class="q">&quot;%-26s&quot;</span><span class="cm">,</span> <span class="i">$section</span><span class="sc">;</span>

    <span class="i">$label</span> .= <span class="q">&quot; \#\n&quot;</span><span class="sc">;</span>
    <span class="i">$label</span> .= <span class="q">&quot;\#&quot;</span> x <span class="n">30</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$label</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># main_footer                #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># perldoc_footer             #</span>
<span class="c">##############################</span>

</pre><p></p>
<hr />
<h1><a name="known_issues__uplink_">KNOWN ISSUES &lt;UPLINK&gt;</a></h1>
<p>None.</p>
<pre>
    =head1 FUTURE IMPROVEMENTS &lt;UPLINK&gt;</pre>
<p>None.</p>
<p>
</p>
<hr />
<h1><a name="future_improvements__uplink_">FUTURE IMPROVEMENTS &lt;UPLINK&gt;</a></h1>
<p>&lt;&lt;FUTURE IMPROVEMENTS&gt;&gt;</p>
<p>
</p>
<hr />
<h1><a name="authors__uplink_">AUTHORS &lt;UPLINK&gt;</a></h1>
<p>Ran Guin and Andy Chan: Michael Smith Genome Sciences Centre</p>
<p>
</p>
<hr />
<h1><a name="created__uplink_">CREATED &lt;UPLINK&gt;</a></h1>
<p>2003-07-14</p>
<p>
</p>
<hr />
<h1><a name="revision__uplink_">REVISION &lt;UPLINK&gt;</a></h1>
<p>$Id: Code.pm,v 1.36 2004/08/27 18:26:55 rguin Exp $ (Release: $Name:  $)</p>
<p>
</p>
<hr />
<h1><a name="known_issues__uplink_">KNOWN ISSUES &lt;UPLINK&gt;</a></h1>
<pre>

None.</pre>
<p>
</p>
<hr />
<h1><a name="future_improvements__uplink_">FUTURE IMPROVEMENTS &lt;UPLINK&gt;</a></h1>
<pre>

    Eventually this object will replace the existing GSDB.pm and DB_IO.pm. Also support for transaction will be added in the future.</pre>
<p>
</p>
<hr />
<h1><a name="authors__uplink_">AUTHORS &lt;UPLINK&gt;</a></h1>
<pre>

    Ran Guin, Andy Chan and J.R. Santos at the Canadas Michael Smith Genome Sciences Centre</pre>
<p>
</p>
<hr />
<h1><a name="created__uplink__20030905">CREATED &lt;UPLINK&gt;
    
    2003-09-05</a></h1>
<p>
</p>
<hr />
<h1><a name="revision__uplink___id__dbio_pm_v_1_107_2004_11_30_01_42_24_rguin_exp____release___name______cut">REVISION &lt;UPLINK&gt;
    
    $Id: DBIO.pm,v 1.107 2004/11/30 01:42:24 rguin Exp $ (Release: $Name:  $)
							 
=cut</a></h1>

<pre>
<span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<a name="EOF-"></a></pre></body>

</html>
