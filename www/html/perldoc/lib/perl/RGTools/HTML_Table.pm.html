<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>HTML_Table.pm</title>
<link rev="made" href="mailto:root@localhost" />
</head>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #F0F0F0;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
<body style="background-color: white">
<a name="-top-"></a>
<h1>HTML_Table.pm</h1>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name__uplink_">NAME &lt;UPLINK&gt;</a></li>
	<li><a href="#synopsis__uplink_">SYNOPSIS &lt;UPLINK&gt;</a></li>
	<li><a href="#description__uplink_">DESCRIPTION &lt;UPLINK&gt;</a></li>
	<li><a href="#known_issues__uplink_">KNOWN ISSUES &lt;UPLINK&gt;</a></li>
	<li><a href="#future_improvements__uplink_">FUTURE IMPROVEMENTS &lt;UPLINK&gt;</a></li>
	<li><a href="#authors__uplink_">AUTHORS &lt;UPLINK&gt;</a></li>
	<li><a href="#created__uplink_">CREATED &lt;UPLINK&gt;</a></li>
	<li><a href="#revision__uplink_">REVISION &lt;UPLINK&gt;</a></li>
</ul>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-HTML_Table-">package HTML_Table</a>
<ul>
<li><a href="#new-">new</a></li>
<li><a href="#rows-">rows</a></li>
<li><a href="#columns-">columns</a></li>
<li><a href="#Set_Header-">Set_Header</a></li>
<li><a href="#Set_Prefix-">Set_Prefix</a></li>
<li><a href="#Set_Autosort-">Set_Autosort</a></li>
<li><a href="#Set_Autosort_End_Skip-">Set_Autosort_End_Skip</a></li>
<li><a href="#Set_Suffix-">Set_Suffix</a></li>
<li><a href="#Set_HTML_Header-">Set_HTML_Header</a></li>
<li><a href="#Set_Header_Class-">Set_Header_Class</a></li>
<li><a href="#Set_Button_Colour-">Set_Button_Colour</a></li>
<li><a href="#Set_Column_Widths-">Set_Column_Widths</a></li>
<li><a href="#Set_Font-">Set_Font</a></li>
<li><a href="#Set_Class-">Set_Class</a></li>
<li><a href="#Set_Padding-">Set_Padding</a></li>
<li><a href="#Set_Spacing-">Set_Spacing</a></li>
<li><a href="#Set_Border-">Set_Border</a></li>
<li><a href="#Set_Width-">Set_Width</a></li>
<li><a href="#Set_Table_Alignment-">Set_Table_Alignment</a></li>
<li><a href="#Set_Alignment-">Set_Alignment</a></li>
<li><a href="#Set_VAlignment-">Set_VAlignment</a></li>
<li><a href="#Toggle_Colour-">Toggle_Colour</a></li>
<li><a href="#toggle-">toggle</a></li>
<li><a href="#Toggle_Colour_on_Column-">Toggle_Colour_on_Column</a></li>
<li><a href="#Set_Header_Colour-">Set_Header_Colour</a></li>
<li><a href="#Set_Line_Colour-">Set_Line_Colour</a></li>
<li><a href="#Set_Title-">Set_Title</a></li>
<li><a href="#Set_sub_title-">Set_sub_title</a></li>
<li><a href="#Set_sub_header-">Set_sub_header</a></li>
<li><a href="#init_table-">init_table</a></li>
<li><a href="#Set_Link-">Set_Link</a></li>
<li><a href="#Set_Column-">Set_Column</a></li>
<li><a href="#Set_Headers-">Set_Headers</a></li>
<li><a href="#Add_Header-">Add_Header</a></li>
<li><a href="#Load_From_Hash-">Load_From_Hash</a></li>
<li><a href="#Set_Row-">Set_Row</a></li>
<li><a href="#Set_Cell_Colour-">Set_Cell_Colour</a></li>
<li><a href="#Get_Cell_Colour-">Get_Cell_Colour</a></li>
<li><a href="#Set_Cell_Class-">Set_Cell_Class</a></li>
<li><a href="#Get_Cell_Spec-">Get_Cell_Spec</a></li>
<li><a href="#Set_Cell_Spec-">Set_Cell_Spec</a></li>
<li><a href="#Set_Column_Class-">Set_Column_Class</a></li>
<li><a href="#Set_Column_Colour-">Set_Column_Colour</a></li>
<li><a href="#Set_Row_Colour-">Set_Row_Colour</a></li>
<li><a href="#get_IDs-">get_IDs</a></li>
<li><a href="#load_hash-">load_hash</a></li>
<li><a href="#Printout-">Printout</a></li>
<li><a href="#print_to_csv-">print_to_csv</a></li>
<li><a href="#print_to_xls_native-">print_to_xls_native</a></li>
<li><a href="#_replace_links-">_replace_links</a></li>
<li><a href="#_strip_tags-">_strip_tags</a></li>
<li><a href="#_show_Tool_Tip-">_show_Tool_Tip</a></li>
</ul>
</li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<hr />
<pre><span class="c">##########################</span>
<span class="c">#</span>
<span class="c"># This module is used to simplify and standardize the formation of html tables</span>
<span class="c">#</span>
<span class="c"># Methods exist to include data one row at a time (Set_Row) , or one column at a time (Set_Column).</span>
<span class="c">#</span>
<span class="c"># Headers, settings, colours can also be specified using internal methods.</span>
<span class="c">#</span>
<span class="c"># Generated html file may be printout out automatically, returned via a string, or saved as a file.</span>
<span class="c"># Links may also be provided for 'printable' version of table.</span>
<span class="c">#</span>
<span class="c">###########################</span>
<a name="package-HTML_Table-"></a><span class="k">package </span><span class="i">HTML_Table</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># perldoc_header             #</span>
<span class="c">##############################</span>

</pre><p></p>
<hr />
<h1><a name="name__uplink_">NAME &lt;UPLINK&gt;</a></h1>
<p>HTML_Table.pm - This module is used to simplify and standardize the formation of html tables</p>
<p>
</p>
<hr />
<h1><a name="synopsis__uplink_">SYNOPSIS &lt;UPLINK&gt;</a></h1>
<pre>
        &lt;&lt;SYNOPSIS&gt;&gt;</pre>
<p>
</p>
<hr />
<h1><a name="description__uplink_">DESCRIPTION &lt;UPLINK&gt;</a></h1>
This module is used to simplify and standardize the formation of html tables <BR>Methods exist to include data one row at a time (Set_Row) , or one column at a time (Set_Column).<BR>Headers, settings, colours can also be specified using internal methods.<BR>Generated html file may be printout out automatically, returned via a string, or saved as a file.<BR><pre>
<span class="c">##############################</span>
<span class="c"># superclasses               #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># system_variables           #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># standard_modules_ref       #</span>
<span class="c">##############################</span>
<span class="k">use</span> <span class="w">CGI</span> <span class="q">qw(:standard)</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Data::Dumper</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># custom_modules_ref         #</span>
<span class="c">##############################</span>
<span class="k">use</span> <span class="w">RGTools::RGIO</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">SDB::HTML</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">RGTools::Web_Form</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># global_vars                #</span>
<span class="c">##############################</span>
<span class="k">use</span> <span class="w">vars</span> <span class="q">qw($scanner_mode)</span><span class="sc">;</span>    <span class="c">### optional global giving smaller display size...</span>
<span class="k">use</span> <span class="w">vars</span> <span class="q">qw($class_size)</span><span class="sc">;</span>

<span class="c">##############################</span>
<span class="c"># modular_vars               #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># constants                  #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># main_header                #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># constructor                #</span>
<span class="c">##############################</span>

<span class="c">############</span>
<a name="new-"></a><span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
<span class="c">############</span>
    <span class="k">my</span> <span class="i">$this</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$size_class</span> = <span class="i">$args</span>{-<span class="w">size</span>}   || <span class="i">$args</span>{-<span class="w">class</span>} || <span class="q">'small'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span>     = <span class="i">$args</span>{-<span class="w">colour</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$border</span>     = <span class="i">$args</span>{-<span class="w">border</span>} || <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$title</span>      = <span class="i">$args</span>{-<span class="w">title</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$headers</span>           = <span class="i">$args</span>{-<span class="w">headers</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>             = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$align</span>             = <span class="i">$args</span>{-<span class="w">align</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$padding</span>           = <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">padding</span>} ? <span class="i">$args</span>{-<span class="w">padding</span>} <span class="co">:</span> <span class="n">5</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$autosort</span>          = <span class="i">$args</span>{-<span class="w">autosort</span>}<span class="sc">;</span>                                <span class="c"># (Scalar) Flags all columns as sortable</span>
    <span class="k">my</span> <span class="i">$autosort_columns</span>  = <span class="i">$args</span>{-<span class="w">autosort_columns</span>} || <span class="k">undef</span><span class="sc">;</span>               <span class="c"># (ArrayRef) Array of columns that will be flagged as sortable. Counting starts at 0.</span>
    <span class="k">my</span> <span class="i">$autosort_end_skip</span> = <span class="i">$args</span>{-<span class="w">autosort_end_skip</span>}<span class="sc">;</span>                       <span class="c"># (Scalar) Number of rows to skip from the end of the table</span>
    <span class="k">my</span> <span class="i">$bgcolour</span>          = <span class="i">$args</span>{-<span class="w">bgcolour</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$table_id</span>          = <span class="i">$args</span>{-<span class="w">id</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$nowrap</span>            = <span class="i">$args</span>{-<span class="w">nowrap</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$debug</span>             = <span class="i">$args</span>{-<span class="w">debug</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$toggle</span> = <span class="n">1</span><span class="sc">;</span>
    <span class="i">$toggle</span> = <span class="i">$args</span>{-<span class="w">toggle</span>} <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">toggle</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$add_empty_cells</span> = <span class="n">1</span><span class="sc">;</span>
    <span class="i">$add_empty_cells</span> = <span class="i">$args</span>{-<span class="w">add_empty_cells</span>} <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">add_empty_cells</span>} <span class="s">)</span><span class="sc">;</span>    <span class="c"># (Scalar) Flag to enable or disable the addition of empty cells even if there is no text</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$class</span><span class="s">)</span> = <span class="k">ref</span><span class="s">(</span><span class="i">$this</span><span class="s">)</span> || <span class="i">$this</span><span class="sc">;</span>
    <span class="k">bless</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$class</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">title</span>}         = <span class="i">$title</span> || <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>}    = <span class="n">0</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">columns</span>}       = <span class="n">0</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">rows</span>}          = <span class="n">0</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">headers</span>}       = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">Hclass</span>}        = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}        = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">toggle_colour</span>} = <span class="i">$toggle</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">links</span>}         = <span class="n">0</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">common_class</span>}  = <span class="q">''</span><span class="sc">;</span>             <span class="c">### leave off by default.</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_type</span>}     = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_name</span>}     = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_value</span>}    = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_label</span>}    = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_spec</span>}     = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">IDs</span>}             = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">add_empty_cells</span>} = <span class="i">$add_empty_cells</span><span class="sc">;</span>

    <span class="c">### Print Options ###</span>

    <span class="i">$self</span>-&gt;{<span class="w">align</span>}       = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">valign</span>}      = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">Table_align</span>} = <span class="q">&quot;align='$align'&quot;</span> <span class="k">if</span> <span class="i">$align</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">table_align</span>} = <span class="q">&quot;align='left'&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">table_id</span>}    = <span class="q">&quot;id='$table_id'&quot;</span> <span class="k">if</span> <span class="i">$table_id</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">frame</span>}             = <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">padding</span>}           = <span class="q">&quot;cellpadding='$padding'&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">spacing</span>}           = <span class="q">&quot;cellspacing='0'&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">border</span>}            = <span class="q">&quot;border='0'&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">margin</span>}            = <span class="q">&quot;leftmargin='50'&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">width</span>}             = <span class="i">$width</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">autosort</span>}          = <span class="i">$autosort</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>}  = <span class="i">$autosort_columns</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">autosort_end_skip</span>} = <span class="i">$autosort_end_skip</span><span class="sc">;</span>

    <span class="c"># flag to turn on column span. This is defaulted to 0, but gets set to 1 once a -colspans argument is set in Set_Row</span>
    <span class="i">$self</span>-&gt;{<span class="w">colspan_def</span>} = <span class="n">0</span><span class="sc">;</span>

    <span class="c">#### 'scanner_mode' specific settings...</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$scanner_mode</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$width</span> ||= <span class="n">200</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">width</span>} = <span class="q">&quot;Width=$width&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">Tclass</span>} = <span class="q">&quot;class='vdarkbluebw'&quot;</span><span class="sc">;</span>    <span class="c">### title class ######</span>

    <span class="c">#   $self-&gt;{Tclass} = &quot;bgcolor = '#0000cc'&quot;;  	### title colour ######</span>
    <span class="i">$self</span>-&gt;{<span class="w">button_colour</span>} = <span class="q">&quot;lightblue&quot;</span><span class="sc">;</span>       <span class="c">### button colour ######</span>

    <span class="i">$self</span>-&gt;{<span class="w">Hcolour</span>} = <span class="q">&quot;bgcolor='#6699ff'&quot;</span><span class="sc">;</span>     <span class="c">### Header Colour (dark blue) #####</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$bgcolour</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}  = <span class="q">&quot;bgcolor='#ddddda'&quot;</span><span class="sc">;</span>    <span class="c">### Line Colour 1  (darker grey) #####</span>
                                                    <span class="c">#$self-&gt;{Lcolour} =  &quot;bgcolor='#d8d8d8'&quot;;  	### Line Colour 1  (grey) #####</span>
        <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>} = <span class="q">&quot;bgcolor='#eeeee8'&quot;</span><span class="sc">;</span>    <span class="c">### Line Colour 2  (lighter grey) #####</span>
                                                    <span class="c">#$self-&gt;{Lcolour2} = &quot;bgcolor='#ffffCC'&quot;;  	### Line Colour 2  (light yellow) #####</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$bgcolour</span> <span class="k">ne</span> <span class="q">'transparent'</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}  = <span class="q">&quot;bgcolor='$bgcolour'&quot;</span><span class="sc">;</span>    <span class="c">### Line Colour 1</span>
        <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>} = <span class="q">&quot;bgcolor='$bgcolour'&quot;</span><span class="sc">;</span>    <span class="c">### Line Colour 2</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">nowrap</span>} = <span class="i">$nowrap</span><span class="sc">;</span>

    <span class="c">#$self-&gt;{Hcolour} = &quot;bgcolor='#eeeefe'&quot;;    ### Header Colour #####</span>
    <span class="c">#$self-&gt;{Lcolour} = &quot;bgcolor='#eeeede'&quot;;  	### Line Colour 1 #####</span>
    <span class="c">#$self-&gt;{Lcolour2} = &quot;bgcolor='#eeeeee'&quot;;  	### Line Colour 2 #####</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$colour</span><span class="s">)</span>     <span class="s">{</span> <span class="i">$self</span><span class="i">-&gt;Set_Line_Colour</span><span class="s">(</span><span class="i">$colour</span><span class="s">)</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$size_class</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span><span class="i">-&gt;Set_Class</span><span class="s">(</span><span class="i">$size_class</span><span class="s">)</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$border</span><span class="s">)</span>     <span class="s">{</span> <span class="i">$self</span><span class="i">-&gt;Set_Border</span><span class="s">(</span><span class="i">$border</span><span class="s">)</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$headers</span><span class="s">)</span>    <span class="s">{</span> <span class="i">$self</span><span class="i">-&gt;Set_Headers</span><span class="s">(</span><span class="i">$headers</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">return</span> <span class="i">$self</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># public_methods             #</span>
<span class="c">##############################</span>

<a name="rows-"></a><span class="k">sub </span><span class="m">rows</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">rows</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="columns-"></a><span class="k">sub </span><span class="m">columns</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">columns</span>}<span class="sc">;</span>
<span class="s">}</span>

<span class="c">#############</span>
<span class="c">#</span>
<span class="c"># Define header (allows passing of css / js in header)</span>
<span class="c">#</span>
<span class="c">#############</span>
<a name="Set_Header-"></a><span class="k">sub </span><span class="m">Set_Header</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">header</span>} = <span class="i">$header</span><span class="sc">;</span>
<span class="s">}</span>
<span class="c">############</span>
<span class="c">#</span>
<span class="c"># Specify a header that is to be included prior to the table</span>
<span class="c">#</span>
<span class="c">#############</span>
<a name="Set_Prefix-"></a><span class="k">sub </span><span class="m">Set_Prefix</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$prefix</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">prefix</span>} = <span class="i">$prefix</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##################################</span>
<span class="c">#</span>
<span class="c"># Specify autosorting</span>
<span class="c">#</span>
<span class="c">##################################</span>
<a name="Set_Autosort-"></a><span class="k">sub </span><span class="m">Set_Autosort</span> <span class="s">{</span>
<span class="c">##################################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sort</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$sort</span> || <span class="s">(</span> <span class="i">$sort</span> =~ <span class="q">/^off$/i</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">autosort</span>} = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">autosort</span>} = <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">##################################</span>
<span class="c">#</span>
<span class="c"># Specify autosorting</span>
<span class="c">#</span>
<span class="c">##################################</span>
<a name="Set_Autosort_End_Skip-"></a><span class="k">sub </span><span class="m">Set_Autosort_End_Skip</span> <span class="s">{</span>
<span class="c">##################################</span>
    <span class="k">my</span> <span class="i">$self</span>          = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sort_end_skip</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">autosort_end_skip</span>} = <span class="i">$sort_end_skip</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">################</span>
<span class="c">#</span>
<span class="c"># Specify a footer that is to follow the table</span>
<span class="c">#</span>
<span class="c">#############</span>
<a name="Set_Suffix-"></a><span class="k">sub </span><span class="m">Set_Suffix</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$suffix</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">suffix</span>} = <span class="i">$suffix</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">##################</span>
<a name="Set_HTML_Header-"></a><span class="k">sub </span><span class="m">Set_HTML_Header</span> <span class="s">{</span>
<span class="c">##################</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">HTML_header</span>} = <span class="i">$header</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Specify a class for the headers</span>
<span class="c">#</span>
<span class="c">##################</span>
<a name="Set_Header_Class-"></a><span class="k">sub </span><span class="m">Set_Header_Class</span> <span class="s">{</span>
<span class="c">##################</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$Hclass</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$column</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Hclass</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="q">&quot;class='$Hclass'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">Hclass</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="q">&quot;class='$Hclass'&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Set colour for buttons that are generated within the table</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">###################</span>
<a name="Set_Button_Colour-"></a><span class="k">sub </span><span class="m">Set_Button_Colour</span> <span class="s">{</span>
<span class="c">###################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">button_colour</span>} = <span class="k">shift</span><span class="sc">;</span>    <span class="c">### button colour ######width</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Specify the column widths within the table</span>
<span class="c">#</span>
<span class="c">###########################</span>
<a name="Set_Column_Widths-"></a><span class="k">sub </span><span class="m">Set_Column_Widths</span> <span class="s">{</span>
<span class="c">###########################</span>
    <span class="k">my</span> <span class="i">$self</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$widths</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$columns</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@width_specs</span>  = <span class="i">@$widths</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column_specs</span> = <span class="k">scalar</span><span class="s">(</span><span class="i">@width_specs</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@column_index</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$columns</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">@column_index</span> = <span class="i">@$columns</span><span class="sc">;</span>    <span class="c">######## map to specified columns ########</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">@column_index</span> = <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span> - <span class="n">1</span> <span class="s">}</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$column_specs</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$index</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$index</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$index</span> - <span class="n">1</span> ] = <span class="q">&quot;width='1' &quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$index</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$column_specs</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$column_index</span>[ <span class="i">$index</span> - <span class="n">1</span> ] ] = <span class="q">&quot;width='&quot;</span> . <span class="i">$width_specs</span>[ <span class="i">$index</span> - <span class="n">1</span> ] . <span class="q">&quot;'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Define the body font</span>
<span class="c">#</span>
<span class="c">############</span>
<a name="Set_Font-"></a><span class="k">sub </span><span class="m">Set_Font</span> <span class="s">{</span>
<span class="c">############</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$font</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">Font</span>} .= <span class="q">&quot; $font&quot;</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">TFont</span>} = <span class="i">$self</span>-&gt;{<span class="w">Font</span>}<span class="sc">;</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Define the body class</span>
<span class="c">#</span>
<span class="c">############</span>
<a name="Set_Class-"></a><span class="k">sub </span><span class="m">Set_Class</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$thisclass</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">common_class</span>} = <span class="q">&quot;class='$thisclass'&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############</span>
<a name="Set_Padding-"></a><span class="k">sub </span><span class="m">Set_Padding</span> <span class="s">{</span>
<span class="c">##############</span>
    <span class="c">#</span>
    <span class="c"># set table padding</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$pad</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">padding</span>} = <span class="q">&quot;cellpadding='$pad'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############</span>
<a name="Set_Spacing-"></a><span class="k">sub </span><span class="m">Set_Spacing</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="c"># set table padding</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$spacing</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">spacing</span>} = <span class="q">&quot;cellspacing='$spacing'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#############</span>
<a name="Set_Border-"></a><span class="k">sub </span><span class="m">Set_Border</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="c">#</span>
    <span class="c"># Set table border</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$border</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">border</span>} = <span class="q">&quot;border='$border'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#############</span>
<a name="Set_Width-"></a><span class="k">sub </span><span class="m">Set_Width</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="c">#</span>
    <span class="c"># Set table width</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">width</span>} = <span class="q">&quot;Width='$width'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#####################</span>
<a name="Set_Table_Alignment-"></a><span class="k">sub </span><span class="m">Set_Table_Alignment</span> <span class="s">{</span>
<span class="c">#####################</span>
    <span class="c">#</span>
    <span class="c"># Set table alignment</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$alignment</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">table_align</span>} = <span class="q">&quot;align='$alignment'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">################</span>
<a name="Set_Alignment-"></a><span class="k">sub </span><span class="m">Set_Alignment</span> <span class="s">{</span>
<span class="c">################</span>
    <span class="c">#</span>
    <span class="c"># Set alignment for a specific column</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$alignment</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column</span>    = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$column</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">align</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="q">&quot;align='$alignment'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">align</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="q">&quot;align='$alignment'&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#################</span>
<a name="Set_VAlignment-"></a><span class="k">sub </span><span class="m">Set_VAlignment</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="c">#</span>
    <span class="c"># Set alignment for a specific column</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$valignment</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column</span>     = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$column</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">valign</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="q">&quot;valign='$valignment'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">valign</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="q">&quot;valign='$valignment'&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#######################</span>
<a name="Toggle_Colour-"></a><span class="k">sub </span><span class="m">Toggle_Colour</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="c">#</span>
    <span class="c"># specify colour toggling (default = 1)</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$toggle</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span>   <span class="s">(</span> <span class="i">$toggle</span> =~ <span class="q">/off/i</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$toggle</span> = <span class="n">0</span><span class="sc">;</span> <span class="s">}</span>
    <span class="k">else</span>                       <span class="s">{</span> <span class="i">$toggle</span> = <span class="n">1</span><span class="sc">;</span> <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">toggle_colour</span>} = <span class="i">$toggle</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#######################</span>
<a name="toggle-"></a><span class="k">sub </span><span class="m">toggle</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="c">#</span>
    <span class="c"># toggle the colour</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}<span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>} <span class="s">)</span> = <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>}<span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>} <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#######################</span>
<a name="Toggle_Colour_on_Column-"></a><span class="k">sub </span><span class="m">Toggle_Colour_on_Column</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="c">#</span>
    <span class="c"># specify colour toggling to occur when a particular column changes...</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$column</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">toggle_colour_on_column</span>} = <span class="i">$column</span><span class="sc">;</span> <span class="s">}</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">###########################</span>
<a name="Set_Header_Colour-"></a><span class="k">sub </span><span class="m">Set_Header_Colour</span> <span class="s">{</span>
<span class="c">###########################</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$colour</span> =~ <span class="q">/=/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Hcolour</span>} = <span class="i">$colour</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Hcolour</span>} = <span class="q">&quot;bgcolor='$colour'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

<span class="s">}</span>

<span class="c">#########################</span>
<a name="Set_Line_Colour-"></a><span class="k">sub </span><span class="m">Set_Line_Colour</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="c">#</span>
    <span class="c"># define default line colour(s) (for colour toggling)</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour1</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour2</span> = <span class="k">shift</span> || <span class="i">$colour1</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$colour1</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}  = <span class="q">&quot;bgcolor='$colour1'&quot;</span><span class="sc">;</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$colour2</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>} = <span class="q">&quot;bgcolor='$colour2'&quot;</span><span class="sc">;</span> <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#############</span>
<a name="Set_Title-"></a><span class="k">sub </span><span class="m">Set_Title</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="c">#</span>
    <span class="c"># Set Table Title</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">title</span>} = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$class</span>    = <span class="i">$args</span>{<span class="w">class</span>}<span class="sc">;</span>       <span class="c">### &lt;TD class=...&gt;</span>
    <span class="k">my</span> <span class="i">$bgcolour</span> = <span class="i">$args</span>{<span class="w">bgcolour</span>}<span class="sc">;</span>    <span class="c">### &lt;TD bgcolour=...&gt;</span>
    <span class="k">my</span> <span class="i">$fclass</span>   = <span class="i">$args</span>{<span class="w">fclass</span>}<span class="sc">;</span>      <span class="c">### &lt;FONT class=...&gt;</span>
    <span class="k">my</span> <span class="i">$fcolour</span>  = <span class="i">$args</span>{<span class="w">fcolour</span>}<span class="sc">;</span>     <span class="c">### &lt;FONT colour=...&gt;</span>
    <span class="k">my</span> <span class="i">$fsize</span>    = <span class="i">$args</span>{<span class="w">fsize</span>}<span class="sc">;</span>       <span class="c">### &lt;FONT size=...&gt;</span>
    <span class="k">my</span> <span class="i">$fstyle</span>   = <span class="i">$args</span>{<span class="w">fstyle</span>}<span class="sc">;</span>      <span class="c">### &lt;B&gt;,&lt;I&gt;, or &lt;U&gt; ...... in a comma-delimited list.</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$fsize</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Tfont</span>} .= <span class="q">&quot;size='$fsize' &quot;</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$class</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">Tclass</span>} = <span class="q">&quot;class='$class' &quot;</span><span class="sc">;</span>    <span class="c">### title class ######</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$bgcolour</span> || <span class="i">$fclass</span> || <span class="i">$fcolour</span> || <span class="i">$fsize</span> <span class="s">)</span> <span class="s">{</span>

        <span class="c">#$self-&gt;{Tclass} = '';                ### Do not use css if bgcolour, colour or size is provided.</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$bgcolour</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Tclass</span>} = <span class="q">&quot;bgcolor='$bgcolour' &quot;</span> <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$fclass</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Tfont</span>} .= <span class="q">&quot;class='$fclass' &quot;</span> <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$fcolour</span> || <span class="i">$fsize</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$fcolour</span><span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Tfont</span>} .= <span class="q">&quot;color='$fcolour' &quot;</span> <span class="s">}</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$fsize</span><span class="s">)</span>   <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">Tfont</span>} .= <span class="q">&quot;size='$fsize' &quot;</span> <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$fstyle</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$s</span> <span class="s">(</span> <span class="k">split</span> <span class="q">/,/</span><span class="cm">,</span> <span class="i">$fstyle</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$s</span> =~ <span class="q">/^([a-zA-z]{1}).*/</span><span class="sc">;</span>
                <span class="i">$self</span>-&gt;{<span class="w">Tstyle</span>} .= <span class="q">&quot;&lt;$1&gt;&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">################</span>
<a name="Set_sub_title-"></a><span class="k">sub </span><span class="m">Set_sub_title</span> <span class="s">{</span>
<span class="c">################</span>
    <span class="c">#</span>
    <span class="c"># Set Table Sub-Title</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[ <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>} ] = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$span</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span> = <span class="k">shift</span> || <span class="q">'vlightblue'</span><span class="sc">;</span>

    <span class="i">$span</span> ||= <span class="n">1</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">sub_title_span</span>}[ <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>} ] = <span class="i">$span</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$colour</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">unless</span> <span class="s">(</span> <span class="i">$colour</span> =~ <span class="q">/=/</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$colour</span> = <span class="q">&quot;class='$colour'&quot;</span><span class="sc">;</span> <span class="s">}</span>

        <span class="i">$self</span>-&gt;{<span class="w">STcolour</span>}[ <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>} ] = <span class="i">$colour</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>}++<span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">################</span>
<a name="Set_sub_header-"></a><span class="k">sub </span><span class="m">Set_sub_header</span> <span class="s">{</span>
<span class="c">################</span>
    <span class="c">#</span>
    <span class="c"># Specify sub header (anywhere in table - full columnspan)</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sub_header</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$spec</span>       = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">rows</span>}++<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span> = <span class="i">$self</span>-&gt;{<span class="w">rows</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">columns</span>} ||= <span class="n">1</span><span class="sc">;</span>    <span class="c">## set to single column if still empty.</span>
    <span class="i">$self</span>-&gt;{<span class="w">C0</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$sub_header</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$colour</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">unless</span> <span class="s">(</span> <span class="i">$colour</span> =~ <span class="q">/=/</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$colour</span> = <span class="q">&quot;class='$colour'&quot;</span><span class="sc">;</span> <span class="s">}</span>

        <span class="c">#unless ($colour=~/=/) {$colour =  &quot;bgcolor=$colour&quot;;}</span>
        <span class="i">$self</span>-&gt;{<span class="w">colour</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$colour</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$spec</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">row_spec</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$spec</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$self</span>-&gt;{<span class="w">row_type</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="q">'heading'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$fback</span> = <span class="i">$self</span>-&gt;{<span class="w">C0</span>}[ <span class="i">$row</span> - <span class="n">1</span> ]<span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##########################</span>
<a name="init_table-"></a><span class="k">sub </span><span class="m">init_table</span> <span class="s">{</span>
<span class="c">##########################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'title,right,class'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$title</span>   = <span class="i">$args</span>{-<span class="w">title</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$right</span>   = <span class="i">$args</span>{-<span class="w">right</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$class</span>   = <span class="i">$args</span>{-<span class="w">class</span>} || <span class="q">'small'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>   = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="q">'100%'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$toggle</span>  = <span class="i">$args</span>{ -<span class="i">toggle</span> } || <span class="q">'off'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span>  = <span class="i">$args</span>{-<span class="w">colour</span>} || <span class="q">'#ddddda'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour2</span> = <span class="i">$args</span>{-<span class="w">colour2</span>} || <span class="q">'#eeeee8'</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$table</span> = <span class="w">HTML_Table</span><span class="w">-&gt;new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="i">$table</span><span class="i">-&gt;Set_Class</span><span class="s">(</span><span class="i">$class</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$table</span><span class="i">-&gt;Set_Width</span><span class="s">(</span><span class="i">$width</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$table</span><span class="i">-&gt;Toggle_Colour</span><span class="s">(</span><span class="i">$toggle</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$table</span><span class="i">-&gt;Set_Line_Colour</span><span class="s">(</span> <span class="i">$colour</span><span class="cm">,</span> <span class="i">$colour2</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$title</span> = <span class="q">&quot;&lt;Table border=0 cellspacing=0 cellpadding=0 width=100%&gt;&lt;TR&gt;&lt;TD&gt;&lt;font size='-1'&gt;&lt;b&gt;$title&lt;/b&gt;&lt;/font&gt;&lt;/TD&gt;&lt;TD align=right class=$class&gt;$right&lt;/TD&gt;&lt;/TR&gt;&lt;/Table&gt;&quot;</span> <span class="k">if</span> <span class="i">$title</span><span class="sc">;</span>

    <span class="i">$table</span><span class="i">-&gt;Set_Title</span><span class="s">(</span>
        <span class="i">$title</span><span class="cm">,</span>
        <span class="w">bgcolour</span> <span class="cm">=&gt;</span> <span class="q">'#ccccff'</span><span class="cm">,</span>
        <span class="w">fclass</span>   <span class="cm">=&gt;</span> <span class="q">'small'</span><span class="cm">,</span>
        <span class="w">fstyle</span>   <span class="cm">=&gt;</span> <span class="q">'bold'</span>
    <span class="s">)</span> <span class="k">if</span> <span class="i">$title</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$table</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#################</span>
<a name="Set_Link-"></a><span class="k">sub </span><span class="m">Set_Link</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="c">#</span>
    <span class="c"># Specify form elements within table</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">%args</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">type</span>}    = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">name</span>}    = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">value</span>}   = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">label</span>}   = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">spec</span>}    = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">tip</span>}     = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$args</span>{-<span class="w">disable</span>} = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">LINK_type</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ]     = <span class="i">$args</span>{-<span class="w">type</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_name</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ]     = <span class="i">$args</span>{-<span class="w">name</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_value</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ]    = <span class="i">$args</span>{-<span class="w">value</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_label</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ]    = <span class="i">$args</span>{-<span class="w">label</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_spec</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ]     = <span class="i">$args</span>{-<span class="w">spec</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_tip</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ]      = <span class="i">$args</span>{-<span class="w">tip</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">LINK_disabled</span>}[ <span class="i">$self</span>-&gt;{<span class="w">links</span>} ] = <span class="i">$args</span>{-<span class="w">disable</span>}<span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">links</span>}++<span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">###################</span>
<a name="Set_Column-"></a><span class="k">sub </span><span class="m">Set_Column</span> <span class="s">{</span>
<span class="c">###################</span>
    <span class="c">#</span>
    <span class="c"># specify array of column values</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>       = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'values,column'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$value_list</span> = <span class="i">$args</span>{ -<span class="k">values</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column</span>     = <span class="i">$args</span>{-<span class="w">column</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$skip</span>       = <span class="i">$args</span>{-<span class="w">skip_rows</span>} || <span class="n">0</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@values</span> = <span class="i">@$value_list</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$index</span> = <span class="i">$self</span>-&gt;{<span class="w">columns</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">columns</span>}++<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$column</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>}[<span class="i">$index</span>] = <span class="i">$column</span><span class="sc">;</span>
        <span class="i">$index</span> = <span class="i">$column</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$self</span>-&gt;{<span class="w">headers</span>}[<span class="i">$index</span>] = <span class="q">&quot;C&quot;</span> . <span class="i">$index</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$num</span> = <span class="k">scalar</span><span class="s">(</span><span class="i">@values</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$num</span> + <span class="i">$skip</span> &gt; <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">rows</span>} = <span class="i">$num</span> + <span class="i">$skip</span><span class="sc">;</span>
    <span class="s">}</span>    <span class="c">## increase number of rows if needed.</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$num</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;C$index&quot;</span>}[ <span class="i">$row</span> + <span class="i">$skip</span> - <span class="n">1</span> ] = <span class="i">$values</span>[ <span class="i">$row</span> - <span class="n">1</span> ]<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">###############</span>
<a name="Set_Headers-"></a><span class="k">sub </span><span class="m">Set_Headers</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="c">#</span>
    <span class="c"># Specify array of Header text values</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>         = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header_list</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$column_class</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@headers</span> = <span class="i">@$header_list</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$index</span>   = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$header</span> <span class="s">(</span><span class="i">@headers</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>}[ <span class="i">$index</span>++ ] = <span class="i">$header</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#    $self-&gt;{columns}=$index;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$column_class</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">unless</span> <span class="s">(</span> <span class="i">$column_class</span> =~ <span class="q">/=/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$column_class</span> = <span class="q">&quot;class='$column_class'&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$index</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">Hclass</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] = <span class="i">$column_class</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#################</span>
<a name="Add_Header-"></a><span class="k">sub </span><span class="m">Add_Header</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$index</span>  = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$index</span> ||= <span class="k">int</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>} } <span class="s">)</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>}[ <span class="i">$index</span>++ ] = <span class="i">$header</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">######################################################################</span>
<span class="c"># Subroutine that allows loading a table from a hash</span>
<span class="c"># return: a reference to the hash (sorted if -sort_by option is true)</span>
<span class="c">####################</span>
<a name="Load_From_Hash-"></a><span class="k">sub </span><span class="m">Load_From_Hash</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$headers</span>   = <span class="i">$args</span>{-<span class="w">headers</span>}<span class="sc">;</span>         <span class="c"># (Arrayref) ordered list of column headers</span>
    <span class="k">my</span> <span class="i">$info</span>      = <span class="i">$args</span>{ - <span class="w">data</span> }<span class="sc">;</span>         <span class="c"># (Hashref), with keys as the column headers, and values as an arrayref of values for the rows</span>
    <span class="k">my</span> <span class="i">$form_name</span> = <span class="i">$args</span>{ - <span class="w">form_name</span> }<span class="sc">;</span>    <span class="c"># (String) the name of the form that the table resides (needed for sorting)</span>
    <span class="k">my</span> <span class="i">$sort_by</span>   = <span class="i">$args</span>{-<span class="w">sort_by</span>}<span class="sc">;</span>         <span class="c"># (String) the header to sort the hash by</span>
    <span class="k">my</span> <span class="i">$order</span>     = <span class="i">$args</span>{-<span class="w">order</span>}<span class="sc">;</span>           <span class="c"># (String) sort order. One of 'asc' or 'desc'</span>

    <span class="c"># get size of rows</span>
    <span class="k">my</span> <span class="i">@first_array</span> = <span class="k">values</span><span class="s">(</span> <span class="i">%</span>{<span class="i">$info</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$size</span>        = <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$first_array</span>[<span class="n">0</span>] } <span class="s">)</span><span class="sc">;</span>

    <span class="c"># freeze the hash and the header array</span>
    <span class="k">print</span> <span class="i">&amp;RGTools::RGIO::Safe_Freeze</span><span class="s">(</span>
        -<span class="w">name</span>   <span class="cm">=&gt;</span> <span class="q">&quot;html_table_headers&quot;</span><span class="cm">,</span>
        -<span class="w">value</span>  <span class="cm">=&gt;</span> <span class="i">$headers</span><span class="cm">,</span>
        -<span class="w">format</span> <span class="cm">=&gt;</span> <span class="q">&quot;hidden&quot;</span><span class="cm">,</span>
        -<span class="w">encode</span> <span class="cm">=&gt;</span> <span class="n">1</span>
    <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">&amp;RGTools::RGIO::Safe_Freeze</span><span class="s">(</span>
        -<span class="w">name</span>   <span class="cm">=&gt;</span> <span class="q">&quot;html_table_hash&quot;</span><span class="cm">,</span>
        -<span class="w">value</span>  <span class="cm">=&gt;</span> <span class="i">$info</span><span class="cm">,</span>
        -<span class="w">format</span> <span class="cm">=&gt;</span> <span class="q">&quot;hidden&quot;</span><span class="cm">,</span>
        -<span class="w">encode</span> <span class="cm">=&gt;</span> <span class="n">1</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">print</span> <span class="q">&quot;&lt;input type='hidden' name='Sort_Column' id='Sort_Column'/&gt;&quot;</span><span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot;&lt;input type='hidden' name='Order_By' id='Order_By'/&gt;&quot;</span><span class="sc">;</span>

    <span class="c"># modify header names with links</span>
    <span class="k">my</span> <span class="i">@submit_headers</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$header</span> <span class="s">(</span><span class="i">@$headers</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$onClick</span> = <span class="q">qq{document.$form_name.Sort_Column.value=&quot;$header&quot;; document.$form_name.Order_By.value=&quot;Sort&quot;; document.$form_name.submit(); return false;}</span><span class="sc">;</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@submit_headers</span><span class="cm">,</span> <span class="q">&quot;&lt;a href='' onclick='$onClick'&gt;$header&lt;/a&gt;&quot;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">### Sort algorithm</span>
    <span class="c"># put everything that needs to be sorted into a convenient hash</span>
    <span class="k">my</span> <span class="i">%sort_hash</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$has_letters</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$index</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$size</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$value</span> = <span class="i">$info</span>-&gt;{<span class="i">$sort_by</span>}[ <span class="i">$index</span> - <span class="n">1</span> ]<span class="sc">;</span>
        <span class="i">$sort_hash</span>{ <span class="i">$index</span> - <span class="n">1</span> } = <span class="i">$value</span><span class="sc">;</span>
        <span class="i">$has_letters</span> = <span class="n">1</span> <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> !<span class="s">(</span><span class="i">$has_letters</span><span class="s">)</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="i">$value</span> !~ <span class="q">/\d+/</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># sort the hash by value</span>
    <span class="k">my</span> <span class="i">@sorted_keys</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sort_func</span><span class="sc">;</span>

    <span class="c"># sort lexicographically if anything has letters in the values of the hash</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$has_letters</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$order</span> <span class="k">eq</span> <span class="q">'desc'</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$sort_func</span> = <span class="k">sub</span> <span class="s">{</span> <span class="i">$sort_hash</span>{<span class="i">$b</span>} <span class="k">cmp</span> <span class="i">$sort_hash</span>{<span class="i">$a</span>} <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$sort_func</span> = <span class="k">sub</span> <span class="s">{</span> <span class="i">$sort_hash</span>{<span class="i">$a</span>} <span class="k">cmp</span> <span class="i">$sort_hash</span>{<span class="i">$b</span>} <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$order</span> <span class="k">eq</span> <span class="q">'desc'</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$sort_func</span> = <span class="k">sub</span> <span class="s">{</span> <span class="i">$sort_hash</span>{<span class="i">$b</span>} &lt;=&gt; <span class="i">$sort_hash</span>{<span class="i">$a</span>} <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$sort_func</span> = <span class="k">sub</span> <span class="s">{</span> <span class="i">$sort_hash</span>{<span class="i">$a</span>} &lt;=&gt; <span class="i">$sort_hash</span>{<span class="i">$b</span>} <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="i">$sort_func</span> <span class="s">(</span> <span class="k">keys</span><span class="s">(</span><span class="i">%sort_hash</span><span class="s">)</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@sorted_keys</span><span class="cm">,</span> <span class="i">$key</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># sort everything else using the sorted array keys as a slice</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$header</span> <span class="s">(</span> <span class="i">@</span>{<span class="i">$headers</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">@</span>{ <span class="i">$info</span>-&gt;{<span class="i">$header</span>} } = <span class="i">@</span>{ <span class="i">$info</span>-&gt;{<span class="i">$header</span>} }[<span class="i">@sorted_keys</span>]<span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># set headers</span>
    <span class="i">$self</span><span class="i">-&gt;Set_Headers</span><span class="s">(</span> \<span class="i">@submit_headers</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c"># set data</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$index</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$size</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$row</span> = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$header</span> <span class="s">(</span><span class="i">@$headers</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{<span class="i">$row</span>}<span class="cm">,</span> <span class="i">$info</span>-&gt;{<span class="i">$header</span>}[ <span class="i">$index</span> - <span class="n">1</span> ] <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$self</span><span class="i">-&gt;Set_Row</span><span class="s">(</span><span class="i">$row</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#################</span>
<a name="Set_Row-"></a><span class="k">sub </span><span class="m">Set_Row</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="c">#</span>
    <span class="c"># Specify array of Row values</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">$self</span>        = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>        = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'value_list,colour,spec,toggle,repeat,colspans'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$value_list</span>  = <span class="i">$args</span>{-<span class="w">value_list</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span>      = <span class="i">$args</span>{-<span class="w">colour</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$spec</span>        = <span class="i">$args</span>{-<span class="w">spec</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$toggle</span>      = <span class="i">$args</span>{<span class="q">'-toggle'</span>}<span class="sc">;</span>                                                                <span class="c">## allow user to set the bgcolor of the row to the same color as the previous row</span>
    <span class="k">my</span> <span class="i">$repeat</span>      = <span class="i">$args</span>{-<span class="w">repeat</span>} || <span class="n">0</span><span class="sc">;</span>                                                             <span class="c">## allow user to repeat the current row</span>
    <span class="k">my</span> <span class="i">$no_tool_tip</span> = <span class="i">$args</span>{<span class="q">'-no_tool_tip'</span>}<span class="sc">;</span>                                                           <span class="c">## prevent the &quot;Remove this Row&quot; and &quot;Duplicate This row&quot; tooltips from showing up</span>
    <span class="k">my</span> <span class="i">$clone_index</span> = <span class="i">$args</span>{-<span class="w">clone_index</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colspans</span>    = <span class="i">$args</span>{<span class="q">'-colspans'</span>}<span class="sc">;</span>                                                              <span class="c"># (ArrayRef) [Optional] For each cell in this row, define its column span. If not defined, defaults to 1 per cell.</span>

    <span class="k">my</span> <span class="i">@values</span>  = <span class="i">@$value_list</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$columns</span> = <span class="k">scalar</span><span class="s">(</span><span class="i">@values</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$repeat</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$columns</span>++<span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$colspans</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">colspan_def</span>} = <span class="n">1</span> <span class="k">if</span> <span class="s">(</span> !<span class="i">$self</span>-&gt;{<span class="w">colspan_def</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">columns</span>} &lt; <span class="i">$columns</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$self</span>-&gt;{<span class="w">columns</span>} = <span class="i">$columns</span><span class="sc">;</span> <span class="s">}</span>

    <span class="c">#    if (!$row) {</span>
    <span class="k">my</span> <span class="i">$row</span> = <span class="i">$self</span>-&gt;{<span class="w">rows</span>} + <span class="n">1</span><span class="sc">;</span>

    <span class="c">#}</span>
    <span class="k">my</span> <span class="i">$column</span> = <span class="n">0</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$value</span> <span class="s">(</span><span class="i">@values</span><span class="s">)</span> <span class="s">{</span>
        <span class="c">### if no headers... set headers to column index ###</span>
        <span class="k">if</span> <span class="s">(</span> !<span class="i">$self</span>-&gt;{<span class="w">headers</span>}[<span class="i">$column</span>] <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">headers</span>}[<span class="i">$column</span>] = <span class="q">&quot;C$column&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;C$column&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$value</span><span class="sc">;</span>

        <span class="c"># store column spans</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$colspans</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="q">'colspan'</span>}{ <span class="q">&quot;($row,&quot;</span> . <span class="s">(</span> <span class="i">$column</span> + <span class="n">1</span> <span class="s">)</span> . <span class="q">&quot;)&quot;</span> } = <span class="i">$colspans</span>-&gt;[<span class="i">$column</span>]<span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="q">'colspan'</span>}{ <span class="q">&quot;($row,&quot;</span> . <span class="s">(</span> <span class="i">$column</span> + <span class="n">1</span> <span class="s">)</span> . <span class="q">&quot;)&quot;</span> } = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="i">$column</span>++<span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">## &lt;CONSTRUCTION&gt; - this is way to customized to be in this module - any way of removing the local dependencies ?? ## &lt;CUSTOM&gt;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$repeat</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$A_highlight</span> = <span class="q">&quot;lightgreen&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$R_highlight</span> = <span class="q">&quot;yellow&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$ci</span>          = <span class="i">$clone_index</span> || <span class="i">$row</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">row_attr</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] .= <span class="q">&quot; clone_index = $ci&quot;</span><span class="sc">;</span>    <span class="c">### use specified clone index if given</span>
        <span class="i">$self</span>-&gt;{<span class="w">clone_index</span>}{<span class="i">$row</span>} = <span class="i">$row</span><span class="sc">;</span>                        <span class="c">### keep track of the row indices if they exist.</span>

        <span class="k">my</span> <span class="i">$button_size</span> = <span class="n">12</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$no_tool_tip</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="q">&quot;C$column&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">&amp;RGTools::Web_Form::Submit_Image</span><span class="s">(</span>
                -<span class="w">src</span>     <span class="cm">=&gt;</span> <span class="q">'/SDB/images/icons/plus.gif'</span><span class="cm">,</span>
                -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="q">'Add'</span><span class="cm">,</span>
                -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">'cloneRow(this);return false;'</span><span class="cm">,</span>
                -<span class="w">width</span>   <span class="cm">=&gt;</span> <span class="i">$button_size</span><span class="cm">,</span>
                -<span class="w">height</span>  <span class="cm">=&gt;</span> <span class="i">$button_size</span>
                <span class="s">)</span>
                . <span class="q">' '</span>
                . <span class="i">&amp;RGTools::Web_Form::Submit_Image</span><span class="s">(</span>
                -<span class="w">src</span>     <span class="cm">=&gt;</span> <span class="q">'/SDB/images/icons/minus.gif'</span><span class="cm">,</span>
                -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="q">'Remove'</span><span class="cm">,</span>
                -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">'removeRow(this); return false;'</span><span class="cm">,</span>
                -<span class="w">width</span>   <span class="cm">=&gt;</span> <span class="i">$button_size</span><span class="cm">,</span>
                -<span class="w">height</span>  <span class="cm">=&gt;</span> <span class="i">$button_size</span>
                <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="q">&quot;C$column&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">&amp;Show_Tool_Tip</span><span class="s">(</span>
                <span class="i">RGTools::Web_Form::Submit_Image</span><span class="s">(</span>
                    -<span class="w">src</span>     <span class="cm">=&gt;</span> <span class="q">'/SDB/images/icons/plus.gif'</span><span class="cm">,</span>
                    -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="q">'Add'</span><span class="cm">,</span>
                    -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">'cloneRow(this);return false;'</span><span class="cm">,</span>
                    -<span class="w">width</span>   <span class="cm">=&gt;</span> <span class="i">$button_size</span><span class="cm">,</span>
                    -<span class="w">height</span>  <span class="cm">=&gt;</span> <span class="i">$button_size</span>
                <span class="s">)</span><span class="cm">,</span>
                <span class="q">&quot;Duplicate this row&quot;</span>
                <span class="s">)</span>
                . <span class="q">' '</span>
                . <span class="i">&amp;Show_Tool_Tip</span><span class="s">(</span>
                <span class="i">RGTools::Web_Form::Submit_Image</span><span class="s">(</span>
                    -<span class="w">src</span>     <span class="cm">=&gt;</span> <span class="q">'/SDB/images/icons/minus.gif'</span><span class="cm">,</span>
                    -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="q">'Remove'</span><span class="cm">,</span>
                    -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">'removeRow(this); return false;'</span><span class="cm">,</span>
                    -<span class="w">width</span>   <span class="cm">=&gt;</span> <span class="i">$button_size</span><span class="cm">,</span>
                    -<span class="w">height</span>  <span class="cm">=&gt;</span> <span class="i">$button_size</span>
                <span class="s">)</span><span class="cm">,</span>
                <span class="q">&quot;Remove this row&quot;</span>
                <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>

    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">rows</span>}++<span class="sc">;</span>

    <span class="c">## set the bgcolor of the row to the same color as the previous row</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$toggle</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> !<span class="i">$toggle</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">colour</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>}<span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$colour</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$colour</span> =~ <span class="q">/\=/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">row_class</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$colour</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$self</span>-&gt;{<span class="w">row_class</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="q">&quot;class='$colour'&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$spec</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">row_spec</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="i">$spec</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$self</span>-&gt;{<span class="w">row_type</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] = <span class="q">'data'</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="Set_Cell_Colour-"></a><span class="k">sub </span><span class="m">Set_Cell_Colour</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} =~ <span class="q">s /bgcolor\s*=\s*\S+//ig</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} .= <span class="q">&quot; bgcolor='$colour'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="Get_Cell_Colour-"></a><span class="k">sub </span><span class="m">Get_Cell_Colour</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>  = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$colour</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="Set_Cell_Class-"></a><span class="k">sub </span><span class="m">Set_Cell_Class</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$thisclass</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} .= <span class="q">&quot; class='$thisclass'&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>
<span class="c">#########################</span>
<a name="Get_Cell_Spec-"></a><span class="k">sub </span><span class="m">Get_Cell_Spec</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>  = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$spec</span> = <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$spec</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="Set_Cell_Spec-"></a><span class="k">sub </span><span class="m">Set_Cell_Spec</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$spec</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} .= <span class="q">&quot; $spec &quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="Set_Column_Class-"></a><span class="k">sub </span><span class="m">Set_Column_Class</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$thisclass</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$class</span> = <span class="i">$thisclass</span><span class="sc">;</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="i">$thisclass</span> =~ <span class="q">/=/</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$class</span> = <span class="q">&quot; class='$thisclass'&quot;</span> <span class="s">}</span>

    <span class="k">for</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$index</span> = <span class="i">$row</span> - <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} .= <span class="i">$class</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#############################################</span>
<span class="c"># Set colour for entire column</span>
<span class="c"># (should be done AFTER table filled in)</span>
<span class="c">#########################</span>
<a name="Set_Column_Colour-"></a><span class="k">sub </span><span class="m">Set_Column_Colour</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>        = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$thiscolour</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$rows</span>       = <span class="k">shift</span> || <span class="i">$self</span>-&gt;{<span class="w">rows</span>}<span class="sc">;</span>

    <span class="k">for</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$rows</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} =~ <span class="q">s /bgcolor\s*=\s*\S+//ig</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} .= <span class="q">&quot; bgcolor='$thiscolour'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="q">'column_colour'</span>}{<span class="i">$col</span>} = <span class="i">$thiscolour</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="Set_Row_Colour-"></a><span class="k">sub </span><span class="m">Set_Row_Colour</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$self</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>        = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$thiscolour</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">for</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} =~ <span class="q">s /bgcolor\s*=\s*\S+//ig</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$col)&quot;</span>} .= <span class="q">&quot; bgcolor='$thiscolour'&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#############</span>
<a name="get_IDs-"></a><span class="k">sub </span><span class="m">get_IDs</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$col</span>  = <span class="i">$args</span>{-<span class="w">col</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$row</span>  = <span class="i">$args</span>{-<span class="w">row</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">@ids</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$col</span> &amp;&amp; <span class="i">$row</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@ids</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">IDs</span>}[<span class="i">$row</span>][<span class="i">$col</span>] <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span><span class="i">$col</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@ids</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">IDs</span>}[<span class="i">$row</span>][<span class="i">$col</span>] <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span><span class="i">$row</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@ids</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">IDs</span>}[<span class="i">$row</span>][<span class="i">$col</span>] <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
    <span class="s">}</span>
    <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span> =~ <span class="q">/(\d+)/</span><span class="sc">;</span> <span class="i">$_</span> = <span class="i">$1</span><span class="sc">;</span> <span class="s">}</span> <span class="i">@ids</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">@ids</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">######################</span>
<span class="c">#</span>
<span class="c"># Load the Table object with a hash (keys = headers)</span>
<span class="c"># (each key should point to an array of similar length - comprising the columns)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">##################</span>
<a name="load_hash-"></a><span class="k">sub </span><span class="m">load_hash</span> <span class="s">{</span>
<span class="c">##################</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'hash,order'</span><span class="cm">,</span> -<span class="w">mandatory</span> <span class="cm">=&gt;</span> <span class="q">'hash'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$hash_ref</span>  = <span class="i">$args</span>{-<span class="w">hash</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$order_ref</span> = <span class="i">$args</span>{-<span class="w">order</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">%hash</span> = <span class="i">%$hash_ref</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@order</span><span class="sc">;</span>
    <span class="k">if</span>   <span class="s">(</span><span class="i">$order_ref</span><span class="s">)</span> <span class="s">{</span> <span class="i">@order</span> = <span class="i">@$order_ref</span> <span class="s">}</span>
    <span class="k">else</span>              <span class="s">{</span> <span class="i">@order</span> = <span class="k">sort</span> <span class="k">keys</span> <span class="i">%hash</span> <span class="s">}</span>

    <span class="i">$self</span><span class="i">-&gt;Set_Headers</span><span class="s">(</span> \<span class="i">@order</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span><span class="i">@order</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">unless</span> <span class="s">(</span> <span class="k">ref</span> <span class="i">$hash</span>{<span class="i">$key</span>} <span class="k">eq</span> <span class="q">'ARRAY'</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">return</span> <span class="k">err</span> <span class="s">(</span> <span class="q">&quot;Keys must point to arrays of similar length.  $key is &quot;</span> . <span class="k">ref</span> <span class="i">$hash</span>{<span class="i">$key</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">my</span> <span class="i">@array</span> = <span class="i">@</span>{ <span class="i">$hash</span>{<span class="i">$key</span>} }<span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;Set_Column</span><span class="s">(</span> <span class="s">[</span><span class="i">@array</span><span class="s">]</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<span class="c">#</span>
<span class="c"># Printout table (usually final call used to generate table)</span>
<span class="c"># &lt;snip&gt;</span>
<span class="c"># Examples:</span>
<span class="c">#     $Table-&gt;Printout();  ## standard printout</span>
<span class="c">#</span>
<span class="c">#     my $table = $Table-&gt;Printout(0);  ## (saves table to scalar, but not printed)</span>
<span class="c">#</span>
<span class="c">#     my $table = $Table-&gt;Printout($filename);   ## writes table to $filename (.html file)</span>
<span class="c">#     ...</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">####################</span>
<a name="Printout-"></a><span class="k">sub </span><span class="m">Printout</span> <span class="s">{</span>
<span class="c">####################</span>
    <span class="k">my</span> <span class="i">$self</span>              = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>              = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'filename,header,suppress'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$nowrap</span>            = <span class="i">$args</span>{-<span class="w">nowrap</span>} || <span class="i">$self</span>-&gt;{<span class="w">nowrap</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$filename</span>          = <span class="i">$args</span>{-<span class="w">filename</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$Table_header</span>      = <span class="i">$args</span>{-<span class="w">header</span>} || <span class="i">$self</span>-&gt;{<span class="w">header</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$suppress_printing</span> = <span class="i">$args</span>{-<span class="w">suppress</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>              = <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$randname</span>          = <span class="i">$args</span>{-<span class="w">randname</span>} || <span class="n">0</span><span class="sc">;</span>

    <span class="i">$nowrap</span> = <span class="q">'nowrap'</span> <span class="k">if</span> <span class="i">$nowrap</span><span class="sc">;</span>

    <span class="c">## set column colours after table is filled in ###</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">'column_colour'</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$self</span>-&gt;{<span class="q">'column_colour'</span>} } <span class="s">)</span> <span class="s">{</span>
            <span class="i">$self</span><span class="i">-&gt;Set_Column_Colour</span><span class="s">(</span> <span class="i">$col</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="q">'column_colour'</span>}{<span class="i">$col</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="c"># generate a random number to use as a table name</span>
    <span class="k">if</span> <span class="s">(</span> !<span class="i">$randname</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$randname</span> = <span class="k">rand</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

        <span class="c"># get the eight least significant figures</span>
        <span class="i">$randname</span> = <span class="k">substr</span><span class="s">(</span> <span class="i">$randname</span><span class="cm">,</span> <span class="n">-8</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$ind1</span><span class="cm">,</span> <span class="i">$ind2</span><span class="cm">,</span> <span class="i">$ind3</span> <span class="s">)</span> = <span class="s">(</span> <span class="q">&quot;\t&quot;</span><span class="cm">,</span> <span class="q">&quot;\t\t&quot;</span><span class="cm">,</span> <span class="q">&quot;\t\t\t&quot;</span> <span class="s">)</span><span class="sc">;</span>    <span class="c">## variables for formatting output</span>

    <span class="i">$class_size</span> = <span class="q">&quot;small&quot;</span><span class="sc">;</span>                                      <span class="c">## for reduced size view...</span>

    <span class="k">my</span> <span class="i">$class_on</span><span class="sc">;</span>                                               <span class="c">### set class is specified as common (</span>
    <span class="k">my</span> <span class="i">$class_off</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">common_class</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$class_on</span>  = <span class="q">&quot;&lt;sPaN $self-&gt;{common_class}&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$class_off</span> = <span class="q">&quot;&lt;/sPaN&gt;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$URL_path</span><span class="sc">;</span>

<span class="c">#### Custom adjustment ##### &lt;CONSTRUCTION&gt;  ##... requires altering of filename to URL path...</span>
    <span class="k">if</span>   <span class="s">(</span> <span class="i">$filename</span> =~ <span class="q">m|\/(dynamic\/.*)|</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$URL_path</span> = <span class="i">$1</span><span class="sc">;</span> <span class="s">}</span>
    <span class="k">else</span>                                     <span class="s">{</span> <span class="i">$URL_path</span> = <span class="i">$filename</span><span class="sc">;</span> <span class="s">}</span>

    <span class="k">my</span> <span class="i">$print_string</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">valign</span>}[ <span class="i">$col</span> - <span class="n">1</span> ] ||= <span class="q">''</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">align</span>}[ <span class="i">$col</span> - <span class="n">1</span> ]  ||= <span class="q">''</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">prefix</span>} <span class="s">)</span> <span class="s">{</span> <span class="i">$print_string</span> .= <span class="i">$self</span>-&gt;{<span class="w">prefix</span>} <span class="s">}</span>

    <span class="k">my</span> <span class="i">$font_string</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">Font</span>} <span class="s">)</span> <span class="s">{</span> <span class="i">$font_string</span> = <span class="q">&quot;Font &quot;</span> . <span class="i">$self</span>-&gt;{<span class="w">Font</span>}<span class="sc">;</span> <span class="s">}</span>

    <span class="i">$print_string</span> .= <span class="q">&quot;\n&lt;Table $self-&gt;{table_id} $self-&gt;{padding} $self-&gt;{spacing} $self-&gt;{border} $self-&gt;{width} $self-&gt;{margin} $self-&gt;{Table_align}&gt;\n&quot;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">title</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$closing_style_tag</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">Tstyle</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$closing_style_tag</span> = <span class="i">$self</span>-&gt;{<span class="w">Tstyle</span>}<span class="sc">;</span>
            <span class="i">$closing_style_tag</span> =~ <span class="q">s/&lt;/&lt;\//g</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;TR&gt;\n$ind2&lt;TD $nowrap colspan=$self-&gt;{columns} $self-&gt;{Tclass} valign=centre&gt;\n$ind3&lt;FONT $self-&gt;{Tfont}&gt;$self-&gt;{Tstyle}&quot;</span><span class="sc">;</span>
        <span class="i">$print_string</span> .= <span class="i">$self</span>-&gt;{<span class="w">title</span>} . <span class="q">&quot;$closing_style_tag&lt;/FONT&gt;\n$ind2&lt;/TD&gt;\n$ind1&lt;/TR&gt;\n$ind1&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;TR&gt;\n$ind1&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$index</span> = <span class="n">0</span><span class="sc">;</span>
        <span class="k">while</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[<span class="i">$index</span>] <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;$ind2&lt;TD $nowrap colspan=$self-&gt;{sub_title_span}[$index] $self-&gt;{STcolour}[$index]&gt;\n&quot;</span><span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[<span class="i">$index</span>]<span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;$ind2&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>
            <span class="i">$index</span>++<span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;/TR&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># set autosort columns</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">autosort</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} }<span class="cm">,</span> <span class="i">$column</span> - <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="c">## generate list of random ids...##</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">IDs</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="k">my</span> <span class="i">$id</span> = <span class="k">substr</span><span class="s">(</span> <span class="k">rand</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="n">-8</span> <span class="s">)</span><span class="sc">;</span>    <span class="c">## random integer</span>
                <span class="i">$self</span>-&gt;{<span class="w">IDs</span>}[<span class="i">$row</span>][<span class="i">$col</span>] = <span class="q">&quot;id='$id'&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span> <span class="i">Message</span><span class="s">(</span><span class="q">&quot;no id&quot;</span><span class="s">)</span><span class="sc">;</span> <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>} } <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;TR $self-&gt;{Hcolour}&gt;\n&quot;</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$sortable</span>     = <span class="n">0</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$colzeroindex</span> = <span class="i">$column</span> - <span class="n">1</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} &amp;&amp; <span class="k">grep</span><span class="s">(</span> <span class="q">/$colzeroindex/</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} } <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$sortable</span> = <span class="n">1</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;$ind2&lt;TD $nowrap $self-&gt;{IDs}[0][$column] $self-&gt;{Hclass}[$column-1] $self-&gt;{Cwidth}[$column-1] $font_string&gt;\n$ind3 $class_on &quot;</span><span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;&lt;a href='' onclick='return mergesort(&quot;</span> . <span class="s">(</span> <span class="i">$column</span> - <span class="n">1</span> <span class="s">)</span> . <span class="q">&quot;,$randname)'&gt;&quot;</span> <span class="k">if</span> <span class="s">(</span><span class="i">$sortable</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>}[ <span class="i">$column</span> - <span class="n">1</span> ]<span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;&lt;/a&gt;&quot;</span> <span class="k">if</span> <span class="s">(</span><span class="i">$sortable</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;$class_off&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;/TR&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">my</span> <span class="i">$colour</span>     = <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link_index</span> = <span class="n">0</span><span class="sc">;</span>                  <span class="c">### index links</span>
                                         <span class="c"># print body tag</span>
    <span class="i">$self</span>-&gt;{<span class="w">link_index</span>} = <span class="n">0</span><span class="sc">;</span>
    <span class="i">$print_string</span> .= <span class="q">&quot;\n&lt;TBODY id = $randname&gt;\n&quot;</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">toggle_colour_on_column</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$check</span> = <span class="i">$self</span>-&gt;{<span class="w">toggle_colour_on_column</span>} - <span class="n">1</span><span class="sc">;</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="i">$row</span> &lt; <span class="n">2</span> || <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="q">&quot;C$check&quot;</span>}[ <span class="i">$row</span> - <span class="n">2</span> ] <span class="k">eq</span> <span class="i">$self</span>-&gt;{<span class="q">&quot;C$check&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">colour</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="w">colour</span>}[ <span class="i">$row</span> - <span class="n">1</span> ]<span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">elsif</span> <span class="s">(</span> <span class="i">$colour</span> <span class="k">eq</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>}<span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span> <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}<span class="sc">;</span> <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">toggle_colour</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">colour</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="w">colour</span>}[ <span class="i">$row</span> - <span class="n">1</span> ]<span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">elsif</span> <span class="s">(</span> <span class="i">$colour</span> <span class="k">eq</span> <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="w">Lcolour2</span>}<span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span> <span class="i">$colour</span> = <span class="i">$self</span>-&gt;{<span class="w">Lcolour</span>}<span class="sc">;</span> <span class="s">}</span>
        <span class="s">}</span>

        <span class="k">my</span> <span class="i">$row_spec</span><span class="sc">;</span>    <span class="c">## clear to separate from previous row..</span>
        <span class="i">$row_spec</span> = <span class="i">$colour</span> <span class="k">unless</span> <span class="s">(</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">row_class</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] =~ <span class="q">/color/</span> <span class="s">)</span> || <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">row_spec</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] =~ <span class="q">/color/</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$row_spec</span> .= <span class="q">&quot; $self-&gt;{row_class}[$row-1] $self-&gt;{row_spec}[$row-1] $self-&gt;{row_attr}[$row-1]&quot;</span><span class="sc">;</span>

        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;TR $row_spec&gt;\n&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$skip</span> = <span class="n">0</span><span class="sc">;</span>    <span class="c">###### flag to skip to next row...</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$skip</span><span class="s">)</span> <span class="s">{</span> <span class="k">next</span><span class="sc">;</span> <span class="s">}</span>
            <span class="k">my</span> <span class="i">$index</span>    = <span class="i">$column</span> - <span class="n">1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$thistext</span> = <span class="i">$self</span>-&gt;{<span class="q">&quot;C$index&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ]<span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> !<span class="s">(</span><span class="i">$thistext</span><span class="s">)</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> !<span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">add_empty_cells</span>} <span class="s">)</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">next</span><span class="sc">;</span>
            <span class="s">}</span>

            <span class="c"># if colspans are not defined, do not print</span>
            <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> !<span class="i">$self</span>-&gt;{<span class="w">row_type</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] =~ <span class="q">/heading/i</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> !<span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">'colspan'</span>}{<span class="q">&quot;($row,$column)&quot;</span>} <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">next</span><span class="sc">;</span>
            <span class="s">}</span>

            <span class="k">my</span> <span class="i">$cell_spec</span> = <span class="q">''</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$column)&quot;</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="i">$cell_spec</span> = <span class="i">$self</span>-&gt;{<span class="q">&quot;($row,$column)&quot;</span>}<span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">row_type</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] =~ <span class="q">/heading/i</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="q">&quot;$ind2&lt;TD $nowrap  $self-&gt;{IDs}[$row][$column] colspan=$self-&gt;{columns} $self-&gt;{Cwidth}[$column-1] $self-&gt;{row_spec}[$row-1] $font_string&gt;\n$ind3 $class_on&quot;</span><span class="sc">;</span>
                <span class="i">$skip</span> = <span class="n">1</span><span class="sc">;</span>    <span class="c">### only do once..</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">my</span> <span class="i">$colspan</span> = <span class="q">''</span><span class="sc">;</span>

                <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">colspan_def</span>} <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$colspan</span> = <span class="q">&quot; colspan=&quot;</span> . <span class="i">$self</span>-&gt;{<span class="q">'colspan'</span>}{<span class="q">&quot;($row,$column)&quot;</span>}<span class="sc">;</span>
                <span class="s">}</span>

                <span class="i">$print_string</span> .= <span class="q">&quot;$ind2&lt;TD $nowrap  $self-&gt;{IDs}[$row][$column] $colspan $cell_spec $self-&gt;{align}[$column-1] $self-&gt;{valign}[$column-1] $self-&gt;{Cwidth}[$column-1] $font_string&gt;\n$ind3 $class_on&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$thistext</span> =~ <span class="q">s/NULL/-/g</span><span class="sc">;</span>    <span class="c">###### don't print NULL ##</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">links</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="c">## only do this if link tags are set (this can slow down the table generation quite a bit) ##</span>
                <span class="i">$print_string</span> .= <span class="i">_replace_links</span><span class="s">(</span>
                    -<span class="w">self</span> <span class="cm">=&gt;</span> <span class="i">$self</span><span class="cm">,</span>
                    -<span class="w">text</span> <span class="cm">=&gt;</span> <span class="i">$thistext</span><span class="cm">,</span>
                    -<span class="w">file</span> <span class="cm">=&gt;</span> <span class="i">$filename</span>
                <span class="s">)</span><span class="sc">;</span>

            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>

                <span class="i">$print_string</span> .= <span class="i">$thistext</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;$class_off&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$print_string</span> .= <span class="q">&quot;$ind1&lt;/TR&gt;\n&quot;</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">autosort_end_skip</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$row</span> == <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">rows</span>} - <span class="i">$self</span>-&gt;{<span class="w">autosort_end_skip</span>} <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="q">&quot;\n&lt;/TBODY&gt;\n&quot;</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="i">$print_string</span> .= <span class="q">&quot;\n&lt;/TBODY&gt;\n&quot;</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">autosort_columns</span>} &amp;&amp; !<span class="i">$self</span>-&gt;{<span class="w">autosort_end_skip</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="i">$print_string</span> .= <span class="q">&quot;&lt;/Table&gt;\n&quot;</span><span class="sc">;</span>

    <span class="c">#  if ($self-&gt;{Font}) { $font_string .= &quot;&lt;/Font&gt;&quot; }</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">suffix</span>} <span class="s">)</span> <span class="s">{</span> <span class="i">$print_string</span> .= <span class="i">$self</span>-&gt;{<span class="w">suffix</span>}<span class="sc">;</span> <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$suppress_printing</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="i">$print_string</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$filename</span> &amp;&amp; <span class="s">(</span> <span class="i">$filename</span> =~ <span class="q">/\.xls/</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$class_size</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> =~ <span class="q">s/class=medium/class=$class_size/g</span><span class="sc">;</span>
            <span class="i">$print_string</span> =~ <span class="q">s/cellpadding=(\d+)/cellpadding=5/g</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">my</span> <span class="i">$link</span> = <span class="q">&quot;\n&lt;BR&gt;&lt;a href='/$URL_path'&gt;&lt;b&gt;Excel File&lt;/b&gt;&lt;/a&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$link</span> .= <span class="q">&quot;&lt;i&gt; (extracts only this table)&lt;/i&gt;\n&quot;</span><span class="sc">;</span>

        <span class="c"># print out html</span>
        <span class="k">my</span> <span class="i">$html_str</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="i">$html_str</span> .= <span class="i">$self</span>-&gt;{<span class="w">HTML_header</span>}<span class="sc">;</span>
        <span class="i">$html_str</span> .= <span class="i">start_html</span><span class="s">(</span><span class="q">'Popup Window'</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$html_str</span> .= <span class="i">$Table_header</span><span class="sc">;</span>
        <span class="i">$html_str</span> .= <span class="i">start_form</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>                 <span class="c"># in case forms are being used...</span>
        <span class="i">$html_str</span> .= <span class="i">$print_string</span><span class="sc">;</span>
        <span class="i">$html_str</span> .= <span class="i">end_form</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$html_str</span> .= <span class="w">end_html</span><span class="sc">;</span>

        <span class="i">$self</span><span class="i">-&gt;print_to_xls_native</span><span class="s">(</span> -<span class="w">outfile</span> <span class="cm">=&gt;</span> <span class="i">$filename</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">return</span> <span class="i">$link</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$filename</span> &amp;&amp; <span class="s">(</span> <span class="i">$filename</span> =~ <span class="q">/\.csv/</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$class_size</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> =~ <span class="q">s/class=medium/class=$class_size/g</span><span class="sc">;</span>
            <span class="i">$print_string</span> =~ <span class="q">s/cellpadding=(\d+)/cellpadding=5/g</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">my</span> <span class="i">$link</span> = <span class="q">&quot;\n&lt;BR&gt;&lt;a href='/$URL_path'&gt;&lt;b&gt;CSV File&lt;/b&gt;&lt;/a&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$link</span> .= <span class="q">&quot;&lt;i&gt; (extracts only this table)&lt;/i&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;print_to_csv</span><span class="s">(</span> -<span class="w">outfile</span> <span class="cm">=&gt;</span> <span class="i">$filename</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">return</span> <span class="i">$link</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span><span class="i">$filename</span><span class="s">)</span> <span class="s">{</span>    <span class="c">### in this case only print to a file ###</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$class_size</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> =~ <span class="q">s/class=medium/class=$class_size/g</span><span class="sc">;</span>
            <span class="i">$print_string</span> =~ <span class="q">s/cellpadding=(\d+)/cellpadding=5/g</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$link</span> = <span class="i">$self</span>-&gt;{<span class="w">link</span>}<span class="sc">;</span>
        <span class="i">$link</span> ||= <span class="q">&quot;\n&lt;BR&gt;&lt;a href='/$URL_path'&gt;&lt;b&gt;Printable Page&lt;/b&gt;&lt;/a&gt;\n&quot;</span> . <span class="q">&quot;&lt;i&gt; (extracts only this table)&lt;/i&gt;\n&quot;</span><span class="sc">;</span>
        <span class="k">open</span><span class="s">(</span> <span class="w">OUTFILE</span><span class="cm">,</span> <span class="q">&quot;&gt;$filename&quot;</span> <span class="s">)</span><span class="sc">;</span>
        <span class="c">## move links into separate parameter ##</span>
        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="i">$self</span>-&gt;{<span class="w">HTML_header</span>}<span class="sc">;</span>

        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="i">start_html</span><span class="s">(</span><span class="q">'Popup Window'</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="i">$Table_header</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="i">start_form</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>    <span class="c"># in case forms are being used...</span>
        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="i">$print_string</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="i">end_form</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">OUTFILE</span> <span class="w">end_html</span><span class="sc">;</span>
        <span class="k">close</span><span class="s">(</span><span class="w">OUTFILE</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">return</span> <span class="i">$link</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$filename</span> <span class="s">)</span> <span class="s">{</span> <span class="k">print</span> <span class="i">$print_string</span><span class="sc">;</span> <span class="s">}</span>

    <span class="k">return</span> <span class="i">$print_string</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># function that writes out a .csv file from the table</span>
<span class="c">##############################</span>
<a name="print_to_csv-"></a><span class="k">sub </span><span class="m">print_to_csv</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="k">my</span> <span class="i">$self</span>    = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>    = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$outfile</span> = <span class="i">$args</span>{-<span class="w">outfile</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$csv_str</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="c">## write out the headers</span>
    <span class="c"># write out the title</span>
    <span class="c">#if ($self-&gt;{title}) {</span>
    <span class="c">#	$csv_str .= &quot;$self-&gt;{title}\n&quot;;</span>
    <span class="c">#   }</span>
    <span class="c"># write out subtitles</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$index</span> = <span class="n">0</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$line</span>  = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="k">while</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[<span class="i">$index</span>] <span class="s">)</span> <span class="s">{</span>
            <span class="i">$line</span> .= <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[<span class="i">$index</span>] . <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">sub_title_span</span>}[<span class="i">$index</span>] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$line</span> .= <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$index</span>++<span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">chop</span><span class="s">(</span><span class="i">$line</span><span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/,$/</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$csv_str</span> .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># write out headers</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>} } <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$line</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$line</span> .= <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] . <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$line</span> .= <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">chop</span><span class="s">(</span><span class="i">$line</span><span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/,$/</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$csv_str</span> .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># write out the body of the table</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$line</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$column</span> = <span class="i">$col</span> - <span class="n">1</span><span class="sc">;</span>
            <span class="i">$line</span> .= <span class="i">$self</span>-&gt;{<span class="q">&quot;C$column&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ] . <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$col</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$line</span> .= <span class="q">&quot;\t&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">chop</span><span class="s">(</span><span class="i">$line</span><span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$line</span> =~ <span class="q">/,$/</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$csv_str</span> .= <span class="q">&quot;$line\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># do regexp to parse out special tags (&lt;BR&gt; gets replaced with a space)</span>
    <span class="i">$csv_str</span> =~ <span class="q">s/&lt;BR&gt;/ /gi</span><span class="sc">;</span>

    <span class="c"># div and script tags, everything gets removed</span>
    <span class="c"># remove set_Tooltip as well</span>
    <span class="i">$csv_str</span> =~ <span class="q">s/&lt;script&gt;.*?&lt;\/script&gt;//gi</span><span class="sc">;</span>
    <span class="i">$csv_str</span> =~ <span class="q">s/&lt;div&gt;.*?&lt;\/div&gt;//gi</span><span class="sc">;</span>
    <span class="i">$csv_str</span> =~ <span class="q">s/setTooltip\Q()\E//gi</span><span class="sc">;</span>

    <span class="c"># remove &amp;nbsp</span>
    <span class="i">$csv_str</span> =~ <span class="q">s/\&amp;nbsp;?//gi</span><span class="sc">;</span>

    <span class="c"># do a regexp to remove all tags</span>
    <span class="i">$csv_str</span> =~ <span class="q">s/&lt;.*?&gt;//g</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$OUT</span><span class="sc">;</span>
    <span class="k">open</span><span class="s">(</span> <span class="i">$OUT</span><span class="cm">,</span> <span class="q">&quot;&gt;$outfile&quot;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">$OUT</span> <span class="i">$csv_str</span><span class="sc">;</span>
    <span class="k">close</span><span class="s">(</span><span class="i">$OUT</span><span class="s">)</span><span class="sc">;</span>

    <span class="c">#my $row = $self-&gt;{rows} + 1;</span>
    <span class="c">#$self-&gt;{&quot;C$column&quot;}[$row-1] = $value;</span>
<span class="s">}</span>

<span class="c">################################</span>
<span class="c"># function that writes out an excel file from the table</span>
<span class="c">################################</span>
<a name="print_to_xls_native-"></a><span class="k">sub </span><span class="m">print_to_xls_native</span> <span class="s">{</span>
<span class="c">#####################</span>
    <span class="c"># import modules needed</span>

    <span class="k">my</span> <span class="s">(</span><span class="i">$mypath</span><span class="s">)</span> = <span class="i">$INC</span>{<span class="q">'RGTools/HTML_Table.pm'</span>} =~ <span class="q">/^(.*)RGTools\/HTML_Table\.pm$/</span><span class="sc">;</span>

    <span class="k">unless</span> <span class="s">(</span> <span class="k">-e</span> <span class="q">&quot;$mypath/Imported/Excel/&quot;</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="q">&quot;Spreadsheet::Excel modules not available in $mypath/Imported/Excel/&quot;</span><span class="sc">;</span>
        <span class="k">return</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">push</span><span class="s">(</span> <span class="i">@INC</span><span class="cm">,</span> <span class="q">&quot;$mypath/Imported/Excel/&quot;</span> <span class="s">)</span><span class="sc">;</span>    <span class="c"># unless (grep('$mypath/Imported/Excel/',@INC));</span>

    <span class="c"># check if modules exist</span>
    <span class="k">eval</span> <span class="s">{</span> <span class="k">require</span> <span class="w">Spreadsheet::WriteExcel</span><span class="sc">;</span> <span class="s">}</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$@</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="q">&quot;Missing required modules: $@&quot;</span><span class="sc">;</span>
        <span class="k">return</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$self</span>       = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>       = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$outputfile</span> = <span class="i">$args</span>{-<span class="w">outfile</span>}<span class="sc">;</span>

    <span class="c"># Setup spreadsheet</span>
    <span class="c"># Create a new Excel workbook</span>
    <span class="k">my</span> <span class="i">$workbook</span> = <span class="w">Spreadsheet::WriteExcel</span><span class="w">-&gt;new</span><span class="s">(</span><span class="q">&quot;$outputfile&quot;</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># set up formats</span>
    <span class="k">my</span> <span class="i">$boldformat</span> = <span class="i">$workbook</span><span class="i">-&gt;addformat</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$boldformat</span><span class="i">-&gt;set_bold</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$italicformat</span> = <span class="i">$workbook</span><span class="i">-&gt;addformat</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$italicformat</span><span class="i">-&gt;set_italic</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$bolditalicformat</span> = <span class="i">$workbook</span><span class="i">-&gt;addformat</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$bolditalicformat</span><span class="i">-&gt;set_bold</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$bolditalicformat</span><span class="i">-&gt;set_italic</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># Add a worksheet</span>
    <span class="k">my</span> <span class="i">$sheet</span> = <span class="i">$workbook</span><span class="i">-&gt;add_worksheet</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$rowcounter</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colcounter</span> = <span class="n">0</span><span class="sc">;</span>

    <span class="c">## write out the headers</span>
    <span class="c"># write out the title</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">title</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$value</span> = <span class="i">$self</span>-&gt;{<span class="w">title</span>}<span class="sc">;</span>
        <span class="i">$value</span> = <span class="i">&amp;_strip_tags</span><span class="s">(</span><span class="i">$value</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$sheet</span><span class="i">-&gt;write</span><span class="s">(</span> <span class="i">$rowcounter</span><span class="cm">,</span> <span class="i">$colcounter</span><span class="cm">,</span> <span class="i">$value</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$rowcounter</span>++<span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># write out subtitles</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">sub_titles</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$index</span> = <span class="n">0</span><span class="sc">;</span>
        <span class="k">while</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[<span class="i">$index</span>] <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$value</span> = <span class="i">$self</span>-&gt;{<span class="w">sub_title</span>}[<span class="i">$index</span>]<span class="sc">;</span>
            <span class="i">$value</span> = <span class="i">&amp;_strip_tags</span><span class="s">(</span><span class="i">$value</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$sheet</span><span class="i">-&gt;write</span><span class="s">(</span> <span class="i">$rowcounter</span><span class="cm">,</span> <span class="i">$colcounter</span><span class="cm">,</span> <span class="i">$value</span> <span class="s">)</span><span class="sc">;</span>
            <span class="i">$colcounter</span>++<span class="sc">;</span>
            <span class="k">foreach</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">sub_title_span</span>}[<span class="i">$index</span>] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$colcounter</span>++<span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$index</span>++<span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$rowcounter</span>++<span class="sc">;</span>
        <span class="i">$colcounter</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># write out headers</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>} } <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$line</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$column</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$value</span>  = <span class="i">$self</span>-&gt;{<span class="w">header_labels</span>}[ <span class="i">$column</span> - <span class="n">1</span> ]<span class="sc">;</span>
            <span class="k">my</span> <span class="i">$format</span> = <span class="k">undef</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$value</span> =~ <span class="q">/&lt;B&gt;/i</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$format</span> = <span class="i">$boldformat</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">elsif</span> <span class="s">(</span> <span class="i">$value</span> =~ <span class="q">/&lt;I&gt;/i</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$format</span> = <span class="i">$italicformat</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$value</span> = <span class="i">&amp;_strip_tags</span><span class="s">(</span><span class="i">$value</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$sheet</span><span class="i">-&gt;write</span><span class="s">(</span> <span class="i">$rowcounter</span><span class="cm">,</span> <span class="i">$colcounter</span><span class="cm">,</span> <span class="i">$value</span> <span class="s">)</span><span class="sc">;</span>
            <span class="i">$colcounter</span>++<span class="sc">;</span>
            <span class="k">foreach</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$column</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$colcounter</span>++<span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="i">$rowcounter</span>++<span class="sc">;</span>
        <span class="i">$colcounter</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># write out the body of the table</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">rows</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$line</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$col</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">columns</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$column</span> = <span class="i">$col</span> - <span class="n">1</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$value</span>  = <span class="i">$self</span>-&gt;{<span class="q">&quot;C$column&quot;</span>}[ <span class="i">$row</span> - <span class="n">1</span> ]<span class="sc">;</span>
            <span class="i">$value</span> = <span class="i">&amp;_strip_tags</span><span class="s">(</span><span class="i">$value</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$sheet</span><span class="i">-&gt;write</span><span class="s">(</span> <span class="i">$rowcounter</span><span class="cm">,</span> <span class="i">$colcounter</span><span class="cm">,</span> <span class="i">$value</span> <span class="s">)</span><span class="sc">;</span>

            <span class="i">$colcounter</span>++<span class="sc">;</span>
            <span class="k">foreach</span> <span class="s">(</span> <span class="n">1</span> .. <span class="i">$self</span>-&gt;{<span class="w">Cwidth</span>}[ <span class="i">$col</span> - <span class="n">1</span> ] <span class="s">)</span> <span class="s">{</span>
                <span class="i">$colcounter</span>++<span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="i">$rowcounter</span>++<span class="sc">;</span>
        <span class="i">$colcounter</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">########################</span>
<span class="c"># Allows for placer LINK tags in the script to be replaced by supplied links (supplied at a different time)</span>
<span class="c">########################</span>
<a name="_replace_links-"></a><span class="k">sub </span><span class="m">_replace_links</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">%args</span>     = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$self</span>     = <span class="i">$args</span>{-<span class="w">self</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$thistext</span> = <span class="i">$args</span>{-<span class="w">text</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>     = <span class="i">$self</span>-&gt;{<span class="w">link_index</span>} || <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>    <span class="c">## link index</span>
    <span class="k">my</span> <span class="i">$filename</span> = <span class="i">$args</span>{-<span class="w">file</span>}<span class="sc">;</span>                             <span class="c">## not sure why exactly ... but leave it for now..</span>

    <span class="c">## arguments below work more effectively for single field generation ##</span>
    <span class="k">my</span> <span class="i">$type</span>    = <span class="i">$args</span>{-<span class="w">type</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$name</span>    = <span class="i">$args</span>{-<span class="w">name</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$value</span>   = <span class="i">$args</span>{-<span class="w">value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$label</span>   = <span class="i">$args</span>{-<span class="w">label</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$spec</span>    = <span class="i">$args</span>{-<span class="w">spec</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$tip</span>     = <span class="i">$args</span>{-<span class="w">tip</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$disable</span> = <span class="i">$args</span>{<span class="w">_disable</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$colour</span>  = <span class="i">$args</span>{-<span class="w">colour</span>} || <span class="i">$self</span>-&gt;{<span class="w">button_colour</span>}<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> &amp;&amp; <span class="i">$name</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$thistext</span> ||= <span class="q">'LINK'</span><span class="sc">;</span>
    <span class="s">}</span>    <span class="c">## temporary - to force through block below ...</span>

    <span class="k">my</span> <span class="i">$print_string</span> = <span class="q">''</span><span class="sc">;</span>
    <span class="k">while</span> <span class="s">(</span> <span class="i">$thistext</span> =~ <span class="q">/(.*?)\bLINK\b(.*)/</span> <span class="s">)</span> <span class="s">{</span>

        <span class="i">$print_string</span> .= <span class="q">&quot;$1&quot;</span><span class="sc">;</span>
        <span class="i">$thistext</span> = <span class="i">$2</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_type</span>     = <span class="i">$type</span>    || <span class="i">$self</span>-&gt;{<span class="w">LINK_type</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_name</span>     = <span class="i">$name</span>    || <span class="i">$self</span>-&gt;{<span class="w">LINK_name</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_value</span>    = <span class="i">$value</span>   || <span class="i">$self</span>-&gt;{<span class="w">LINK_value</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_label</span>    = <span class="i">$label</span>   || <span class="i">$self</span>-&gt;{<span class="w">LINK_label</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_spec</span>     = <span class="i">$spec</span>    || <span class="i">$self</span>-&gt;{<span class="w">LINK_spec</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_tip</span>      = <span class="i">$tip</span>     || <span class="i">$self</span>-&gt;{<span class="w">LINK_tip</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$L_disabled</span> = <span class="i">$disable</span> || <span class="i">$self</span>-&gt;{<span class="w">LINK_disabled</span>}[<span class="i">$link</span>]<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$filename</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">$L_value</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/submit/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$buttonColour</span><span class="sc">;</span>
            <span class="k">if</span>   <span class="s">(</span><span class="i">$L_label</span><span class="s">)</span> <span class="s">{</span> <span class="i">$buttonColour</span> = <span class="i">$L_label</span><span class="sc">;</span> <span class="s">}</span>
            <span class="k">else</span>            <span class="s">{</span> <span class="i">$buttonColour</span> = <span class="i">$colour</span><span class="sc">;</span> <span class="s">}</span>
            <span class="i">$print_string</span> .= <span class="i">submit</span><span class="s">(</span>
                -<span class="w">name</span>  <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                -<span class="w">style</span> <span class="cm">=&gt;</span> <span class="q">&quot;background-color:$buttonColour&quot;</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/checkbox_group/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$L_label</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="i">checkbox_group</span><span class="s">(</span>
                    -<span class="w">name</span>      <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    -<span class="w">values</span>    <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                    -<span class="w">defaults</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_label</span><span class="s">]</span><span class="cm">,</span>
                    -<span class="w">linebreak</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                    -<span class="w">force</span>     <span class="cm">=&gt;</span> <span class="n">1</span>
                <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="i">checkbox_group</span><span class="s">(</span>
                    -<span class="w">name</span>      <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    -<span class="w">values</span>    <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                    -<span class="w">linebreak</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                    -<span class="w">force</span>     <span class="cm">=&gt;</span> <span class="n">1</span>
                <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/list(\d*)/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$size</span> = <span class="s">(</span> <span class="k">defined</span> <span class="i">$1</span> <span class="s">)</span> ? <span class="i">$1</span> <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$L_label</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="i">_show_Tool_Tip</span><span class="s">(</span>
                    <span class="i">scrolling_list</span><span class="s">(</span>
                        -<span class="w">name</span>     <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                        -<span class="w">values</span>   <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                        -<span class="w">defaults</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_label</span><span class="s">]</span><span class="cm">,</span>
                        -<span class="w">multiple</span> <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span>
                        -<span class="w">force</span>    <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                        -<span class="w">size</span>     <span class="cm">=&gt;</span> <span class="i">$size</span>
                    <span class="s">)</span><span class="cm">,</span>
                    <span class="i">$L_tip</span>
                <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="i">_show_Tool_Tip</span><span class="s">(</span>
                    <span class="i">scrolling_list</span><span class="s">(</span>
                        -<span class="w">name</span>     <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                        -<span class="w">values</span>   <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                        -<span class="w">defaults</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="s">]</span><span class="cm">,</span>
                        -<span class="w">multiple</span> <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span>
                        -<span class="w">force</span>    <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                        -<span class="w">size</span>     <span class="cm">=&gt;</span> <span class="i">$size</span>
                    <span class="s">)</span><span class="cm">,</span>
                    <span class="i">$L_tip</span>
                <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/checkbox_per_line/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">checkbox</span><span class="s">(</span>
                -<span class="w">name</span>      <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">value</span>     <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                -<span class="w">label</span>     <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                -<span class="w">onClick</span>   <span class="cm">=&gt;</span> <span class="i">$L_spec</span><span class="cm">,</span>
                -<span class="w">linebreak</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                -<span class="w">checked</span>   <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span>
                -<span class="w">force</span>     <span class="cm">=&gt;</span> <span class="n">1</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/checkbox_on/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">checkbox</span><span class="s">(</span>
                -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">value</span>   <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                -<span class="w">label</span>   <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span><span class="cm">,</span>
                -<span class="w">checked</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                -<span class="w">force</span>   <span class="cm">=&gt;</span> <span class="n">1</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/checkbox_off/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">checkbox</span><span class="s">(</span>
                -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">value</span>   <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                -<span class="w">label</span>   <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span><span class="cm">,</span>
                -<span class="w">checked</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span>
                -<span class="w">force</span>   <span class="cm">=&gt;</span> <span class="n">1</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/checkbox/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$L_disabled</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="i">checkbox</span><span class="s">(</span>
                    -<span class="w">name</span>     <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    -<span class="w">value</span>    <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                    -<span class="w">label</span>    <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                    -<span class="w">onClick</span>  <span class="cm">=&gt;</span> <span class="i">$L_spec</span><span class="cm">,</span>
                    -<span class="w">disabled</span> <span class="cm">=&gt;</span> <span class="i">$L_disabled</span>
                <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$print_string</span> .= <span class="i">checkbox</span><span class="s">(</span>
                    -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    -<span class="w">value</span>   <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                    -<span class="w">label</span>   <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                    -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span>
                <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/popup/i</span> <span class="s">)</span> <span class="s">{</span>

            <span class="c"># Get maximum length of items</span>
            <span class="k">my</span> <span class="i">$max_length</span> = <span class="n">200</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$scale</span>      = <span class="n">7</span><span class="sc">;</span>

            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$value</span> <span class="s">(</span><span class="i">@$L_value</span><span class="s">)</span> <span class="s">{</span>
                <span class="k">my</span> <span class="i">$len</span> = <span class="k">length</span><span class="s">(</span><span class="i">$value</span><span class="s">)</span><span class="sc">;</span>
                <span class="i">$len</span> *= <span class="i">$scale</span><span class="sc">;</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$len</span> &gt; <span class="i">$max_length</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$max_length</span> = <span class="i">$len</span> <span class="s">}</span>
            <span class="s">}</span>
            <span class="i">$print_string</span> .= <span class="i">_show_Tool_Tip</span><span class="s">(</span>
                <span class="i">RGTools::Web_Form::Popup_Menu</span><span class="s">(</span>
                    <span class="w">name</span>     <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    <span class="w">id</span>       <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    <span class="w">values</span>   <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                    <span class="w">default</span>  <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                    <span class="w">force</span>    <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                    <span class="w">onChange</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span><span class="cm">,</span>
                    <span class="w">width</span>    <span class="cm">=&gt;</span> <span class="i">$max_length</span><span class="cm">,</span>
                    <span class="w">disabled</span> <span class="cm">=&gt;</span> <span class="i">$L_disabled</span>
                <span class="s">)</span><span class="cm">,</span>
                <span class="i">$L_tip</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/box/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$rows</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$cols</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$L_value</span> =~ <span class="q">/(\d+)\s?x\s?(\d+)/i</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$rows</span> = <span class="i">$1</span><span class="sc">;</span> <span class="i">$cols</span> = <span class="i">$2</span><span class="sc">;</span> <span class="s">}</span>
            <span class="i">$print_string</span> .= <span class="i">_show_Tool_Tip</span><span class="s">(</span>
                <span class="i">textarea</span><span class="s">(</span>
                    -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    -<span class="i">rows</span>    <span class="cm">=&gt;</span> <span class="i">$rows</span><span class="cm">,</span>
                    -<span class="w">cols</span>    <span class="cm">=&gt;</span> <span class="i">$cols</span><span class="cm">,</span>
                    -<span class="w">default</span> <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                    -<span class="w">force</span>   <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                    -<span class="w">wrap</span>    <span class="cm">=&gt;</span> <span class="q">'virtual'</span>
                <span class="s">)</span><span class="cm">,</span>
                <span class="i">$L_tip</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/text/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">_show_Tool_Tip</span><span class="s">(</span>
                <span class="i">textfield</span><span class="s">(</span>
                    -<span class="w">name</span>     <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                    -<span class="w">size</span>     <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                    -<span class="w">default</span>  <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                    -<span class="w">force</span>    <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                    -<span class="w">onChange</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span>
                <span class="s">)</span><span class="cm">,</span>
                <span class="i">$L_tip</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/radio_per_line/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">radio_group</span><span class="s">(</span>
                -<span class="w">name</span>      <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">values</span>    <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                -<span class="w">default</span>   <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                -<span class="w">force</span>     <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                -<span class="w">onClick</span>   <span class="cm">=&gt;</span> <span class="i">$L_spec</span><span class="cm">,</span>
                -<span class="w">linebreak</span> <span class="cm">=&gt;</span> <span class="n">1</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/radio/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">radio_group</span><span class="s">(</span>
                -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">values</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@$L_value</span><span class="s">]</span><span class="cm">,</span>
                -<span class="w">default</span> <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                -<span class="w">force</span>   <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
                -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/reset/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="k">reset</span><span class="s">(</span>
                -<span class="w">name</span>   <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">values</span> <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                -<span class="w">style</span>  <span class="cm">=&gt;</span> <span class="q">&quot;background-color:$colour&quot;</span><span class="cm">,</span>
                -<span class="w">force</span>  <span class="cm">=&gt;</span> <span class="n">1</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/hidden/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/toggle/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="i">checkbox</span><span class="s">(</span>
                -<span class="w">name</span>    <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span>
                -<span class="w">value</span>   <span class="cm">=&gt;</span> <span class="i">$L_value</span><span class="cm">,</span>
                -<span class="w">label</span>   <span class="cm">=&gt;</span> <span class="i">$L_label</span><span class="cm">,</span>
                -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="i">$L_spec</span>
            <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span> <span class="i">$L_type</span> =~ <span class="q">/label/i</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;$L_label&quot;</span><span class="sc">;</span>
            <span class="i">$print_string</span> .= <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$L_name</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$L_value</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$print_string</span> .= <span class="q">&quot;Link ($L_type)&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$self</span>-&gt;{<span class="w">link_index</span>}++<span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$print_string</span> .= <span class="i">$thistext</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$print_string</span><span class="sc">;</span>
<span class="s">}</span>
<span class="c">##############################</span>
<span class="c"># public_functions           #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># private_methods            #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># private_functions          #</span>
<span class="c">##############################</span>

<span class="c">##############################</span>
<span class="c"># Subroutine: Helper function that strips tags from a line</span>
<span class="c"># return: none</span>
<span class="c">##############################</span>
<a name="_strip_tags-"></a><span class="k">sub </span><span class="m">_strip_tags</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="k">my</span> <span class="i">$value</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="c"># do regexp to parse out special tags (&lt;BR&gt; gets replaced with a newline)</span>
    <span class="i">$value</span> =~ <span class="q">s/&lt;BR&gt;/\n/gi</span><span class="sc">;</span>

    <span class="c"># div and script tags, everything gets removed</span>
    <span class="c"># remove set_Tooltip as well</span>
    <span class="i">$value</span> =~ <span class="q">s/&lt;script&gt;.*?&lt;\/script&gt;//gi</span><span class="sc">;</span>
    <span class="i">$value</span> =~ <span class="q">s/&lt;div&gt;.*?&lt;\/div&gt;//gi</span><span class="sc">;</span>
    <span class="i">$value</span> =~ <span class="q">s/setTooltip\Q()\E//gi</span><span class="sc">;</span>

    <span class="c"># do a regexp to remove all tags</span>
    <span class="i">$value</span> =~ <span class="q">s/&lt;.*?&gt;//g</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$value</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">###############</span>
<a name="_show_Tool_Tip-"></a><span class="k">sub </span><span class="m">_show_Tool_Tip</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="c">#</span>
    <span class="c"># This enables tool tips, making use of the javascript file : DHTML.js</span>
    <span class="c">#  (for this to work you MUST have the javascript file installed as well)</span>
    <span class="c">#</span>

    <span class="k">my</span> <span class="i">$html_tag</span>     = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$tool_tip_msg</span> = <span class="k">shift</span><span class="sc">;</span>    <span class="c">#The message of the tooltip.</span>

    <span class="i">$tool_tip_msg</span> =~ <span class="q">s/\'/\\\'/g</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$tool_tip</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$tool_tip_msg</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="i">$tool_tip_msg</span> <span class="k">ne</span> <span class="q">''</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="i">$tool_tip_msg</span> <span class="k">ne</span> <span class="q">'0'</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$tool_tip</span> = <span class="q">qq{ onmouseover=&quot;writetxt('$tool_tip_msg');&quot; onmouseout=&quot;writetxt(0);&quot;&gt;}</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">return</span> <span class="i">$html_tag</span><span class="sc">;</span>        <span class="c">#Just return what was passed in</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$html_tag</span> =~ <span class="q">/&lt;\/\s*([a-zA-Z]+)\s*&gt;[^&gt;]*$/</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#Looking for the ones with closing tags and grab the tag name.</span>
        <span class="k">my</span> <span class="i">$tag</span> = <span class="i">$1</span><span class="sc">;</span>
        <span class="i">$html_tag</span> =~ <span class="q">s/^(&lt;\s*$tag[^&lt;]*)&gt;/$1$tool_tip/</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$html_tag</span> =~ <span class="q">/(&gt;)[^&gt;]*$/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$found</span> = <span class="i">$1</span><span class="sc">;</span>
        <span class="i">$html_tag</span> =~ <span class="q">s/$found/$tool_tip/</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#  &quot;&lt;A Href='#' style='text-decoration:none' &gt;$html_tag&lt;$tool_tip /A&gt;&quot;;</span>
    <span class="k">return</span> <span class="q">&quot;&lt;div id='divToolTip' class='toolTipCont'&gt;&lt;!--Empty div--&gt;&lt;/div&gt;&lt;script type='text/javascript'&gt;setToolTip()&lt;/script&gt;$html_tag&quot;</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##############################</span>
<span class="c"># main_footer                #</span>
<span class="c">##############################</span>
<span class="c">##############################</span>
<span class="c"># perldoc_footer             #</span>
<span class="c">##############################</span>

</pre><p></p>
<hr />
<h1><a name="known_issues__uplink_">KNOWN ISSUES &lt;UPLINK&gt;</a></h1>
<p>&lt;&lt;KNOWN ISSUES&gt;&gt;</p>
<p>
</p>
<hr />
<h1><a name="future_improvements__uplink_">FUTURE IMPROVEMENTS &lt;UPLINK&gt;</a></h1>
<p>&lt;&lt;FUTURE IMPROVEMENTS&gt;&gt;</p>
<p>
</p>
<hr />
<h1><a name="authors__uplink_">AUTHORS &lt;UPLINK&gt;</a></h1>
<p>&lt;&lt;AUTHORS&gt;&gt;</p>
<p>
</p>
<hr />
<h1><a name="created__uplink_">CREATED &lt;UPLINK&gt;</a></h1>
<p>2003-11-05</p>
<p>
</p>
<hr />
<h1><a name="revision__uplink_">REVISION &lt;UPLINK&gt;</a></h1>
<p>$Id: HTML_Table.pm,v 1.51 2004/12/09 17:43:47 rguin Exp $ (Release: $Name:  $)</p>

<pre>
<span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<a name="EOF-"></a></pre></body>

</html>
