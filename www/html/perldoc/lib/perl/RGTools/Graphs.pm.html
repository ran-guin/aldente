<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Mon Dec 29 15:36:20 2008 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/perl/RGTools/Graphs.pm</title>
<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #FFFFFF;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
</head>
<body>
<a name="-top-"></a>
<h1>lib/perl/RGTools/Graphs.pm</h1>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-Graphs-">package Graphs</a>
<ul>
<li><a href="#new-">new</a></li>
<li><a href="#set_config-">set_config</a></li>
<li><a href="#get_config-">get_config</a></li>
<li><a href="#create_graph-">create_graph</a></li>
<li><a href="#create_blank_graph-">create_blank_graph</a></li>
<li><a href="#get_PNG-">get_PNG</a></li>
<li><a href="#get_GIF-">get_GIF</a></li>
<li><a href="#create_PNG_file-">create_PNG_file</a></li>
<li><a href="#create_GIF_file-">create_GIF_file</a></li>
<li><a href="#get_PNG_HTML-">get_PNG_HTML</a></li>
<li><a href="#get_GIF_HTML-">get_GIF_HTML</a></li>
<li><a href="#_set_thumbnail-">_set_thumbnail</a></li>
<li><a href="#_set_axis_config-">_set_axis_config</a></li>
<li><a href="#_set_line_config-">_set_line_config</a></li>
<li><a href="#_set_bar_config-">_set_bar_config</a></li>
<li><a href="#_set_pie_config-">_set_pie_config</a></li>
<li><a href="#_set_matrix_config-">_set_matrix_config</a></li>
<li><a href="#_set_general_config-">_set_general_config</a></li>
<li><a href="#_set_line_graph-">_set_line_graph</a></li>
<li><a href="#_set_bar_graph-">_set_bar_graph</a></li>
<li><a href="#_set_pie_graph-">_set_pie_graph</a></li>
<li><a href="#_set_matrix_graph-">_set_matrix_graph</a></li>
<li><a href="#_convert_matrix_color-">_convert_matrix_color</a></li>
</ul>
</li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->
<hr />
<!-- contents of filename: lib/perl/RGTools/Graphs.pm -->
<pre>
<span class="c">###################################################################################################################################</span>
<span class="c"># Graphs.pm</span>
<span class="c">#</span>
<span class="c"># A light-weight module to create simple line/bar/pie/matrix graphs with minimum user input</span>
<span class="c"># This module is a wrapper of GD::Graph.</span>
<span class="c"># It simplifies the usage by setting many options to LIMS-prefered defaul values and a single method to generate every type of graph.</span>
<span class="c">#</span>
<span class="c"># This module contains the following methods:</span>
<span class="c">#</span>
<span class="c"># Public Methods:</span>
<span class="c"># new:                 constructor.</span>
<span class="c"># set_config:          set the graph configuration.</span>
<span class="c"># get_config:          get the graph configuratin.</span>
<span class="c"># create_graph:        create the graph</span>
<span class="c"># get_PNG:             get the image in PNG format</span>
<span class="c"># get_GIF:             get the image in GIF format</span>
<span class="c"># get_PNG_HTML:        get the HTML code piece (&lt;img&gt;) for PNG graph</span>
<span class="c"># get_GIF_HTML:        get the HTML code piece (&lt;img&gt;) for GIF graph</span>
<span class="c">#</span>
<span class="c"># Private Methods:</span>
<span class="c"># _set_general_config: set graph configurations common to all graphs</span>
<span class="c"># _set_line_config:    set graph configurations specific to Line graphs</span>
<span class="c"># _set_bar_config:     set graph configurations specific to Bar graphs</span>
<span class="c"># _set_pie_config:     set graph configurations specific to Pie graphs</span>
<span class="c"># _set_matrix_config:  set graph configurations specific to a Matrix</span>
<span class="c"># _set_line_graph:     create the part of the graph specific to Line graphs</span>
<span class="c"># _set_bar_graph:      create the part of the graph specific to Bar graphs</span>
<span class="c"># _set_pie_graph:      create the part of the graph sepcific to Pie graphs</span>
<span class="c"># _set_matrix_graph:   create the part of the graph specific to a Matrix</span>
<span class="c">#</span>
<span class="c"># Example of usage:</span>
<span class="c">#</span>
<span class="c"># use RGTools::Graphs;</span>
<span class="c">#</span>
<span class="c"># ## data hash should have the following structure:</span>
<span class="c"># ## 'x_axis'   =&gt; array reference of x_axis values</span>
<span class="c"># ## 'dataset1' =&gt; array reference of values for dataset1</span>
<span class="c"># ## 'dataset2' =&gt; array reference of values for dataset2</span>
<span class="c"># ## ...</span>
<span class="c"># ## 'dataset1', 'dataset2' should be replaced with the dataset names which will be appeared in the legend.</span>
<span class="c"># my %data = ('x_axis'  =&gt;  [&quot;QC_AFFX_5Q_123&quot;,&quot;QC_AFFX_5Q_456&quot;,&quot;QC_AFFX_5Q_789&quot;,&quot;QC_AFFX_5Q_ABC&quot;],</span>
<span class="c">#	       'set 1'  =&gt;  [    25,    30,    32,    40],</span>
<span class="c">#	      );</span>
<span class="c">#</span>
<span class="c"># ## construct a graphs object with data and options</span>
<span class="c"># my $graph = Graphs-&gt;new(-data=&gt;\%data, -title=&gt;'QC Plot', -x_label=&gt;'QC Items', -y_label=&gt;'Values');</span>
<span class="c">#</span>
<span class="c"># ## create an Line graph</span>
<span class="c"># $graph-&gt;create_graph(-type=&gt;'line');</span>
<span class="c">#</span>
<span class="c"># ## obtain the png graph</span>
<span class="c"># my $png = $graph-&gt;get_PNG();</span>
<span class="c">#</span>
<span class="c"># ## write to a file</span>
<span class="c"># open(IMG, &quot;&gt;test_xy.png&quot;) or die $!;</span>
<span class="c"># binmode IMG;</span>
<span class="c"># print IMG $png;</span>
<span class="c"># close IMG;</span>
<span class="c">#</span>
<span class="c"># ## create a bar graph</span>
<span class="c"># $graph-&gt;create_graph(-type=&gt;'bar');</span>
<span class="c">#</span>
<span class="c"># ## obtain the png graph</span>
<span class="c"># $png = $graph-&gt;get_PNG();</span>
<span class="c">#</span>
<span class="c"># ## write to a file</span>
<span class="c"># open(IMG, &quot;&gt;test_bar.png&quot;) or die $!;</span>
<span class="c"># binmode IMG;</span>
<span class="c"># print IMG $png;</span>
<span class="c"># close IMG;</span>
<span class="c">#</span>
<span class="c"># ## create a pie graph</span>
<span class="c"># $graph-&gt;create_graph(-type=&gt;'pie');</span>
<span class="c">#</span>
<span class="c"># ## obtain the png graph</span>
<span class="c"># $png = $graph-&gt;get_PNG();</span>
<span class="c">#</span>
<span class="c"># ## write to a file</span>
<span class="c"># open(IMG, &quot;&gt;test_pie.png&quot;) or die $!;</span>
<span class="c"># binmode IMG;</span>
<span class="c"># print IMG $png;</span>
<span class="c"># close IMG;</span>
<span class="c">#</span>
<span class="c"># ## create a matrix</span>
<span class="c"># $graph-&gt;create_graph(-type=&gt;'matrix');</span>
<span class="c">#</span>
<span class="c"># ## obtain the png graph</span>
<span class="c"># $png = $graph-&gt;get_PNG();</span>
<span class="c">#</span>
<span class="c"># ## write to a file</span>
<span class="c"># open(IMG, &quot;&gt;test_matrix.png&quot;) or die $!;</span>
<span class="c"># binmode IMG;</span>
<span class="c"># print IMG $png;</span>
<span class="c"># close IMG;</span>
<span class="c">###################################################################################################################################</span>

<a name="package-Graphs-"></a><span class="k">package </span><span class="i">Graphs</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">RGTools::RGIO</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Data::Dumper</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">GD::Graph::lines</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::bars</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::hbars</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::points</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::linespoints</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::area</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::mixed</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::pie</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::xylines</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::xypoints</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">GD::Graph::xylinespoints</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">GD</span><span class="sc">;</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : new()</span>
<span class="c"># Usage      : my $graph = Graphs-&gt;new()</span>
<span class="c"># Purpose    : create a new graph object with options</span>
<span class="c"># Returns    : a Graphs object</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="new-"></a><span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$invocant</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$class</span>    = <span class="k">ref</span><span class="s">(</span><span class="i">$invocant</span><span class="s">)</span> || <span class="i">$invocant</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>     = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>

    <span class="k">bless</span><span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$class</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$self</span><span class="i">-&gt;set_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : set_config()</span>
<span class="c"># Usage      : $graph-&gt;set_config();</span>
<span class="c"># Purpose    : set options</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="set_config-"></a><span class="k">sub </span><span class="m">set_config</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;_set_general_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;_set_line_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;_set_bar_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;_set_pie_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span><span class="i">-&gt;_set_matrix_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : get_config()</span>
<span class="c"># Usage      : $graph-&gt;get_config();</span>
<span class="c"># Purpose    : set options</span>
<span class="c"># Returns    : hash reference including all options (see option spec)</span>
<span class="c"># Parameters : none</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="get_config-"></a><span class="k">sub </span><span class="m">get_config</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$config</span> = <span class="i">$self</span><span class="sc">;</span>
    <span class="k">delete</span><span class="s">(</span> <span class="i">$config</span>-&gt;{<span class="w">graph</span>} <span class="s">)</span> <span class="k">if</span> <span class="k">exists</span><span class="s">(</span> <span class="i">$config</span>-&gt;{<span class="w">graph</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">delete</span><span class="s">(</span> <span class="i">$config</span>-&gt;{<span class="w">image</span>} <span class="s">)</span> <span class="k">if</span> <span class="k">exists</span><span class="s">(</span> <span class="i">$config</span>-&gt;{<span class="w">image</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$config</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : create_graph()</span>
<span class="c"># Usage      : $graph-&gt;create_graph();</span>
<span class="c"># Purpose    : create the graph</span>
<span class="c"># Returns    : the graph image that can be converted to png</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="create_graph-"></a><span class="k">sub </span><span class="m">create_graph</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="i">$self</span><span class="i">-&gt;_set_general_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># general config</span>
    <span class="k">my</span> <span class="i">$type</span>        = <span class="i">$self</span>-&gt;{<span class="w">type</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dclrs</span>       = <span class="i">$self</span>-&gt;{<span class="w">dclrs</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$bgclr</span>       = <span class="i">$self</span>-&gt;{<span class="w">bgclr</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$transparent</span> = <span class="i">$self</span>-&gt;{<span class="w">transparent</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$interlaced</span>  = <span class="i">$self</span>-&gt;{<span class="w">interlaced</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$zero_axis</span>   = <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$gd</span><span class="sc">;</span>

    <span class="c"># check if data is a valid hash. if not, return empty.</span>
    <span class="k">return</span> <span class="i">$gd</span> <span class="k">unless</span> <span class="k">ref</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">data</span>} <span class="s">)</span> <span class="k">eq</span> <span class="q">&quot;HASH&quot;</span><span class="sc">;</span>

    <span class="c"># create graphs according to type</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/line/i</span> || <span class="i">$type</span> =~ <span class="q">/xy/i</span> <span class="s">)</span> <span class="s">{</span>    <span class="c"># Line graph</span>

        <span class="i">$self</span><span class="i">-&gt;_set_line_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_thumbnail</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_line_graph</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/bar/i</span> <span class="s">)</span> <span class="s">{</span>

        <span class="i">$self</span><span class="i">-&gt;_set_bar_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_thumbnail</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_bar_graph</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/pie/i</span> <span class="s">)</span> <span class="s">{</span>

        <span class="i">$self</span><span class="i">-&gt;_set_pie_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_thumbnail</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_pie_graph</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/matrix/i</span> <span class="s">)</span> <span class="s">{</span>

        <span class="i">$self</span><span class="i">-&gt;_set_matrix_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;_set_matrix_graph</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

        <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>

    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">print</span> <span class="q">&quot;format not supported&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c"># general settings</span>
    <span class="i">$self</span>-&gt;{<span class="w">graph</span>}<span class="i">-&gt;set_title_font</span><span class="s">(</span><span class="q">&quot;gdMediumBoldFont&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">graph</span>}<span class="i">-&gt;set</span><span class="s">(</span>
        <span class="w">dclrs</span>       <span class="cm">=&gt;</span> <span class="i">$dclrs</span><span class="cm">,</span>
        <span class="w">bgclr</span>       <span class="cm">=&gt;</span> <span class="i">$bgclr</span><span class="cm">,</span>
        <span class="w">transparent</span> <span class="cm">=&gt;</span> <span class="i">$transparent</span><span class="cm">,</span>
        <span class="w">interlaced</span>  <span class="cm">=&gt;</span> <span class="i">$interlaced</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="i">$gd</span> = <span class="i">$self</span>-&gt;{<span class="w">graph</span>}<span class="i">-&gt;plot</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">plot_data</span>} <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$self</span>-&gt;{<span class="w">graph</span>}<span class="i">-&gt;error</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">image</span>} = <span class="i">$gd</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$gd</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : create_blank_graph()</span>
<span class="c"># Usage      : $graph-&gt;create_blank_graph();</span>
<span class="c"># Purpose    : create a blank graph</span>
<span class="c"># Returns    : the graph image that can be converted to png</span>
<span class="c"># Parameters : see option specs</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="create_blank_graph-"></a><span class="k">sub </span><span class="m">create_blank_graph</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="i">$self</span><span class="i">-&gt;_set_general_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># general config</span>
    <span class="k">my</span> <span class="i">$type</span>        = <span class="i">$self</span>-&gt;{<span class="w">type</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dclrs</span>       = <span class="i">$self</span>-&gt;{<span class="w">dclrs</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$bgclr</span>       = <span class="i">$self</span>-&gt;{<span class="w">bgclr</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$transparent</span> = <span class="i">$self</span>-&gt;{<span class="w">transparent</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$interlaced</span>  = <span class="i">$self</span>-&gt;{<span class="w">interlaced</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$zero_axis</span>   = <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$im</span> = <span class="i">new</span> <span class="i">GD::Image</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">width</span>}<span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">height</span>} <span class="s">)</span><span class="sc">;</span>

    <span class="c"># allocate some colors</span>
    <span class="k">my</span> <span class="i">$white</span> = <span class="i">$im</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">255</span><span class="cm">,</span> <span class="n">255</span><span class="cm">,</span> <span class="n">255</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$black</span> = <span class="i">$im</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">0</span><span class="cm">,</span>   <span class="n">0</span><span class="cm">,</span>   <span class="n">0</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c"># make the background transparent and interlaced</span>
    <span class="i">$im</span><span class="i">-&gt;transparent</span><span class="s">(</span><span class="i">$white</span><span class="s">)</span><span class="sc">;</span>
    <span class="i">$im</span><span class="i">-&gt;interlaced</span><span class="s">(</span><span class="q">'true'</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># Put a black frame around the picture</span>
    <span class="i">$im</span><span class="i">-&gt;rectangle</span><span class="s">(</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">width</span>} - <span class="n">1</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">height</span>} - <span class="n">1</span><span class="cm">,</span> <span class="i">$black</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#print Dumper $self-&gt;{graph};</span>
    <span class="i">$self</span>-&gt;{<span class="w">image</span>} = <span class="i">$im</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$im</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : get_PNG()</span>
<span class="c"># Usage      : $graph-&gt;get_PNG();</span>
<span class="c"># Purpose    : get PNG image of the graph</span>
<span class="c"># Returns    : PNG image of the graph</span>
<span class="c"># Parameters : -image: image to be converted. optional</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="get_PNG-"></a><span class="k">sub </span><span class="m">get_PNG</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>  = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span> = <span class="i">$args</span>{-<span class="w">image</span>} || <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">return</span> <span class="i">$image</span><span class="i">-&gt;png</span><span class="sc">;</span>
<span class="s">}</span>

<a name="get_GIF-"></a><span class="k">sub </span><span class="m">get_GIF</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>  = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>  = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span> = <span class="i">$args</span>{-<span class="w">image</span>} || <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">return</span> <span class="i">$image</span><span class="i">-&gt;gif</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># get the &lt;img src=&quot;some src&quot;/&gt;</span>
<a name="create_PNG_file-"></a><span class="k">sub </span><span class="m">create_PNG_file</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span>     = <span class="i">$args</span>{-<span class="w">image</span>} || <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$file_path</span> = <span class="i">$args</span>{-<span class="w">file_path</span>}<span class="sc">;</span>

    <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$IMG</span><span class="cm">,</span> <span class="q">&quot;&gt;$file_path&quot;</span> <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$!</span><span class="sc">;</span>
    <span class="k">binmode</span> <span class="i">$IMG</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">$IMG</span> <span class="i">$image</span><span class="i">-&gt;png</span><span class="sc">;</span>
    <span class="k">close</span> <span class="i">$IMG</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$return</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="i">$file_path</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$return</span><span class="sc">;</span>

<span class="s">}</span>

<a name="create_GIF_file-"></a><span class="k">sub </span><span class="m">create_GIF_file</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span>     = <span class="i">$args</span>{-<span class="w">image</span>} || <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$file_path</span> = <span class="i">$args</span>{-<span class="w">file_path</span>}<span class="sc">;</span>

    <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$IMG</span><span class="cm">,</span> <span class="q">&quot;&gt;$file_path&quot;</span> <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$!</span><span class="sc">;</span>
    <span class="k">binmode</span> <span class="i">$IMG</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">$IMG</span> <span class="i">$image</span><span class="i">-&gt;gif</span><span class="sc">;</span>
    <span class="k">close</span> <span class="i">$IMG</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$return</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">-e</span> <span class="i">$file_path</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$return</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c"># get the &lt;img src=&quot;some src&quot;/&gt;</span>
<a name="get_PNG_HTML-"></a><span class="k">sub </span><span class="m">get_PNG_HTML</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span>     = <span class="i">$args</span>{-<span class="w">image</span>} || <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$file_path</span> = <span class="i">$args</span>{-<span class="w">file_path</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$file_url</span>  = <span class="i">$args</span>{-<span class="w">file_url</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>      = <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$alt</span>       = <span class="i">$args</span>{-<span class="w">alt</span>}<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$IMG</span><span class="cm">,</span> <span class="q">&quot;&gt;$file_path&quot;</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">binmode</span> <span class="i">$IMG</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">$IMG</span> <span class="i">$image</span><span class="i">-&gt;png</span><span class="sc">;</span>
        <span class="k">close</span> <span class="i">$IMG</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">Message</span><span class="s">(</span><span class="q">&quot;cannot open $file_path: $!&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$link</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="q">&quot;&lt;a href='$link'&gt;&lt;img src='$file_url' alt='$alt'&gt;&lt;/img&gt;&lt;/a&gt;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">return</span> <span class="q">&quot;&lt;img src='$file_url' alt='$alt'&gt;&lt;/img&gt;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<a name="get_GIF_HTML-"></a><span class="k">sub </span><span class="m">get_GIF_HTML</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span>      = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span>     = <span class="i">$args</span>{-<span class="w">image</span>} || <span class="i">$self</span>-&gt;{<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$file_path</span> = <span class="i">$args</span>{-<span class="w">file_path</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$file_url</span>  = <span class="i">$args</span>{-<span class="w">file_url</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>      = <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$alt</span>       = <span class="i">$args</span>{-<span class="w">alt</span>}<span class="sc">;</span>

    <span class="k">open</span><span class="s">(</span> <span class="k">my</span> <span class="i">$IMG</span><span class="cm">,</span> <span class="q">&quot;&gt;$file_path&quot;</span> <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$!</span><span class="sc">;</span>
    <span class="k">binmode</span> <span class="i">$IMG</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">$IMG</span> <span class="i">$image</span><span class="i">-&gt;gif</span><span class="sc">;</span>
    <span class="k">close</span> <span class="i">$IMG</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$link</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="q">&quot;&lt;a href='$link'&gt;&lt;img src='$file_url' alt='$alt'&gt;&lt;/img&gt;&lt;/a&gt;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">return</span> <span class="q">&quot;&lt;img src='$file_url' alt='$alt'&gt;&lt;/img&gt;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_thumbnail()</span>
<span class="c"># Usage      : $graph-&gt;_set_thumbnail();</span>
<span class="c"># Purpose    : unset height, weight, title, x_label, y_label, etc to create a thumbnail</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : none</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_thumbnail-"></a><span class="k">sub </span><span class="m">_set_thumbnail</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$thumbnail</span> = <span class="i">$self</span>-&gt;{<span class="w">thumbnail</span>}<span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$thumbnail</span><span class="s">)</span> <span class="s">{</span>

        <span class="i">$self</span>-&gt;{<span class="w">height</span>}            = <span class="n">40</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">width</span>}             = <span class="n">100</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">title</span>}             = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">x_label</span>}           = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">y_label</span>}           = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">x_labels_vertical</span>} = <span class="n">0</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>}     = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">show_values</span>}       = <span class="n">0</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">no_legend</span>}         = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">axis_font</span>}         = <span class="q">&quot;gdTinyFont&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">y_number_format</span>}   = <span class="q">&quot;%.1g&quot;</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">marker_size</span>}       = <span class="n">1</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">axis_space</span>}        = <span class="n">0</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">y_label_skip</span>}      = <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>} - <span class="n">1</span><span class="sc">;</span>

        <span class="c"># determine x label_skip</span>
        <span class="k">my</span> <span class="i">$data</span> = <span class="i">$self</span>-&gt;{<span class="w">data</span>}<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$data</span> &amp;&amp; <span class="s">(</span> <span class="k">ref</span> <span class="i">$data</span> <span class="s">)</span> =~ <span class="q">/HASH/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$x_data</span> = <span class="i">$data</span>-&gt;{<span class="w">x_axis</span>}<span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$x_data</span> &amp;&amp; <span class="s">(</span> <span class="k">ref</span> <span class="i">$x_data</span> <span class="s">)</span> =~ <span class="q">/ARRAY/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$self</span>-&gt;{<span class="w">x_label_skip</span>} = <span class="s">(</span> <span class="k">scalar</span> <span class="i">@$x_data</span> <span class="s">)</span> - <span class="n">1</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="i">$self</span>-&gt;{<span class="w">axislabelclr</span>} = <span class="i">$self</span>-&gt;{<span class="w">bgclr</span>}<span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">long_ticks</span>}   = <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_axis_config()</span>
<span class="c"># Usage      : $graph-&gt;_set_axis_config(-x_tick_number=&gt;5);</span>
<span class="c"># Purpose    : set options for graph with axis</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_axis_config-"></a><span class="k">sub </span><span class="m">_set_axis_config</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="c"># y axis config</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_label</span>}         = <span class="i">$args</span>{-<span class="w">y_label</span>}         <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">y_label</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_max_value</span>}     = <span class="i">$args</span>{-<span class="w">y_max_value</span>}     <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">y_max_value</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_min_value</span>}     = <span class="i">$args</span>{-<span class="w">y_min_value</span>}     <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">y_min_value</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>}   = <span class="i">$args</span>{-<span class="w">y_tick_number</span>}   <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">y_tick_number</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_label_skip</span>}    = <span class="i">$args</span>{-<span class="w">y_label_skip</span>}    <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">y_label_skip</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_number_format</span>} = <span class="i">$args</span>{-<span class="w">y_number_format</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">y_number_format</span>}<span class="sc">;</span>

    <span class="c"># x axis config</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_label</span>}           = <span class="i">$args</span>{-<span class="w">x_label</span>}           <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_label</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_max_value</span>}       = <span class="i">$args</span>{-<span class="w">x_max_value</span>}       <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_max_value</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_min_value</span>}       = <span class="i">$args</span>{-<span class="w">x_min_value</span>}       <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_min_value</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_tick_number</span>}     = <span class="i">$args</span>{-<span class="w">x_tick_number</span>}     <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_tick_number</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_label_skip</span>}      = <span class="i">$args</span>{-<span class="w">x_label_skip</span>}      <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_label_skip</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_number_format</span>}   = <span class="i">$args</span>{-<span class="w">x_number_format</span>}   <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_number_format</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_labels_vertical</span>} = <span class="i">$args</span>{-<span class="w">x_labels_vertical</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">x_labels_vertical</span>}<span class="sc">;</span>

    <span class="c"># value config</span>
    <span class="i">$self</span>-&gt;{<span class="w">show_values</span>}   = <span class="i">$args</span>{-<span class="w">show_values</span>}   <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">show_values</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">values_format</span>} = <span class="i">$args</span>{-<span class="w">values_format</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">values_format</span>}<span class="sc">;</span>

    <span class="c"># ticks options</span>
    <span class="i">$self</span>-&gt;{<span class="w">long_ticks</span>} = <span class="i">$args</span>{-<span class="w">long_ticks</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">long_ticks</span>}<span class="sc">;</span>

    <span class="c"># axis space</span>
    <span class="i">$self</span>-&gt;{<span class="w">axis_space</span>} = <span class="i">$args</span>{-<span class="w">axis_space</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">axis_space</span>}<span class="sc">;</span>

    <span class="c"># set non-undef default values</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>} = <span class="n">5</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">y_label_skip</span>}  = <span class="n">1</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">y_label_skip</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">x_label_skip</span>}  = <span class="n">1</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">x_lable_skip</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">axis_space</span>}    = <span class="n">4</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">axis_space</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">long_ticks</span>}    = <span class="n">0</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">long_ticks</span>}<span class="sc">;</span>

    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_line_config()</span>
<span class="c"># Usage      : $graph-&gt;_set_line_config(-x_tick_number=&gt;5);</span>
<span class="c"># Purpose    : set options for Line graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_line_config-"></a><span class="k">sub </span><span class="m">_set_line_config</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="i">$self</span><span class="i">-&gt;_set_axis_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># set marker_size</span>
    <span class="i">$self</span>-&gt;{<span class="w">marker_size</span>} = <span class="i">$args</span>{-<span class="w">marker_size</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">marker_size</span>}<span class="sc">;</span>

    <span class="c"># set non-undef default values</span>
    <span class="i">$self</span>-&gt;{<span class="w">marker_size</span>} = <span class="n">4</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">marker_size</span>}<span class="sc">;</span>

    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_bar_config()</span>
<span class="c"># Usage      : $graph-&gt;_set_bar_config(-title=&gt;$title, -bar_width=&gt;$bar_width,</span>
<span class="c">#                                   -bar_spacing=&gt;$bar_spacing, -show_values=&gt;$show_values,</span>
<span class="c">#                                   -values_format=&gt;$values_format);</span>
<span class="c"># Purpose    : set options for bar graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : -title:         graph title. e.g., &quot;Test&quot;</span>
<span class="c">#              -bar_width:     width (in pixel) of the bar.   e.g., 5.  default: 5</span>
<span class="c">#              -bar_spacing:   spacing (in pixel) of the bar. e.g., 10. default: 10</span>
<span class="c">#              -show_values:   if the values are shown.       e.g., 1.  default: 0</span>
<span class="c">#              -values_format: a string representing the format of the values. same as used in sprintf. e.g., &quot;\$%d&quot;. default: undef</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_bar_config-"></a><span class="k">sub </span><span class="m">_set_bar_config</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="c"># set config for axises</span>
    <span class="i">$self</span><span class="i">-&gt;_set_axis_config</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

    <span class="c"># bar specific config</span>
    <span class="i">$self</span>-&gt;{<span class="w">bar_width</span>}   = <span class="i">$args</span>{-<span class="w">bar_width</span>}   <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">bar_width</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">bar_spacing</span>} = <span class="i">$args</span>{-<span class="w">bar_spacing</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">bar_spacing</span>}<span class="sc">;</span>

    <span class="c"># set non-undef default values</span>
    <span class="i">$self</span>-&gt;{<span class="w">bar_width</span>}   = <span class="n">10</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">bar_width</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">bar_spacing</span>} = <span class="n">4</span>  <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">bar_spacing</span>}<span class="sc">;</span>

    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_pie_config()</span>
<span class="c"># Usage      : $graph-&gt;_set_pie_config();</span>
<span class="c"># Purpose    : set options specific for Pie graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_pie_config-"></a><span class="k">sub </span><span class="m">_set_pie_config</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="c"># set config for pie</span>
    <span class="i">$self</span>-&gt;{<span class="q">'3d'</span>}           = <span class="i">$args</span>{<span class="q">'-3d'</span>}           <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{<span class="q">'-3d'</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">pie_height</span>}     = <span class="i">$args</span>{-<span class="w">pie_height</span>}     <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">pie_height</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">start_angle</span>}    = <span class="i">$args</span>{-<span class="w">start_angle</span>}    <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">start_angle</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">suppress_angle</span>} = <span class="i">$args</span>{-<span class="w">suppress_angle</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">suppress_angle</span>}<span class="sc">;</span>

    <span class="c">#set non-undef default values</span>
    <span class="i">$self</span>-&gt;{<span class="q">'3d'</span>}       = <span class="n">1</span>                     <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="q">'3d'</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">pie_height</span>} = <span class="n">0.1</span> * <span class="i">$self</span>-&gt;{<span class="w">height</span>} <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">pie_height</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">label</span>}      = <span class="i">$self</span>-&gt;{<span class="w">title</span>}<span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_matrix_config()</span>
<span class="c"># Usage      : $graph-&gt;_set_matrix_config();</span>
<span class="c"># Purpose    : set options specific for matrix</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_matrix_config-"></a><span class="k">sub </span><span class="m">_set_matrix_config</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="c"># set margin for title</span>
    <span class="i">$self</span>-&gt;{<span class="w">margin</span>}        = <span class="i">$args</span>{-<span class="w">margin</span>}        <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">margin</span>}<span class="sc">;</span>          <span class="c"># height for title</span>
    <span class="i">$self</span>-&gt;{<span class="w">grid_color</span>}    = <span class="i">$args</span>{-<span class="w">grid_color</span>}    <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">grid_color</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">content_color</span>} = <span class="i">$args</span>{-<span class="w">content_color</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">content_color</span>}<span class="sc">;</span>

    <span class="c">#set non-undef default values</span>
    <span class="i">$self</span>-&gt;{<span class="w">margin</span>}        = <span class="n">20</span>      <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">margin</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">grid_color</span>}    = <span class="q">&quot;black&quot;</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">grid_color</span>}<span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">content_color</span>} = <span class="q">&quot;black&quot;</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">content_color</span>}<span class="sc">;</span>

    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_general_config()</span>
<span class="c"># Usage      : $graph-&gt;_set_general_config();</span>
<span class="c"># Purpose    : set general options for all graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<span class="c"># set general settings</span>
<a name="_set_general_config-"></a><span class="k">sub </span><span class="m">_set_general_config</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="c"># thumbnail</span>
    <span class="i">$self</span>-&gt;{<span class="w">thumbnail</span>} = <span class="i">$args</span>{-<span class="w">thumbnail</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">data</span>}<span class="sc">;</span>

    <span class="c">#plot data</span>
    <span class="i">$self</span>-&gt;{<span class="w">data</span>} = <span class="i">$args</span>{-<span class="w">data</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">data</span>}<span class="sc">;</span>

    <span class="c"># graph title</span>
    <span class="i">$self</span>-&gt;{<span class="w">title</span>} = <span class="i">$args</span>{-<span class="w">title</span>} <span class="k">if</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">title</span>}<span class="sc">;</span>

    <span class="c">#general settings</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">type</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">type</span>} = <span class="i">$args</span>{-<span class="w">type</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">type</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">type</span>} ||= <span class="q">&quot;line&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">height</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">height</span>} = <span class="i">$args</span>{-<span class="w">height</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">height</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">height</span>} ||= <span class="n">300</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">width</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">width</span>} = <span class="i">$args</span>{-<span class="w">width</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">width</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">width</span>} ||= <span class="n">400</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">dclrs</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">dclrs</span>} = <span class="i">$args</span>{-<span class="w">dclrs</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">dclrs</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">dclrs</span>} ||= <span class="s">[</span><span class="q">qw(red orange yellow green dgreen blue purple black)</span><span class="s">]</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">bgclr</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">bgclr</span>} = <span class="i">$args</span>{-<span class="w">bgclr</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">bgclr</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">bgclr</span>} ||= <span class="q">&quot;white&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">axislabelclr</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">axislabelclr</span>} = <span class="i">$args</span>{-<span class="w">axislabelclr</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">axislabelclr</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">axislabelclr</span>} ||= <span class="q">&quot;blue&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">transparent</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">transparent</span>} = <span class="i">$args</span>{-<span class="w">transparent</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">transparent</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">transparent</span>} ||= <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">interlaced</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">interlaced</span>} = <span class="i">$args</span>{-<span class="w">interlaced</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">interlaced</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">interlaced</span>} ||= <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">exists</span> <span class="i">$args</span>{-<span class="w">zero_axis</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>} = <span class="i">$args</span>{-<span class="w">zero_axis</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>} ||= <span class="n">0</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_line_graph()</span>
<span class="c"># Usage      : $graph-&gt;_set_line_graph();</span>
<span class="c"># Purpose    : create the part of graph specific to Line graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_line_graph-"></a><span class="k">sub </span><span class="m">_set_line_graph</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="c"># graph type</span>
    <span class="k">my</span> <span class="i">$type</span> = <span class="i">$self</span>-&gt;{<span class="w">type</span>}<span class="sc">;</span>

    <span class="c"># width and height</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$self</span>-&gt;{<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$self</span>-&gt;{<span class="w">height</span>}<span class="sc">;</span>

    <span class="c">#data</span>
    <span class="k">my</span> <span class="i">$data</span> = <span class="i">$self</span>-&gt;{<span class="w">data</span>}<span class="sc">;</span>

    <span class="c"># graph title</span>
    <span class="k">my</span> <span class="i">$title</span> = <span class="i">$self</span>-&gt;{<span class="w">title</span>}<span class="sc">;</span>

    <span class="c"># y axis config</span>
    <span class="k">my</span> <span class="i">$y_label</span>         = <span class="i">$self</span>-&gt;{<span class="w">y_label</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_max_value</span>     = <span class="i">$self</span>-&gt;{<span class="w">y_max_value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_min_value</span>     = <span class="i">$self</span>-&gt;{<span class="w">y_min_value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_tick_number</span>   = <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_label_skip</span>    = <span class="i">$self</span>-&gt;{<span class="w">y_lable_skip</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_number_format</span> = <span class="i">$self</span>-&gt;{<span class="w">y_number_format</span>}<span class="sc">;</span>

    <span class="c"># x axis config</span>
    <span class="k">my</span> <span class="i">$x_label</span>           = <span class="i">$self</span>-&gt;{<span class="w">x_label</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_max_value</span>       = <span class="i">$self</span>-&gt;{<span class="w">x_max_value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_min_value</span>       = <span class="i">$self</span>-&gt;{<span class="w">x_min_value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_tick_number</span>     = <span class="i">$self</span>-&gt;{<span class="w">x_tick_number</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_label_skip</span>      = <span class="i">$self</span>-&gt;{<span class="w">x_label_skip</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_number_format</span>   = <span class="i">$self</span>-&gt;{<span class="w">x_number_format</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_labels_vertical</span> = <span class="i">$self</span>-&gt;{<span class="w">x_labels_vertical</span>}<span class="sc">;</span>

    <span class="c"># values config</span>
    <span class="k">my</span> <span class="i">$show_values</span>   = <span class="i">$self</span>-&gt;{<span class="w">show_values</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$values_format</span> = <span class="i">$self</span>-&gt;{<span class="w">values_format</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$zero_axis</span>     = <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>}<span class="sc">;</span>

    <span class="c"># ticks option</span>
    <span class="k">my</span> <span class="i">$long_ticks</span> = <span class="i">$self</span>-&gt;{<span class="w">long_ticks</span>}<span class="sc">;</span>

    <span class="c"># marker size</span>
    <span class="k">my</span> <span class="i">$marker_size</span> = <span class="i">$self</span>-&gt;{<span class="w">marker_size</span>}<span class="sc">;</span>

    <span class="c"># axis space</span>
    <span class="k">my</span> <span class="i">$axis_space</span> = <span class="i">$self</span>-&gt;{<span class="w">axis_space</span>}<span class="sc">;</span>

    <span class="c"># axis label color</span>
    <span class="k">my</span> <span class="i">$axis_label_color</span> = <span class="i">$self</span>-&gt;{<span class="w">axislabelclr</span>}<span class="sc">;</span>

    <span class="c">#push x axis into plot_data</span>
    <span class="k">my</span> <span class="i">$x_axis</span>    = <span class="i">$data</span>-&gt;{<span class="w">x_axis</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$plot_data</span> = <span class="s">[</span><span class="i">$x_axis</span><span class="s">]</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@legend</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%$data</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$key</span> <span class="k">ne</span> <span class="q">&quot;x_axis&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@legend</span><span class="cm">,</span>     <span class="i">$key</span> <span class="s">)</span><span class="sc">;</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@$plot_data</span><span class="cm">,</span> <span class="i">$data</span>-&gt;{<span class="i">$key</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$graph</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/line/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span> = <span class="w">GD::Graph::linespoints</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="i">$width</span><span class="cm">,</span> <span class="i">$height</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/xy/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span> = <span class="w">GD::Graph::xylinespoints</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="i">$width</span><span class="cm">,</span> <span class="i">$height</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span>
        <span class="w">title</span>             <span class="cm">=&gt;</span> <span class="i">$title</span><span class="cm">,</span>
        <span class="w">x_label</span>           <span class="cm">=&gt;</span> <span class="i">$x_label</span><span class="cm">,</span>
        <span class="w">x_tick_number</span>     <span class="cm">=&gt;</span> <span class="i">$x_tick_number</span><span class="cm">,</span>
        <span class="w">x_label_skip</span>      <span class="cm">=&gt;</span> <span class="i">$x_label_skip</span><span class="cm">,</span>
        <span class="w">x_number_format</span>   <span class="cm">=&gt;</span> <span class="i">$x_number_format</span><span class="cm">,</span>
        <span class="w">x_labels_vertical</span> <span class="cm">=&gt;</span> <span class="i">$x_labels_vertical</span><span class="cm">,</span>

        <span class="w">y_label</span>         <span class="cm">=&gt;</span> <span class="i">$y_label</span><span class="cm">,</span>
        <span class="w">y_tick_number</span>   <span class="cm">=&gt;</span> <span class="i">$y_tick_number</span><span class="cm">,</span>
        <span class="w">y_label_skip</span>    <span class="cm">=&gt;</span> <span class="i">$y_label_skip</span><span class="cm">,</span>
        <span class="w">y_number_format</span> <span class="cm">=&gt;</span> <span class="i">$y_number_format</span><span class="cm">,</span>

        <span class="w">show_values</span>   <span class="cm">=&gt;</span> <span class="i">$show_values</span><span class="cm">,</span>
        <span class="w">values_format</span> <span class="cm">=&gt;</span> <span class="i">$values_format</span><span class="cm">,</span>
        <span class="w">zero_axis</span>     <span class="cm">=&gt;</span> <span class="i">$zero_axis</span><span class="cm">,</span>

        <span class="w">long_ticks</span> <span class="cm">=&gt;</span> <span class="i">$long_ticks</span><span class="cm">,</span>

        <span class="w">marker_size</span> <span class="cm">=&gt;</span> <span class="i">$marker_size</span><span class="cm">,</span>

        <span class="w">axis_space</span> <span class="cm">=&gt;</span> <span class="i">$axis_space</span><span class="cm">,</span>

        <span class="w">axislabelclr</span> <span class="cm">=&gt;</span> <span class="i">$axis_label_color</span><span class="cm">,</span>

    <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$graph</span><span class="i">-&gt;error</span><span class="sc">;</span>

    <span class="c">#print Dumper $graph;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$y_min_value</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span> <span class="w">y_min_value</span> <span class="cm">=&gt;</span> <span class="i">$y_min_value</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$y_max_value</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span> <span class="w">y_max_value</span> <span class="cm">=&gt;</span> <span class="i">$y_max_value</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$x_min_value</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span> <span class="w">x_min_value</span> <span class="cm">=&gt;</span> <span class="i">$x_min_value</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$x_max_value</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span> <span class="w">x_max_value</span> <span class="cm">=&gt;</span> <span class="i">$x_max_value</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span> <span class="i">@legend</span> &gt; <span class="n">0</span> &amp;&amp; !<span class="i">$self</span>-&gt;{<span class="w">no_legend</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set_legend</span><span class="s">(</span><span class="i">@legend</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">axis_fond</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set_x_axis_font</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">axis_font</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="i">$graph</span><span class="i">-&gt;set_x_axis_font</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">axis_font</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">plot_data</span>} = <span class="i">$plot_data</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">legend</span>}    = \<span class="i">@legend</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">graph</span>}     = <span class="i">$graph</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_bar_graph()</span>
<span class="c"># Usage      : $graph-&gt;_set_bar_graph();</span>
<span class="c"># Purpose    : create the part of graph specific to Bar graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_bar_graph-"></a><span class="k">sub </span><span class="m">_set_bar_graph</span> <span class="s">{</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="c"># width and height</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$self</span>-&gt;{<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$self</span>-&gt;{<span class="w">height</span>}<span class="sc">;</span>

    <span class="c">#data</span>
    <span class="k">my</span> <span class="i">$data</span> = <span class="i">$self</span>-&gt;{<span class="w">data</span>}<span class="sc">;</span>

    <span class="c"># graph title</span>
    <span class="k">my</span> <span class="i">$title</span> = <span class="i">$self</span>-&gt;{<span class="w">title</span>}<span class="sc">;</span>

    <span class="c"># y axis config</span>
    <span class="k">my</span> <span class="i">$y_label</span>         = <span class="i">$self</span>-&gt;{<span class="w">y_label</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_max_value</span>     = <span class="i">$self</span>-&gt;{<span class="w">y_max_value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_min_value</span>     = <span class="i">$self</span>-&gt;{<span class="w">y_min_value</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_tick_number</span>   = <span class="i">$self</span>-&gt;{<span class="w">y_tick_number</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_label_skip</span>    = <span class="i">$self</span>-&gt;{<span class="w">y_lable_skip</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_number_format</span> = <span class="i">$self</span>-&gt;{<span class="w">y_number_format</span>}<span class="sc">;</span>

    <span class="c"># x axis config</span>
    <span class="k">my</span> <span class="i">$x_label</span>           = <span class="i">$self</span>-&gt;{<span class="w">x_label</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_tick_number</span>     = <span class="i">$self</span>-&gt;{<span class="w">x_tick_number</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_label_skip</span>      = <span class="i">$self</span>-&gt;{<span class="w">x_lable_skip</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$x_labels_vertical</span> = <span class="i">$self</span>-&gt;{<span class="w">x_labels_vertical</span>}<span class="sc">;</span>

    <span class="c"># bar config</span>
    <span class="k">my</span> <span class="i">$bar_width</span>   = <span class="i">$self</span>-&gt;{<span class="w">bar_width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$bar_spacing</span> = <span class="i">$self</span>-&gt;{<span class="w">spacing</span>}<span class="sc">;</span>

    <span class="c"># values config</span>
    <span class="k">my</span> <span class="i">$show_values</span>   = <span class="i">$self</span>-&gt;{<span class="w">show_values</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$values_format</span> = <span class="i">$self</span>-&gt;{<span class="w">values_format</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$zero_axis</span>     = <span class="i">$self</span>-&gt;{<span class="w">zero_axis</span>}<span class="sc">;</span>

    <span class="c"># get axis space</span>
    <span class="k">my</span> <span class="i">$axis_space</span> = <span class="i">$self</span>-&gt;{<span class="w">axis_space</span>}<span class="sc">;</span>

    <span class="c"># axis label color</span>
    <span class="k">my</span> <span class="i">$axis_label_color</span> = <span class="i">$self</span>-&gt;{<span class="w">axislabelclr</span>}<span class="sc">;</span>

    <span class="c">#push x axis into plot_data</span>
    <span class="k">my</span> <span class="i">$x_axis</span>    = <span class="i">$data</span>-&gt;{<span class="w">x_axis</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$plot_data</span> = <span class="s">[</span><span class="i">$x_axis</span><span class="s">]</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@legend</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%$data</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$key</span> <span class="k">ne</span> <span class="q">&quot;x_axis&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@legend</span><span class="cm">,</span>     <span class="i">$key</span> <span class="s">)</span><span class="sc">;</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@$plot_data</span><span class="cm">,</span> <span class="i">$data</span>-&gt;{<span class="i">$key</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$graph</span> = <span class="w">GD::Graph::bars</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="i">$width</span><span class="cm">,</span> <span class="i">$height</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span>
        <span class="w">title</span> <span class="cm">=&gt;</span> <span class="i">$title</span><span class="cm">,</span>

        <span class="w">x_label</span>           <span class="cm">=&gt;</span> <span class="i">$x_label</span><span class="cm">,</span>
        <span class="w">x_tick_number</span>     <span class="cm">=&gt;</span> <span class="i">$x_tick_number</span><span class="cm">,</span>
        <span class="w">x_label_skip</span>      <span class="cm">=&gt;</span> <span class="i">$x_label_skip</span><span class="cm">,</span>
        <span class="w">x_labels_vertical</span> <span class="cm">=&gt;</span> <span class="i">$x_labels_vertical</span><span class="cm">,</span>

        <span class="w">y_label</span>         <span class="cm">=&gt;</span> <span class="i">$y_label</span><span class="cm">,</span>
        <span class="w">y_tick_number</span>   <span class="cm">=&gt;</span> <span class="i">$y_tick_number</span><span class="cm">,</span>
        <span class="w">y_label_skip</span>    <span class="cm">=&gt;</span> <span class="i">$y_label_skip</span><span class="cm">,</span>
        <span class="w">y_number_format</span> <span class="cm">=&gt;</span> <span class="i">$y_number_format</span><span class="cm">,</span>

        <span class="w">bar_width</span>   <span class="cm">=&gt;</span> <span class="i">$bar_width</span><span class="cm">,</span>
        <span class="w">bar_spacing</span> <span class="cm">=&gt;</span> <span class="i">$bar_spacing</span><span class="cm">,</span>

        <span class="w">show_values</span>   <span class="cm">=&gt;</span> <span class="i">$show_values</span><span class="cm">,</span>
        <span class="w">values_format</span> <span class="cm">=&gt;</span> <span class="i">$values_format</span><span class="cm">,</span>
        <span class="w">zero_axis</span>     <span class="cm">=&gt;</span> <span class="i">$zero_axis</span><span class="cm">,</span>

        <span class="w">axis_space</span> <span class="cm">=&gt;</span> <span class="i">$axis_space</span><span class="cm">,</span>

        <span class="w">axislabelclr</span> <span class="cm">=&gt;</span> <span class="i">$axis_label_color</span><span class="cm">,</span>

    <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$graph</span><span class="i">-&gt;error</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$y_min_value</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span> <span class="w">y_min_value</span> <span class="cm">=&gt;</span> <span class="i">$y_min_value</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$y_max_value</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span> <span class="w">y_max_value</span> <span class="cm">=&gt;</span> <span class="i">$y_max_value</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span> <span class="i">@legend</span> &gt; <span class="n">0</span> &amp;&amp; !<span class="i">$self</span>-&gt;{<span class="w">no_legend</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set_legend</span><span class="s">(</span><span class="i">@legend</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">axis_fond</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$graph</span><span class="i">-&gt;set_x_axis_font</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">axis_font</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="i">$graph</span><span class="i">-&gt;set_x_axis_font</span><span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">axis_font</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$self</span>-&gt;{<span class="w">plot_data</span>} = <span class="i">$plot_data</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">legend</span>}    = \<span class="i">@legend</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">graph</span>}     = <span class="i">$graph</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_pie_graph()</span>
<span class="c"># Usage      : $graph-&gt;_set_pie_graph();</span>
<span class="c"># Purpose    : create the part of graph specific to Pie graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_pie_graph-"></a><span class="k">sub </span><span class="m">_set_pie_graph</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="c"># width and height</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$self</span>-&gt;{<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$self</span>-&gt;{<span class="w">height</span>}<span class="sc">;</span>

    <span class="c">#data</span>
    <span class="k">my</span> <span class="i">$data</span> = <span class="i">$self</span>-&gt;{<span class="w">data</span>}<span class="sc">;</span>

    <span class="c"># graph title</span>
    <span class="k">my</span> <span class="i">$label</span> = <span class="i">$self</span>-&gt;{<span class="w">label</span>}<span class="sc">;</span>

    <span class="c"># bar config</span>
    <span class="k">my</span> <span class="i">$threed</span>         = <span class="i">$self</span>-&gt;{<span class="q">'3d'</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$pie_height</span>     = <span class="i">$self</span>-&gt;{<span class="w">pie_height</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$start_angle</span>    = <span class="i">$self</span>-&gt;{<span class="w">start_angle</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$suppress_angle</span> = <span class="i">$self</span>-&gt;{<span class="w">suppress_angle</span>}<span class="sc">;</span>

    <span class="c">#push x axis into plot_data</span>
    <span class="k">my</span> <span class="i">$x_axis</span>    = <span class="i">$data</span>-&gt;{<span class="w">x_axis</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$plot_data</span> = <span class="s">[</span><span class="i">$x_axis</span><span class="s">]</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@legend</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%$data</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$key</span> <span class="k">ne</span> <span class="q">&quot;x_axis&quot;</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@legend</span><span class="cm">,</span>     <span class="i">$key</span> <span class="s">)</span><span class="sc">;</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@$plot_data</span><span class="cm">,</span> <span class="i">$data</span>-&gt;{<span class="i">$key</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$graph</span> = <span class="w">GD::Graph::pie</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="i">$width</span><span class="cm">,</span> <span class="i">$height</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$graph</span><span class="i">-&gt;set</span><span class="s">(</span>
        <span class="w">label</span> <span class="cm">=&gt;</span> <span class="i">$label</span><span class="cm">,</span>

        <span class="q">'3d'</span>           <span class="cm">=&gt;</span> <span class="i">$threed</span><span class="cm">,</span>
        <span class="w">pie_height</span>     <span class="cm">=&gt;</span> <span class="i">$pie_height</span><span class="cm">,</span>
        <span class="w">start_angle</span>    <span class="cm">=&gt;</span> <span class="i">$start_angle</span><span class="cm">,</span>
        <span class="w">suppress_angle</span> <span class="cm">=&gt;</span> <span class="i">$suppress_angle</span><span class="cm">,</span>

    <span class="s">)</span> <span class="k">or</span> <span class="k">die</span> <span class="i">$graph</span><span class="i">-&gt;error</span><span class="sc">;</span>

    <span class="i">$graph</span><span class="i">-&gt;set_value_font</span><span class="s">(</span><span class="w">gdMediumBoldFont</span><span class="s">)</span><span class="sc">;</span>

    <span class="i">$self</span>-&gt;{<span class="w">plot_data</span>} = <span class="i">$plot_data</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">legend</span>}    = \<span class="i">@legend</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">graph</span>}     = <span class="i">$graph</span><span class="sc">;</span>
    <span class="k">return</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c"># ============================================================================</span>
<span class="c"># Method     : _set_matrix_graph()</span>
<span class="c"># Usage      : $graph-&gt;_set_matrix_graph();</span>
<span class="c"># Purpose    : create the part of graph specific to Matrix graph</span>
<span class="c"># Returns    : none</span>
<span class="c"># Parameters : see option spec</span>
<span class="c"># Throws     : no exceptions</span>
<span class="c"># Comments   : none</span>
<span class="c"># See Also   : n/a</span>
<span class="c"># ============================================================================</span>

<a name="_set_matrix_graph-"></a><span class="k">sub </span><span class="m">_set_matrix_graph</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">$self</span>   = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$self</span>-&gt;{<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$self</span>-&gt;{<span class="w">height</span>}<span class="sc">;</span>

    <span class="c"># title</span>
    <span class="k">my</span> <span class="i">$title</span> = <span class="i">$self</span>-&gt;{<span class="w">title</span>}<span class="sc">;</span>

    <span class="c">#data</span>
    <span class="k">my</span> <span class="i">$data</span> = <span class="i">$self</span>-&gt;{<span class="w">data</span>}<span class="sc">;</span>

    <span class="c"># color</span>
    <span class="k">my</span> <span class="i">$grid_color</span>    = <span class="i">$self</span>-&gt;{<span class="w">grid_color</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$content_color</span> = <span class="i">$self</span>-&gt;{<span class="w">content_color</span>}<span class="sc">;</span>

    <span class="c"># title margin</span>
    <span class="k">my</span> <span class="i">$margin</span> = <span class="i">$self</span>-&gt;{<span class="w">margin</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$im</span> = <span class="i">new</span> <span class="i">GD::Image</span><span class="s">(</span> <span class="i">$width</span><span class="cm">,</span> <span class="i">$height</span> + <span class="i">$margin</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$white</span> = <span class="i">$im</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">255</span><span class="cm">,</span> <span class="n">255</span><span class="cm">,</span> <span class="n">255</span> <span class="s">)</span><span class="sc">;</span>    <span class="c"># background color</span>

    <span class="c">#grid color</span>
    <span class="i">$grid_color</span> = <span class="i">_convert_matrix_color</span><span class="s">(</span> -<span class="w">color</span> <span class="cm">=&gt;</span> <span class="i">$grid_color</span><span class="cm">,</span> -<span class="w">image</span> <span class="cm">=&gt;</span> <span class="i">$im</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#content color</span>
    <span class="i">$content_color</span> = <span class="i">_convert_matrix_color</span><span class="s">(</span> -<span class="w">color</span> <span class="cm">=&gt;</span> <span class="i">$content_color</span><span class="cm">,</span> -<span class="w">image</span> <span class="cm">=&gt;</span> <span class="i">$im</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$im</span><span class="i">-&gt;interlaced</span><span class="s">(</span><span class="q">'true'</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$x_start</span> = <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$y_start</span> = <span class="i">$margin</span><span class="sc">;</span>

    <span class="i">$im</span><span class="i">-&gt;string</span><span class="s">(</span> <span class="w">gdGiantFont</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">3</span><span class="cm">,</span> <span class="i">$title</span><span class="cm">,</span> <span class="i">$grid_color</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$im</span><span class="i">-&gt;rectangle</span><span class="s">(</span> <span class="i">$x_start</span><span class="cm">,</span> <span class="i">$y_start</span><span class="cm">,</span> <span class="i">$width</span> - <span class="n">1</span><span class="cm">,</span> <span class="i">$height</span> + <span class="i">$margin</span> - <span class="n">1</span><span class="cm">,</span> <span class="i">$grid_color</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$num_row</span> = <span class="k">scalar</span><span class="s">(</span> <span class="k">keys</span> <span class="i">%$data</span> <span class="s">)</span> || <span class="n">1</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@values_size</span> = <span class="k">map</span> <span class="s">{</span> <span class="k">scalar</span><span class="s">(</span><span class="i">@$_</span><span class="s">)</span> <span class="s">}</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="k">scalar</span><span class="s">(</span><span class="i">@$b</span><span class="s">)</span> &lt;=&gt; <span class="k">scalar</span><span class="s">(</span><span class="i">@$a</span><span class="s">)</span> <span class="s">}</span> <span class="k">values</span> <span class="i">%$data</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$num_col</span> = <span class="i">$values_size</span>[<span class="n">0</span>] || <span class="n">1</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$unit_height</span> = <span class="i">$height</span> / <span class="i">$num_row</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$unit_width</span>  = <span class="i">$width</span> / <span class="i">$num_col</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@keys</span> = <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%$data</span><span class="sc">;</span>

    <span class="k">for</span> <span class="s">(</span> <span class="k">my</span> <span class="i">$i</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$i</span> &lt; <span class="k">scalar</span> <span class="i">@keys</span><span class="sc">;</span> <span class="i">$i</span>++ <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@values</span> = <span class="i">@</span>{ <span class="i">$data</span>-&gt;{ <span class="i">$keys</span>[<span class="i">$i</span>] } }<span class="sc">;</span>
        <span class="k">for</span> <span class="s">(</span> <span class="k">my</span> <span class="i">$j</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$j</span> &lt; <span class="k">scalar</span> <span class="i">@values</span><span class="sc">;</span> <span class="i">$j</span>++ <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$x_top_left</span>     = <span class="i">$x_start</span> + <span class="i">$j</span> * <span class="i">$unit_width</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$y_top_left</span>     = <span class="i">$y_start</span> + <span class="i">$i</span> * <span class="i">$unit_height</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$x_bottom_right</span> = <span class="i">$x_start</span> + <span class="s">(</span> <span class="i">$j</span> + <span class="n">1</span> <span class="s">)</span> * <span class="i">$unit_width</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$y_bottom_right</span> = <span class="i">$y_start</span> + <span class="s">(</span> <span class="i">$i</span> + <span class="n">1</span> <span class="s">)</span> * <span class="i">$unit_height</span><span class="sc">;</span>

            <span class="i">$im</span><span class="i">-&gt;rectangle</span><span class="s">(</span> <span class="i">$x_top_left</span><span class="cm">,</span> <span class="i">$y_top_left</span><span class="cm">,</span> <span class="i">$x_bottom_right</span><span class="cm">,</span> <span class="i">$y_bottom_right</span><span class="cm">,</span> <span class="i">$grid_color</span> <span class="s">)</span><span class="sc">;</span>
            <span class="k">my</span> <span class="i">$cell_value</span> = <span class="i">$values</span>[<span class="i">$j</span>]<span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$cell_value</span><span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$cell_value</span> =~ <span class="q">/\w+/</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="i">$im</span><span class="i">-&gt;string</span><span class="s">(</span> <span class="w">gdMediumBoldFont</span><span class="cm">,</span> <span class="i">$x_top_left</span><span class="cm">,</span> <span class="i">$y_top_left</span><span class="cm">,</span> <span class="i">$cell_value</span><span class="cm">,</span> <span class="i">$content_color</span> <span class="s">)</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span>
                    <span class="i">$im</span><span class="i">-&gt;filledEllipse</span><span class="s">(</span> <span class="i">$x_top_left</span> + <span class="s">(</span> <span class="i">$unit_width</span> / <span class="n">2</span> <span class="s">)</span><span class="cm">,</span> <span class="i">$y_top_left</span> + <span class="s">(</span> <span class="i">$unit_height</span> / <span class="n">2</span> <span class="s">)</span><span class="cm">,</span> <span class="i">$unit_width</span><span class="cm">,</span> <span class="i">$unit_height</span><span class="cm">,</span> <span class="i">$content_color</span> <span class="s">)</span><span class="sc">;</span>

                    <span class="c">#$im-&gt;filledRectangle($x_top_left, $y_top_left, $x_bottom_right, $y_bottom_right,$black);</span>
                <span class="s">}</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$im</span><span class="i">-&gt;rectangle</span><span class="s">(</span> <span class="i">$x_top_left</span><span class="cm">,</span> <span class="i">$y_top_left</span><span class="cm">,</span> <span class="i">$x_bottom_right</span><span class="cm">,</span> <span class="i">$y_bottom_right</span><span class="cm">,</span> <span class="i">$grid_color</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="i">$self</span>-&gt;{<span class="w">image</span>} = <span class="i">$im</span><span class="sc">;</span>

    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="_convert_matrix_color-"></a><span class="k">sub </span><span class="m">_convert_matrix_color</span> <span class="s">{</span>

    <span class="k">my</span> <span class="i">%args</span>  = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$color</span> = <span class="i">$args</span>{-<span class="w">color</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span> = <span class="i">$args</span>{-<span class="w">image</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$return</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$color</span> =~ <span class="q">/black/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="i">$image</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$color</span> =~ <span class="q">/red/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="i">$image</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">255</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$color</span> =~ <span class="q">/blue/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="i">$image</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">255</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$return</span> = <span class="i">$image</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$return</span><span class="sc">;</span>

<span class="s">}</span>

<span class="n">1</span><span class="sc">;</span>
<a name="EOF-"></a></pre>
</body>
</html>
