<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Thu Sep  5 11:08:26 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/perl/Core/alDente/Web.pm</title>
<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #FFFFFF;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
</head>
<body>
<a name="-top-"></a>
<h1>lib/perl/Core/alDente/Web.pm</h1>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-alDente::Web-">package alDente::Web</a>
<ul>
<li><a href="#GoHome-">GoHome</a></li>
<li><a href="#icons-">icons</a></li>
<li><a href="#image-">image</a></li>
<li><a href="#get_dept_module-">get_dept_module</a></li>
<li><a href="#thumbnail-">thumbnail</a></li>
<li><a href="#page_icons-">page_icons</a></li>
<li><a href="#load_standard_icons-">load_standard_icons</a></li>
<li><a href="#alDente_header_bar_title-">alDente_header_bar_title</a></li>
<li><a href="#alDente_header_bar-">alDente_header_bar</a></li>
<li><a href="#scan_button-">scan_button</a></li>
<li><a href="#app_info_bar-">app_info_bar</a></li>
<li><a href="#header_messages-">header_messages</a></li>
<li><a href="#validate_Printers-">validate_Printers</a></li>
<li><a href="#show_current_messages-">show_current_messages</a></li>
<li><a href="#Menu-">Menu</a></li>
<li><a href="#hide_element-">hide_element</a></li>
<li><a href="#add_sub_labels-">add_sub_labels</a></li>
<li><a href="#load_user_views-">load_user_views</a></li>
<li><a href="#Tab_Bar-">Tab_Bar</a></li>
<li><a href="#reload_parameters-">reload_parameters</a></li>
<li><a href="#initialize_cookies-">initialize_cookies</a></li>
<li><a href="#gen_cookies-">gen_cookies</a></li>
<li><a href="#Initialize_page-">Initialize_page</a></li>
<li><a href="#unInitialize_page-">unInitialize_page</a></li>
<li><a href="#show_topbar-">show_topbar</a></li>
<li><a href="#user_label-">user_label</a></li>
<li><a href="#show_botbar-">show_botbar</a></li>
<li><a href="#reload_input-">reload_input</a></li>
<li><a href="#login_password-">login_password</a></li>
</ul>
</li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->
<hr />
<!-- contents of filename: lib/perl/Core/alDente/Web.pm -->
<pre>
<a name="package-alDente::Web-"></a><span class="k">package </span><span class="i">alDente::Web</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">warnings</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">CGI</span> <span class="q">qw(:standard)</span><span class="sc">;</span>
<span class="k">use</span> <span class="i">CGI::Carp</span><span class="s">(</span><span class="q">'fatalsToBrowser'</span><span class="s">)</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">DBI</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Data::Dumper</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Benchmark</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">RGTools::RGWeb</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">RGTools::RGIO</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">RGTools::Views</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">SDB::HTML</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">SDB::CustomSettings</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">alDente::SDB_Defaults</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">alDente::Form</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">alDente::Barcoding</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">alDente::Barcode_Views</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">vars</span> <span class="q">qw($scanner_mode $Connection $user $version_number %Benchmark @icons_list $Sess $Security $issue_tracker $jira_link %Configs)</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$headerbg</span>          = <span class="q">'#DDDDDD'</span><span class="sc">;</span>     <span class="c">## &quot;rgb(200,200,200)&quot;;</span>
<span class="k">my</span> <span class="i">$headerfontc</span>       = <span class="q">&quot;'#AAAAAA'&quot;</span><span class="sc">;</span>
<span class="k">my</span> <span class="i">$header_bar_colour</span> = <span class="q">&quot;#DDDDDD&quot;</span><span class="sc">;</span>

<span class="c">########################################</span>
<span class="c">#</span>
<span class="c">#  Creates the tab for each department in alDente</span>
<span class="c">#</span>
<span class="c">####################</span>
<a name="GoHome-"></a><span class="k">sub </span><span class="m">GoHome</span> <span class="s">{</span>
<span class="c">####################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,dept,open_layer'</span><span class="cm">,</span> -<span class="w">mandatory</span> <span class="cm">=&gt;</span> <span class="q">'dbc,dept'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="i">$args</span>{-<span class="w">dbc</span>} || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dept</span> = <span class="i">$args</span>{-<span class="w">dept</span>} || <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'home_dept'</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$quiet</span> = <span class="i">$args</span>{-<span class="w">quiet</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$open_layer</span> = <span class="i">$args</span>{-<span class="w">open_layer</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$access</span>     = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'Access'</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="s">(</span> <span class="i">$access</span>-&gt;{<span class="i">$dept</span>} || <span class="i">$access</span>-&gt;{<span class="q">'LIMS Admin'</span>} || <span class="i">$dept</span> <span class="k">eq</span> <span class="q">'Guest'</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>

        <span class="c"># This line shouldn't generaly be displayed, unless user is doing something bad!</span>
        <span class="c">#  ie tampering with the URL to gain access to a different department</span>
        <span class="c"># print &quot;&lt;blink&gt;No Access for '$dept' for you!&lt;/blink&gt;&lt;br&gt;&quot;;</span>

        <span class="k">my</span> <span class="s">(</span> <span class="i">$path</span><span class="cm">,</span> <span class="i">$module</span> <span class="s">)</span> = <span class="i">get_dept_module</span><span class="s">(</span><span class="i">$dept</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$path</span> =~ <span class="q">/alDente/</span> &amp;&amp; <span class="k">keys</span> <span class="i">%</span>{<span class="i">$access</span>} <span class="s">)</span> <span class="s">{</span>

            <span class="c">#No home page for the department, go to the next available department</span>
            <span class="k">my</span> <span class="i">$old_dept</span> = <span class="i">$dept</span><span class="sc">;</span>
            <span class="s">(</span><span class="i">$dept</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%</span>{<span class="i">$access</span>}<span class="sc">;</span>

            <span class="c">#$Sess-&gt;warning(&quot;No $old_dept department home page, go to $dept department instead)&quot;);</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$dbc</span><span class="i">-&gt;session</span><span class="i">-&gt;warning</span><span class="s">(</span><span class="q">&quot;$dept Department not available for this user - see LIMS Admin to add if required&quot;</span><span class="s">)</span><span class="sc">;</span>

            <span class="k">return</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="c"># Dynamicly get the department module path and name</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$path</span><span class="cm">,</span> <span class="i">$module</span> <span class="s">)</span> = <span class="i">get_dept_module</span><span class="s">(</span><span class="i">$dept</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">require</span> <span class="i">$path</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$page</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$scanner_mode</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">require</span> <span class="w">alDente::Scanner</span><span class="sc">;</span>
        <span class="i">$page</span> = <span class="i">alDente::Scanner::home_page</span><span class="s">(</span><span class="i">$dbc</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>

        <span class="c">#       require $module;</span>
        <span class="i">$page</span> = <span class="i">$module</span><span class="i">-&gt;home_page</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">dept</span> <span class="cm">=&gt;</span> <span class="i">$dept</span><span class="cm">,</span> -<span class="w">open_layer</span> <span class="cm">=&gt;</span> <span class="i">$open_layer</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$quiet</span> <span class="s">)</span> <span class="s">{</span> <span class="k">print</span> <span class="i">$page</span> <span class="s">}</span>

    <span class="k">return</span> <span class="i">$page</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##################</span>
<a name="icons-"></a><span class="k">sub </span><span class="m">icons</span> <span class="s">{</span>
<span class="c">##################</span>
    <span class="k">my</span> <span class="i">%args</span>         = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'name,dept,dbase'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$key</span>          = <span class="i">$args</span>{-<span class="w">name</span>}<span class="sc">;</span>                                       <span class="c">## indicate thumbnail; otherwise retrieves array of defined icons</span>
    <span class="k">my</span> <span class="i">$dbc</span>          = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$no_link</span>      = <span class="i">$args</span>{-<span class="w">no_link</span>}<span class="sc">;</span>                                    <span class="c">## enable link from label if applicable</span>
    <span class="k">my</span> <span class="i">$no_label</span>     = <span class="i">$args</span>{-<span class="w">no_label</span>} || <span class="n">0</span><span class="sc">;</span>                              <span class="c">## show label below icon</span>
    <span class="k">my</span> <span class="i">$no_tip</span>       = <span class="i">$args</span>{-<span class="w">no_tip</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$window</span>       = <span class="i">$args</span>{-<span class="w">window</span>}<span class="sc">;</span>                                     <span class="c">## open in new window option (eg -window=&gt;['icon_window'])</span>
    <span class="k">my</span> <span class="i">$custom_icons</span> = <span class="i">$args</span>{-<span class="w">custom_icons</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image</span>        = <span class="i">$args</span>{-<span class="w">image</span>}<span class="sc">;</span>                                      <span class="c">## similar, but simply returns image (same usage as name)</span>
    <span class="k">my</span> <span class="i">$hash</span>         = <span class="i">$args</span>{-<span class="w">hash</span>}<span class="sc">;</span>                                       <span class="c">## return hash IMG =&gt; link</span>
    <span class="k">my</span> <span class="i">$label</span>        = <span class="i">$args</span>{-<span class="w">label</span>}<span class="sc">;</span>                                      <span class="c">## long or short format with name + image</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$image</span><span class="s">)</span> <span class="s">{</span> <span class="i">$key</span> = <span class="i">$image</span><span class="sc">;</span> <span class="i">$no_label</span> = <span class="n">1</span> <span class="s">}</span>

    <span class="k">my</span> <span class="i">$pic_only</span> = <span class="i">$args</span>{-<span class="w">pic_only</span>}<span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$pic_only</span><span class="s">)</span> <span class="s">{</span> <span class="s">(</span> <span class="i">$no_link</span><span class="cm">,</span> <span class="i">$no_label</span><span class="cm">,</span> <span class="i">$no_tip</span> <span class="s">)</span> = <span class="s">(</span> <span class="n">1</span><span class="cm">,</span> <span class="n">1</span><span class="cm">,</span> <span class="n">1</span> <span class="s">)</span> <span class="s">}</span>

    <span class="k">my</span> <span class="i">$dept</span>  = <span class="i">$args</span>{-<span class="w">dept</span>}  || <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbase</span> = <span class="i">$args</span>{-<span class="w">dbase</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$args</span>{-<span class="w">height</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$args</span>{-<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$home_dept</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$department</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$size_spec</span> = <span class="q">''</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$height</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$size_spec</span> .= <span class="q">&quot;height=$height&quot;</span><span class="sc">;</span>
    <span class="s">}</span>    <span class="c">## allow specification of icon heights...</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$width</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$size_spec</span> .= <span class="q">&quot; width=$width&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">%images</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">%custom_images</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$custom_icons</span><span class="s">)</span> <span class="s">{</span> <span class="i">%custom_images</span> = <span class="i">%$custom_icons</span> <span class="s">}</span>

    <span class="c">## Database independent Icons ##</span>
    <span class="i">$images</span>{<span class="w">Daily_Planner</span>}{<span class="w">icon</span>} = <span class="q">&quot;Daily_Planner.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Daily_Planner</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=Cap_Seq::Statistics_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Daily_Planner</span>}{<span class="w">name</span>} = <span class="q">&quot;Daily Planner&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Daily_Planner</span>}{<span class="w">tip</span>}  = <span class="q">&quot;customized Daily Planner views for Sequencing group&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Subscription</span>}{<span class="w">icon</span>} = <span class="q">&quot;envelope.gif&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Subscription</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Subscription_Event_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Subscription</span>}{<span class="w">name</span>} = <span class="q">&quot;Subscription&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Healthbank_Statistics</span>}{<span class="w">icon</span>} = <span class="q">&quot;data.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Healthbank_Statistics</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=Healthbank::Statistics_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Healthbank_Statistics</span>}{<span class="w">name</span>} = <span class="q">&quot;Statistics&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Healthbank_Statistics</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Project level Summaries; (see Summary icon for Laboratory level summaries)&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Healthbank_Help</span>}{<span class="w">icon</span>} = <span class="q">&quot;help.gif&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Healthbank_Help</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=Healthbank::Department_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Healthbank_Help</span>}{<span class="w">name</span>} = <span class="q">&quot;Healthbank Help&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Healthbank_Help</span>}{<span class="w">tip</span>}  = <span class="q">&quot;General Help for using Healthbank LIMS&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Pipeline</span>}{<span class="w">icon</span>} = <span class="q">&quot;data.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pipeline</span>}{<span class="w">url</span>}  = <span class="q">&quot;Pipeline+Summary=1&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pipeline</span>}{<span class="w">name</span>} = <span class="q">&quot;Pipeline Summary&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pipeline</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Retrieve details for individual Pipelines or Protocols&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Protocols</span>}{<span class="w">icon</span>} = <span class="q">&quot;data.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Protocols</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Protocol_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Protocols</span>}{<span class="w">name</span>} = <span class="q">&quot;Lab Protocols&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Protocols</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Retrieve details or edit Lab Protocols&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Solutions_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;solution.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Solutions_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Solution_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Solutions_App</span>}{<span class="w">name</span>} = <span class="q">&quot;Solution&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Solutions_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;* For new reagents: go to the 'Purchasing' page to barcode a new reagent&lt;BR&gt;* For new solutions: simply scan their barcodes and click on the main 'Scan' button at the top of the page&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Views</span>}{<span class="w">icon</span>} = <span class="q">&quot;data.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Views</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;alDente::View_App&amp;Sections=GSC_Internal,Group,Employee,Other&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Views</span>}{<span class="w">name</span>} = <span class="q">'Views'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Views</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Create and use views&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">DBField</span>}{<span class="w">icon</span>} = <span class="q">&quot;help.gif&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">DBField</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::DBField_App&quot;</span><span class="sc">;</span>

<span class="c">## phase out _App keys ##</span>
    <span class="i">$images</span>{<span class="w">Equipment_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;Equipment.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Equipment_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Equipment_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Equipment_App</span>}{<span class="w">name</span>} = <span class="q">'Equipment'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Equipment_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Search for Equipment&lt;BR&gt;Schedule or View Maintenance&lt;BR&gt;Inventory on Storage Freezers&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">icon</span>} = <span class="q">&quot;Equipment.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Equipment_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">name</span>} = <span class="q">'Equipment'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Search for Equipment&lt;BR&gt;Schedule or View Maintenance&lt;BR&gt;Inventory on Storage Freezers&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">System_Monitor</span>}{<span class="w">icon</span>} = <span class="q">&quot;System.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">System_Monitor</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::System_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">System_Monitor</span>}{<span class="w">name</span>} = <span class="q">'System Monitor'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">System_Monitor</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Monitors volumes and directories&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Help</span>}{<span class="w">icon</span>} = <span class="q">&quot;help.gif&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Help</span>}{<span class="w">link</span>} = <span class="q">&quot;help.pl&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Queries</span>}{<span class="w">icon</span>} = <span class="q">&quot;help.gif&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Queries</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::View_App&amp;Open+View=1&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Barcodes</span>}{<span class="w">icon</span>} = <span class="q">'mini_stripe.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Barcodes</span>}{<span class="w">url</span>}  = <span class="q">'Barcode_Event=Home'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Rearrays</span>}{<span class="w">icon</span>} = <span class="q">&quot;Plate.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Rearrays</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::ReArray_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Rearrays</span>}{<span class="w">tip</span>}  = <span class="q">&quot;rearray samples&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Pool_ReArray</span>}{<span class="w">icon</span>} = <span class="q">&quot;Plate.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pool_ReArray</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::ReArray_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pool_ReArray</span>}{<span class="w">name</span>} = <span class="q">&quot;Pool/ReArray&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pool_ReArray</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Pool/ReArray samples&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Pool_ReArray_to_Tube</span>}{<span class="w">icon</span>} = <span class="q">&quot;Plate.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pool_ReArray_to_Tube</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::ReArray_App&amp;rm=Manually Set Up ReArray/Pooling&amp;Target Well Nomenclature=Tube&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pool_ReArray_to_Tube</span>}{<span class="w">name</span>} = <span class="q">&quot;Pool/ReArray to Tube&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Pool_ReArray_to_Tube</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Pool/ReArray samples into Tubes&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Search</span>}{<span class="w">icon</span>} = <span class="q">'flashlight.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Search</span>}{<span class="w">name</span>} = <span class="q">'Search'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Search</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Receiving</span>}{<span class="w">icon</span>} = <span class="q">'truck.jpg'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Receive_Shipment</span>}{<span class="w">icon</span>} = <span class="q">'truck.jpg'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Receive_Shipment</span>}{<span class="w">name</span>} = <span class="q">'Receive Samples'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Receive_Shipment</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=alDente::Shipment_App&amp;rm=Receive+Samples&amp;Grey=FKRecipient_Employee__ID,Shipment_Status,Shipment_Type&amp;FKRecipient_Employee__ID=&lt;USERID&gt;&amp;Shipment_Received=&lt;NOW&gt;&amp;Shipment_Status=Received'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Export</span>}{<span class="w">icon</span>} = <span class="q">'truck.jpg'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Export</span>}{<span class="w">name</span>} = <span class="q">'Export Samples'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Export</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=alDente::Rack_App&amp;rm=Show Export Form'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">In_Transit</span>}{<span class="w">icon</span>} = <span class="q">'truck.jpg'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">In_Transit</span>}{<span class="w">name</span>} = <span class="q">'In Transit'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">In_Transit</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=alDente::Rack_App&amp;rm=View Items in Transit'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Import</span>}{<span class="w">icon</span>} = <span class="q">'uplink.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Import</span>}{<span class="w">name</span>} = <span class="q">'Upload'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Import</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=SDB::Import_App&amp;rm=home'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Custom_Import</span>}{<span class="w">icon</span>} = <span class="q">'uplink.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Custom_Import</span>}{<span class="w">name</span>} = <span class="q">'Custom Upload'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Custom_Import</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=alDente::Transform_App'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">POG</span>}{<span class="w">icon</span>} = <span class="q">'POG.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">POG</span>}{<span class="w">name</span>} = <span class="q">'POG Home'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">POG</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=Biospecimen_Core::POG_App'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Sample_Sheets</span>}{<span class="w">icon</span>} = <span class="q">&quot;ssheet.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Sample_Sheets</span>}{<span class="w">url</span>}  = <span class="q">&quot;Sample+Sheets=1&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Sample_Sheets</span>}{<span class="w">name</span>} = <span class="q">'Sample Sheets'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Session</span>}{<span class="w">icon</span>} = <span class="q">&quot;text-enriched.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Session</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=SDB::Session_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Session</span>}{<span class="w">name</span>} = <span class="q">'Session'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Template</span>}{<span class="w">icon</span>} = <span class="q">&quot;new_file.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Template</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Template_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Template</span>}{<span class="w">name</span>} = <span class="q">'Template'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Employee</span>}{<span class="w">icon</span>} = <span class="q">&quot;EMPLOYEE1.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Employee</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Employee_App&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Employee</span>}{<span class="w">name</span>} = <span class="q">'Employee'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Employee</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Manage Employees&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">JIRA</span>}{<span class="w">icon</span>} = <span class="q">&quot;ssheet.png&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">JIRA</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=JIRA::Jira_App&amp;rm=View+Jira+Tickets&quot;</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">JIRA</span>}{<span class="w">name</span>} = <span class="q">'JIRA'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">JIRA</span>}{<span class="w">tip</span>}  = <span class="q">&quot;view progress on JIRA tickets&quot;</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Maintenance</span>}{<span class="w">icon</span>} = <span class="q">'wrench.png'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Storage</span>}{<span class="w">icon</span>}        = <span class="q">'freezer2.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="q">'Moves To'</span>}{<span class="w">icon</span>}     = <span class="q">'right_arrow1.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Approval</span>}{<span class="w">icon</span>}       = <span class="q">'Approval.ico'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Customize</span>}{<span class="w">icon</span>}      = <span class="q">'Customize.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Approved</span>}{<span class="w">icon</span>}       = <span class="q">'Approved.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Processed</span>}{<span class="w">icon</span>}      = <span class="q">'processed.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Sample_Request</span>}{<span class="w">icon</span>} = <span class="q">'box_request.png'</span><span class="sc">;</span>

    <span class="i">$images</span>{<span class="w">Xref</span>}{<span class="w">icon</span>} = <span class="q">'Approved.png'</span><span class="sc">;</span>
    <span class="i">$images</span>{<span class="w">Xref</span>}{<span class="w">name</span>} = <span class="q">'Xref Templates'</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%custom_images</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">## override if defined in custom icons ##</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$images</span>{<span class="i">$key</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$subkey</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$custom_images</span>{<span class="i">$key</span>} } <span class="s">)</span> <span class="s">{</span>
                <span class="i">$images</span>{<span class="i">$key</span>}{<span class="i">$subkey</span>} = <span class="i">$custom_images</span>{<span class="i">$key</span>}{<span class="i">$subkey</span>}<span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$images</span>{<span class="i">$key</span>} = <span class="i">$custom_images</span>{<span class="i">$key</span>}<span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$homelink</span><span class="sc">;</span>
    <span class="c">### Database specific Icons ###</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$dbc</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$homelink</span> = <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$dbase_mode</span> = <span class="i">$dbc</span>-&gt;{<span class="w">dbase_mode</span>}<span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$key</span><span class="s">)</span> <span class="s">{</span>
            <span class="c">## only necessary if key passed ##</span>
            <span class="i">$dept</span> ||= <span class="i">$dbc</span><span class="i">-&gt;config</span><span class="s">(</span><span class="q">'Target_Department'</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$home_dept</span> = <span class="i">$dbc</span><span class="i">-&gt;session</span><span class="i">-&gt;param</span><span class="s">(</span><span class="q">'home_dept'</span><span class="s">)</span><span class="sc">;</span>
            <span class="i">$dbase_mode</span> ||= <span class="i">$dbc</span>-&gt;{<span class="w">dbase_mode</span>}<span class="sc">;</span>

            <span class="i">$department</span> = <span class="i">$dept</span><span class="sc">;</span>
            <span class="i">$department</span> =~ <span class="q">s/ /_/</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="i">$images</span>{<span class="w">Home</span>}{<span class="w">icon</span>} = <span class="q">&quot;home.gif&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Home</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Target_Department=$home_dept&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Home</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Default Home page&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Current_Dept</span>}{<span class="w">icon</span>} = <span class="q">&quot;home.gif&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Current_Dept</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Target_Department=$dept&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Current_Dept</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Home page for the current department&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Home</span>}{<span class="w">tip</span>} = <span class="q">&quot;Home page for the current department&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Issues</span>}{<span class="w">icon</span>} = <span class="q">&quot;bug.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Issues</span>}{<span class="w">name</span>} = <span class="q">'Bugs'</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$Configs</span>{<span class="w">jira_link</span>} <span class="s">)</span> <span class="s">{</span>
            <span class="i">$images</span>{<span class="w">Issues</span>}{<span class="w">link</span>} = <span class="i">$Configs</span>{<span class="w">jira_link</span>}<span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$images</span>{<span class="w">Issues</span>}{<span class="w">url</span>} = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Issues_Home=1&quot;</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="i">$images</span>{<span class="w">Login</span>}{<span class="w">icon</span>} = <span class="q">&quot;login.gif&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Login</span>}{<span class="w">url</span>}  = <span class="q">&quot;Re+Log-In=1&amp;Database_Mode=$dbase_mode&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Changes</span>}{<span class="w">icon</span>} = <span class="q">&quot;NEW.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Changes</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Quick+Help=New_Changes&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Cap_Run_Stat</span>}{<span class="w">icon</span>} = <span class="q">&quot;Statistics2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Cap_Run_Stat</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Cap_Seq::Run_Stat_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Cap_Run_Stat</span>}{<span class="w">name</span>} = <span class="q">'Capillary Stats'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Cap_Run_Stat</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Capillary Run Statiscs&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Illumina_Run_Stat</span>}{<span class="w">icon</span>} = <span class="q">&quot;Statistics2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Illumina_Run_Stat</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Illumina::Run_Stat_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Illumina_Run_Stat</span>}{<span class="w">name</span>} = <span class="q">'Illumina Stats'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Illumina_Run_Stat</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Illumina Run Statiscs&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">SOLID_Run_Stat</span>}{<span class="w">icon</span>} = <span class="q">&quot;Statistics2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">SOLID_Run_Stat</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;SOLID::Run_Stat_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">SOLID_Run_Stat</span>}{<span class="w">name</span>} = <span class="q">'SOLID SDatabase_Mode=$dbase_modeats'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">SOLID_Run_Stat</span>}{<span class="w">tip</span>}  = <span class="q">&quot;SOLID Run Statiscs&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Last_24h</span>}{<span class="w">icon</span>} = <span class="q">&quot;hglass2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Last_24h</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Last+24+Hours=1&amp;Include+Runs=Production&amp;Include+Runs=Test&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Last_24h</span>}{<span class="w">name</span>} = <span class="q">'Last 24h'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Last_24h</span>}{<span class="w">tip</span>}  = <span class="q">'Retrieve Run summaries collected within last 24 hours (or as requested)'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Solexa_Data</span>}{<span class="w">icon</span>} = <span class="q">&quot;hglass2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solexa_Data</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Solexa+Summary=1&amp;Include+Runs=Production&amp;Include+Runs=Test&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solexa_Data</span>}{<span class="w">name</span>} = <span class="q">'Solexa'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solexa_Data</span>}{<span class="w">tip</span>}  = <span class="q">'Solexa Run Summary'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">GenechipExpSummary</span>}{<span class="w">icon</span>} = <span class="q">&quot;hglass2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">GenechipExpSummary</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Genechip+Expression+Summary=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">GenechipExpSummary</span>}{<span class="w">name</span>} = <span class="q">&quot;GCOS Expression Summary&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">GenechipMapSummary</span>}{<span class="w">icon</span>} = <span class="q">&quot;hglass2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">GenechipMapSummary</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Genechip+Mapping+Summary=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">GenechipMapSummary</span>}{<span class="w">name</span>} = <span class="q">&quot;GCOS Mapping Summary&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">BioanalyzerSummary</span>}{<span class="w">icon</span>} = <span class="q">&quot;hglass2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioanalyzerSummary</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Bioanalyzer+Summary=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioanalyzerSummary</span>}{<span class="w">name</span>} = <span class="q">&quot;Bioanalyzer Run Summary&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">GelRunSummary</span>}{<span class="w">icon</span>} = <span class="q">&quot;hglass2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">GelRunSummary</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Mapping_Summary=1&amp;Generate+Results=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">GelRunSummary</span>}{<span class="w">name</span>} = <span class="q">&quot;Gel Run Summary&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Solutions</span>}{<span class="w">icon</span>} = <span class="q">&quot;solution.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solutions</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Standard+Page=Solution&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">icon</span>} = <span class="q">&quot;Equipment.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Standard+Page=Equipment&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Equipment</span>}{<span class="w">name</span>} = <span class="q">'Equipment'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Rack</span>}{<span class="w">icon</span>} = <span class="q">&quot;shelf.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Rack</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;cgi_application=alDente::Rack_App&amp;rm=Standard+Page&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Rack</span>}{<span class="w">name</span>} = <span class="q">'Location Tracking'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Stat_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;Statistics2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Stat_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;$department&quot;</span> . <span class="q">&quot;::Statistics_App&amp;Generate+Results=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Stat_App</span>}{<span class="w">name</span>} = <span class="q">'Stats'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Stat_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Project level Summaries; (see Summary icon for Laboratory level summaries)&quot;</span><span class="sc">;</span>

        <span class="c">### The icons should not have the name of the dept in them ... delete Database_BC - use Database instead...</span>
        <span class="i">$images</span>{<span class="w">Database</span>}{<span class="w">icon</span>} = <span class="q">&quot;db_update.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Database</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;$department&quot;</span> . <span class="q">&quot;::Department_App&amp;rm=Database&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Database</span>}{<span class="w">name</span>} = <span class="q">'Database'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Database</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Search and Add to Database Tables&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Modules</span>}{<span class="w">icon</span>} = <span class="q">&quot;db_update.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Modules</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Document_App&amp;rm=View Modules&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Modules</span>}{<span class="w">name</span>} = <span class="q">'Modules'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Modules</span>}{<span class="w">tip</span>}  = <span class="q">&quot;View Help Pages for Modules&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;$department&quot;</span> . <span class="q">&quot;::Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Summary_App</span>}{<span class="w">name</span>} = <span class="q">'Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Summary_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Shipments</span>}{<span class="w">icon</span>} = <span class="q">'box.png'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Shipments</span>}{<span class="w">name</span>} = <span class="q">'Shipments'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Shipments</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=alDente::Shipment_App&amp;rm=List+Shipments&amp;LIMIT='</span> . <span class="q">&quot;$department&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Sample_Request</span>}{<span class="w">icon</span>} = <span class="q">'box_request.png'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Sample_Request</span>}{<span class="w">name</span>} = <span class="q">'Sample Request'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Sample_Request</span>}{<span class="w">url</span>}  = <span class="q">'cgi_application=alDente::Sample_Request_App&amp;LIMIT='</span> . <span class="q">&quot;$department&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">BioInformatics_Stat</span>}{<span class="w">icon</span>} = <span class="q">&quot;Statistics2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioInformatics_Stat</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Projects::Statistics_App&amp;Generate+Results=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioInformatics_Stat</span>}{<span class="w">name</span>} = <span class="q">'Stats'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioInformatics_Stat</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Project level Summaries; (see Summary icon for Laboratory level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">BioInformatics_Summary</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioInformatics_Summary</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Sequencing::Stat_App&amp;rm=Sequencing+Status&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioInformatics_Summary</span>}{<span class="w">name</span>} = <span class="q">'Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioInformatics_Summary</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;</span><span class="sc">;</span>

        <span class="c">##</span>
        <span class="i">$images</span>{<span class="w">Gene_Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Gene_Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;$department&quot;</span> . <span class="q">&quot;::Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Gene_Summary_App</span>}{<span class="w">name</span>} = <span class="q">'Genechip Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Gene_Summary_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Bio_Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Bio_Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;$department&quot;</span> . <span class="q">&quot;::Bioanalyzer_Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Bio_Summary_App</span>}{<span class="w">name</span>} = <span class="q">'Bioanalyzer Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Bio_Summary_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Solexa_Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solexa_Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Illumina::Solexa_Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solexa_Summary_App</span>}{<span class="w">name</span>} = <span class="q">'Solexa Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solexa_Summary_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Solid_Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solid_Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;SOLID::SOLID_Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solid_Summary_App</span>}{<span class="w">name</span>} = <span class="q">'Solid Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Solid_Summary_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Ion_Torrent_Summary</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Ion_Torrent_Summary</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_applicationlication=&quot;</span> . <span class="q">&quot;Ion_Torrent::Run_Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Ion_Torrent_Summary</span>}{<span class="w">name</span>} = <span class="q">'Ion Torrent Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Ion_Torrent_Summary</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Lib_Construction_Summary</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Lib_Construction_Summary</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Lib_Construction::Department_App&amp;rm=Summary&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Lib_Construction_Summary</span>}{<span class="w">name</span>} = <span class="q">'Lib Construction Summary'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">RNA_DNA_Collections</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">RNA_DNA_Collections</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Lib_Construction::Department_App&amp;rm=Summary&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">RNA_DNA_Collections</span>}{<span class="w">name</span>} = <span class="q">'Lib Construction Summary'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">BioSpec_Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioSpec_Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;BioSpecimens::Bio_Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">BioSpec_Summary_App</span>}{<span class="w">name</span>} = <span class="q">'BioSpecimen Core Summary'</span><span class="sc">;</span>

        <span class="c">#   $images{BioSpec_Summary_App}{tip} = &quot;Laboratory level Summaries; (see Stats icon for Project level summaries)&quot;;</span>

        <span class="i">$images</span>{<span class="w">CLIPR_Run_Summary_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">CLIPR_Run_Summary_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;CLIPR&quot;</span> . <span class="q">&quot;::Run_Summary_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">CLIPR_Run_Summary_App</span>}{<span class="w">name</span>} = <span class="q">'CLIPR Summary'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">CLIPR_Run_Summary_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Laboratory level Summaries&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Submission_Volume_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;db_update.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Submission_Volume_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;SRA::Data_Submission_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Submission_Volume_App</span>}{<span class="w">name</span>} = <span class="q">'Data Submission'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Submission_Volume_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Request data submission and view data submission progress information&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Study_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;biology.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Study_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;alDente::Study_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Study_App</span>}{<span class="w">name</span>} = <span class="q">'Study'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Study_App</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Create study and view study information&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Seq_Stat</span>}{<span class="w">icon</span>} = <span class="q">&quot;Statistics2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Seq_Stat</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=Sequencing::Stat_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Seq_Stat</span>}{<span class="w">name</span>} = <span class="q">'Stats'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Seq_Stat</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Project level Summaries; (see Summary icon for Laboratory level summaries)&quot;</span><span class="sc">;</span>
        <span class="c">##</span>
        <span class="i">$images</span>{<span class="w">Funding</span>}{<span class="w">icon</span>} = <span class="q">&quot;money_2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Funding</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Funding_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Funding</span>}{<span class="w">name</span>} = <span class="q">'Funding'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Funding</span>}{<span class="w">tip</span>}  = <span class="q">&quot;View Funding Sources/SOWs and retrieve relevant progress information&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Organization</span>}{<span class="w">icon</span>} = <span class="q">&quot;Organization.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Organization</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Organization_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Organization</span>}{<span class="w">name</span>} = <span class="q">'Organization'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Plates</span>}{<span class="w">icon</span>} = <span class="q">&quot;Plate.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Plates</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Standard+Page=Plate&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Plates</span>}{<span class="w">tip</span>}  = <span class="q">&quot;* Click on Plate Icon for advanced plate/tube searches or to define a new Plate Format Type&lt;BR&gt;*For single plate information, just scan any plate and click on the 'Scan' button at the top of the page&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Tubes</span>}{<span class="w">icon</span>} = <span class="q">&quot;tube.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Tubes</span>}{<span class="w">url</span>}  = <span class="i">$images</span>{<span class="w">Plates</span>}{<span class="w">url</span>}<span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Tubes</span>}{<span class="w">name</span>} = <span class="q">'Plates/Tubes'</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Tubes</span>}{<span class="w">tip</span>}  = <span class="i">$images</span>{<span class="w">Plates</span>}{<span class="w">tip</span>}<span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Sources</span>}{<span class="w">icon</span>} = <span class="q">&quot;dna.gif&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Sources</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Standard+Page=Source&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Sources</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Define new Samples or Starting Material; Search for current Sample sources&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Status</span>}{<span class="w">icon</span>} = <span class="q">&quot;data.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Status</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Sequencing+Status=1&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Status</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Project level Summaries; (see Summary icon for Laboratory level summaries)&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Libraries</span>}{<span class="w">icon</span>}             = <span class="q">&quot;lib.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Libraries</span>}{<span class="w">url</span>}              = <span class="q">&quot;Database_Mode=$dbase_mode&amp;Standard+Page=Library&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="q">&quot;RNA_DNA_Collections&quot;</span>}{<span class="w">icon</span>} = <span class="i">$images</span>{<span class="w">Libraries</span>}{<span class="w">icon</span>}<span class="sc">;</span>
        <span class="i">$images</span>{<span class="q">&quot;RNA_DNA_Collections&quot;</span>}{<span class="w">url</span>}  = <span class="i">$images</span>{<span class="w">Libraries</span>}{<span class="w">url</span>}<span class="sc">;</span>
        <span class="i">$images</span>{<span class="q">&quot;RNA_DNA_Collections&quot;</span>}{<span class="w">name</span>} = <span class="q">'RNA/DNA Collections'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Contacts</span>}{<span class="w">icon</span>} = <span class="q">&quot;contacts.gif&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Contacts</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Contact_App&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Contacts</span>}{<span class="w">tip</span>}  = <span class="q">&quot;Search or Add Contacts, Collaborators, Organizations, and/or Funding Sources&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Projects</span>}{<span class="w">icon</span>} = <span class="q">&quot;project_icon.gif&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Projects</span>}{<span class="w">url</span>}  = <span class="q">&quot;Database_Mode=$dbase_mode&amp;cgi_application=alDente::Project_App&amp;Department=$department&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Projects</span>}{<span class="w">tip</span>}  = <span class="q">&quot;List of current Projects&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Projects</span>}{<span class="w">name</span>} = <span class="q">'Projects'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Admin</span>}{<span class="w">icon</span>} = <span class="q">&quot;admin2.png&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Admin</span>}{<span class="w">url</span>}  = <span class="q">&quot; =&gt; 1=$dbase_mode&amp;Admin+Page=$dept&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Submission</span>}{<span class="w">name</span>} = <span class="q">&quot;Submissions&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Submission</span>}{<span class="w">icon</span>} = <span class="q">&quot;submission.jpg&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Submission</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=alDente::Submission_App&quot;</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">Bioanalyzer_Run_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Bioanalyzer_Run_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;Bioanalyzer::Run_App&amp;rm=Run Summary&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">Bioanalyzer_Run_App</span>}{<span class="w">name</span>} = <span class="q">'Bioanalyzer Runs Summary'</span><span class="sc">;</span>

        <span class="i">$images</span>{<span class="w">QPCR_Run_App</span>}{<span class="w">icon</span>} = <span class="q">&quot;summary.ico&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">QPCR_Run_App</span>}{<span class="w">url</span>}  = <span class="q">&quot;cgi_application=&quot;</span> . <span class="q">&quot;QPCR::Run_App&amp;rm=View Runs&quot;</span><span class="sc">;</span>
        <span class="i">$images</span>{<span class="w">QPCR_Run_App</span>}{<span class="w">name</span>} = <span class="q">'QPCR Run Summary'</span><span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%images</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$user_id</span> = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'user_id'</span><span class="s">)</span> || <span class="n">17</span><span class="sc">;</span>
            <span class="k">my</span> <span class="s">(</span> <span class="i">$date</span><span class="cm">,</span> <span class="i">$time</span> <span class="s">)</span> = <span class="k">split</span> <span class="q">' '</span><span class="cm">,</span> <span class="w">date_time</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> !<span class="k">defined</span> <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">url</span>} <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>
            <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">url</span>} =~ <span class="q">s /\&lt;USERID\&gt;/$user_id/g</span><span class="sc">;</span>
            <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">url</span>} =~ <span class="q">s /\&lt;TODAY\&gt;/$date/g</span><span class="sc">;</span>
            <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">url</span>} =~ <span class="q">s /\&lt;NOW\&gt;/$date $time/g</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$key</span> <span class="s">)</span> <span class="s">{</span> <span class="i">Message</span><span class="s">(</span><span class="q">&quot;NO KEY FOR image&quot;</span><span class="s">)</span><span class="sc">;</span> <span class="k">return</span> <span class="k">keys</span> <span class="i">%images</span><span class="sc">;</span> <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$key</span> &amp;&amp; <span class="i">$images</span>{<span class="i">$key</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$title</span>     = <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">name</span>} || <span class="i">$key</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$icon_name</span> = <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">icon</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$url</span>       = <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">url</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$link</span>      = <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">link</span>}<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$tip</span>       = <span class="i">$images</span>{<span class="i">$key</span>}{<span class="w">tip</span>}<span class="sc">;</span>

        <span class="k">if</span> <span class="s">(</span><span class="i">$url</span><span class="s">)</span> <span class="s">{</span> <span class="i">$link</span> ||= <span class="q">&quot;$homelink&amp;$url&quot;</span> <span class="s">}</span>
        <span class="k">my</span> <span class="i">$show_icons</span> = <span class="n">1</span><span class="sc">;</span>

        <span class="c">#        my $start_icon_link = Link_To($link,$image,'&amp;test=1');  ## qq(&lt;a href='$link' style=&quot;text-decoration:none;&quot;&gt;);</span>
        <span class="c">#        my $end_icon_link   = '&lt;/a&gt;';</span>
        <span class="k">my</span> <span class="i">$image</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$show_icons</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$image</span> .= <span class="q">qq(&lt;IMG border=0 src='/$URL_dir_name/images/icons/$icon_name' alt='$key' title='$key' $size_spec&gt;)</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$link</span> &amp;&amp; <span class="i">$hash</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$img</span> = <span class="q">&quot;&lt;IMG border=0 SRC='/$URL_dir_name/images/icons/$icon_name' alt='$key' title='$key' $size_spec&gt;&quot;</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">$label</span> =~ <span class="q">/long/</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$img</span> .= <span class="q">&quot; - $title&quot;</span> <span class="s">}</span>
            <span class="k">elsif</span> <span class="s">(</span> <span class="i">$label</span> =~ <span class="q">/short/</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$title</span> =~ <span class="q">s/\s/&lt;BR&gt;/</span><span class="sc">;</span>
                <span class="i">$img</span> .= <span class="q">&quot;&lt;BR&gt;$title&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">return</span> <span class="s">{</span> <span class="i">$img</span> <span class="cm">=&gt;</span> <span class="i">$link</span> <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$link</span> &amp;&amp; <span class="i">$image</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$image</span> = <span class="i">Link_To</span><span class="s">(</span> <span class="i">$link</span><span class="cm">,</span> <span class="i">$image</span><span class="cm">,</span> -<span class="w">window</span> <span class="cm">=&gt;</span> <span class="i">$window</span> <span class="s">)</span> <span class="s">}</span>    <span class="c">## $start_icon_link . $image . $end_icon_link }</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$tip</span> &amp;&amp; !<span class="i">$no_tip</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$image</span> = <span class="i">Show_Tool_Tip</span><span class="s">(</span> <span class="i">$image</span><span class="cm">,</span> <span class="i">$tip</span> <span class="s">)</span> <span class="s">}</span>

        <span class="k">my</span> <span class="s">(</span> <span class="i">$icon</span><span class="cm">,</span> <span class="i">$label</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> !<span class="i">$no_label</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">$title</span><span class="s">)</span> <span class="s">{</span>
                <span class="i">$label</span> = <span class="i">$title</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="i">$label</span> = <span class="i">$key</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="i">$icon</span> = <span class="i">Views::Table_Print</span><span class="s">(</span> <span class="w">content</span> <span class="cm">=&gt;</span> <span class="s">[</span> <span class="s">[</span><span class="i">$image</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&quot;&lt;font size=-2&gt;$label&lt;/font&gt;&quot;</span><span class="s">]</span> <span class="s">]</span><span class="cm">,</span> <span class="w">print</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> <span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$height</span><span class="cm">,</span> <span class="w">nowrap</span> <span class="cm">=&gt;</span> <span class="n">0</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="i">$icon</span> = <span class="i">$image</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">return</span> <span class="i">$icon</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$hash</span><span class="s">)</span> <span class="s">{</span> <span class="k">return</span> <span class="s">{</span> <span class="q">''</span> <span class="cm">=&gt;</span> <span class="q">''</span> <span class="s">}</span> <span class="s">}</span>
        <span class="k">return</span> <span class="i">$key</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Retrieves image from Image directory</span>
<span class="c">#</span>
<span class="c">#############</span>
<a name="image-"></a><span class="k">sub </span><span class="m">image</span> <span class="s">{</span>
<span class="c">#############</span>
    <span class="k">my</span> <span class="i">%args</span>   = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'name'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$name</span>   = <span class="i">$args</span>{-<span class="w">name</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$args</span>{-<span class="w">height</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$args</span>{-<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$border</span> = <span class="i">$args</span>{-<span class="w">border</span>} || <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$alt</span>    = <span class="i">$args</span>{-<span class="w">alt</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$title</span>  = <span class="i">$args</span>{-<span class="w">title</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$id</span>     = <span class="i">$args</span>{-<span class="w">id</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$size_spec</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$height</span><span class="s">)</span> <span class="s">{</span> <span class="i">$size_spec</span> .= <span class="q">&quot; height=$height&quot;</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$width</span><span class="s">)</span>  <span class="s">{</span> <span class="i">$size_spec</span> .= <span class="q">&quot; width=$width&quot;</span> <span class="s">}</span>

    <span class="k">my</span> <span class="i">$image</span> = <span class="q">qq(&lt;img id='$id' border=$border src='/$URL_dir_name/images/png/$name' alt='$alt' title='$title' $size_spec&gt;)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$image</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">########################################</span>
<span class="c">#</span>
<span class="c"># Return the module and path of a department, passed in as an arg</span>
<span class="c">#</span>
<span class="c">####################</span>
<a name="get_dept_module-"></a><span class="k">sub </span><span class="m">get_dept_module</span> <span class="s">{</span>
<span class="c">####################</span>
    <span class="k">my</span> <span class="i">$dept</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$dept</span> =~ <span class="q">s/ /_/g</span><span class="sc">;</span>    <span class="c">#repalce the space between dept words</span>

    <span class="c"># the path to the actual module file</span>
    <span class="k">my</span> <span class="i">$path</span> = <span class="q">'alDente'</span><span class="sc">;</span>

    <span class="k">use</span> <span class="w">FindBin</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> !<span class="k">-e</span> <span class="i">$FindBin::RealBin</span> . <span class="q">&quot;/../lib/perl/Departments/&quot;</span> . <span class="i">$dept</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$dept</span> = <span class="q">'alDente'</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$dept</span> =~ <span class="q">/alDente/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="s">(</span> <span class="q">&quot;Core/$dept/Department.pm&quot;</span><span class="cm">,</span> <span class="i">$dept</span> . <span class="q">'::Department'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="s">(</span> <span class="q">&quot;Departments/$dept/Department.pm&quot;</span><span class="cm">,</span> <span class="i">$dept</span> . <span class="q">'::Department'</span> <span class="s">)</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">###############</span>
<a name="thumbnail-"></a><span class="k">sub </span><span class="m">thumbnail</span> <span class="s">{</span>
<span class="c">###############</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'image'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$image</span>   = <span class="i">$args</span>{ -<span class="i">image</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dir</span>     = <span class="i">$args</span>{-<span class="w">dir</span>} || <span class="q">'icons'</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>    = <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$tooltip</span> = <span class="i">$args</span>{-<span class="w">tip</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$output</span> = <span class="q">&quot;\n&lt;img src='/$Configs{URL_dir_name}/images/$dir/$image'&gt;&quot;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$link</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$output</span> = <span class="i">Link_To</span><span class="s">(</span> <span class="i">$link</span><span class="cm">,</span> <span class="i">$output</span><span class="cm">,</span> -<span class="w">tooltip</span> <span class="cm">=&gt;</span> <span class="i">$tooltip</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$output</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">########################################</span>
<span class="c">#</span>
<span class="c"># Generate barcode icons for the top of the page.</span>
<span class="c">#   specify the icons you want to be displayed as array ref $args{-icons}</span>
<span class="c">#</span>
<span class="c">########################</span>
<a name="page_icons-"></a><span class="k">sub </span><span class="m">page_icons</span> <span class="s">{</span>
<span class="c">########################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,dept,getall'</span><span class="cm">,</span> -<span class="w">mandatory</span> <span class="cm">=&gt;</span> <span class="q">'dept'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>    = <span class="i">$args</span>{-<span class="w">dbc</span>} || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dept</span>   = <span class="i">$args</span>{-<span class="w">dept</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$args</span>{-<span class="w">height</span>} || <span class="n">30</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="n">30</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$background</span> = <span class="q">'white'</span><span class="sc">;</span>    <span class="c">## background color of the table</span>
    <span class="k">my</span> <span class="i">$icon_text</span>  = <span class="n">1</span><span class="sc">;</span>          <span class="c">## turn off text below icons...</span>

    <span class="k">my</span> <span class="i">$admin</span> = <span class="s">(</span> <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'groups'</span><span class="s">)</span> &amp;&amp; <span class="k">grep</span> <span class="q">/Admin$/</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'groups'</span><span class="s">)</span> } <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$homelink</span> = <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="sc">;</span>
    <span class="c">############ TESTING ###########</span>
    <span class="c">#Message(&quot;hello everybody we are at: $dept&quot;);</span>
    <span class="c">##################################</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$icon_list</span><span class="cm">,</span> <span class="i">$icon_class</span> <span class="s">)</span> = <span class="i">load_standard_icons</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>

    <span class="c">#  print $iconTable-&gt;Printout(0);</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$scanner_mode</span> &amp;&amp; <span class="i">$admin</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$icon_class</span> =~ <span class="q">/^drop/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## Hash format for dropdown menus ##</span>
            <span class="k">if</span> <span class="s">(</span> <span class="k">grep</span> <span class="q">/LIMS Admin/</span><span class="cm">,</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'Access'</span><span class="s">)</span> } <span class="s">)</span> <span class="s">{</span>
                <span class="c">## admin options at top of page... ##</span>
                <span class="k">push</span> <span class="i">@$icon_list</span><span class="cm">,</span>
                    <span class="s">{</span>
                    <span class="q">'LIMS Team'</span> <span class="cm">=&gt;</span> <span class="s">[</span>
                        <span class="s">{</span> <span class="q">'Query Tool'</span> <span class="cm">=&gt;</span> <span class="q">&quot;&amp;cgi_application=SDB::DB_Query_App&quot;</span> <span class="s">}</span><span class="cm">,</span>
                        <span class="s">{</span> <span class="q">'Table_Info'</span> <span class="cm">=&gt;</span> <span class="q">&quot;$Configs{URL_domain}/$Configs{URL_dir_name}/cgi-bin/DB_admin.pl?Database_Mode=DEV&amp;Type=General&quot;</span> <span class="s">}</span><span class="cm">,</span>
                        <span class="s">{</span> <span class="q">'Coding'</span>     <span class="cm">=&gt;</span> <span class="q">&quot;$Configs{URL_domain}/$Configs{URL_dir_name}/cgi-bin/SDB_code.pl?Database_Mode=DEV&amp;Type=General&quot;</span> <span class="s">}</span><span class="cm">,</span>
                    <span class="s">]</span>
                    <span class="s">}</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">push</span> <span class="i">@$icon_list</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Refresh Settings'</span> <span class="cm">=&gt;</span> <span class="q">&quot;$homelink&amp;Refresh+Parameters=1&amp;Database_Mode=$dbc-&gt;{dbase_mode}&amp;Home=Default&quot;</span> <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span>
            <span class="k">push</span> <span class="i">@$icon_list</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Add Message'</span> <span class="cm">=&gt;</span> <span class="q">&quot;$homelink&amp;New+Entry=New+Message&amp;FK_Employee__ID=$user_id&quot;</span> <span class="s">}</span><span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="k">grep</span> <span class="q">/LIMS Admin/</span><span class="cm">,</span> <span class="k">keys</span> <span class="i">%</span>{ <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'Access'</span><span class="s">)</span> } <span class="s">)</span> <span class="s">{</span>
                <span class="c">## admin options at top of page... ##</span>
                <span class="k">push</span> <span class="i">@$icon_list</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Query Tool'</span> <span class="cm">=&gt;</span> <span class="q">&quot;&amp;cgi_application=SDB::DB_Query_App&quot;</span> <span class="s">}</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Table_Info'</span> <span class="cm">=&gt;</span> <span class="q">&quot;$Configs{URL_domain}/$Configs{URL_dir_name}/cgi-bin/DB_admin.pl?Database_Mode=DEV&amp;Type=General&quot;</span> <span class="s">}</span><span class="cm">,</span>
                    <span class="s">{</span> <span class="q">'Coding'</span> <span class="cm">=&gt;</span> <span class="q">&quot;$Configs{URL_domain}/$Configs{URL_dir_name}/cgi-bin/SDB_code.pl?Database_Mode=DEV&amp;Type=General&quot;</span> <span class="s">}</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">unshift</span> <span class="i">@$icon_list</span><span class="cm">,</span> <span class="s">{</span> <span class="q">&quot;Site Map&quot;</span> <span class="cm">=&gt;</span> <span class="q">&quot;$URL_address/Site_Map.pl?Link=$dbc-&gt;{homelink}&quot;</span> <span class="s">}</span><span class="sc">;</span>

    <span class="c">#    my $home = icons(-name=&gt;'Home', -dbc=&gt;$dbc, -hash=&gt;1);</span>
    <span class="c">#    unshift @$icon_list, $home; ##{ 'Home' =&gt; &quot;$URL_address/Site_Map.pl?Link=$dbc-&gt;{homelink}&quot; };</span>

    <span class="k">return</span> <span class="s">(</span> <span class="i">$icon_list</span><span class="cm">,</span> <span class="i">$icon_class</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Wrapper to build menu specification hash</span>
<span class="c"># (Controls order and organization of primary navigation menu)</span>
<span class="c">#</span>
<span class="c">###########################</span>
<a name="load_standard_icons-"></a><span class="k">sub </span><span class="m">load_standard_icons</span> <span class="s">{</span>
<span class="c">###########################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,dept,getall'</span><span class="cm">,</span> -<span class="w">mandatory</span> <span class="cm">=&gt;</span> <span class="q">'dept'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>    = <span class="i">$args</span>{-<span class="w">dbc</span>} || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dept</span>   = <span class="i">$args</span>{-<span class="w">dept</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$height</span> = <span class="i">$args</span>{-<span class="w">height</span>} || <span class="n">30</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="n">30</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@defaults</span> = <span class="q">qw()</span><span class="sc">;</span>
    <span class="k">push</span><span class="s">(</span> <span class="i">@defaults</span><span class="cm">,</span> <span class="q">'Issues'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">@icons</span><span class="cm">,</span> <span class="i">$icon_class</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">## Check to see if icons variable is specified</span>
    <span class="k">my</span> <span class="i">$custom_icons</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$dept</span> <span class="k">eq</span> <span class="q">'LIMS Admin'</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">## don't bother setting icons ... all should be included ...</span>
        <span class="i">$icon_class</span> = <span class="q">'dropnav'</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="i">$args</span>{-<span class="w">getall</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">@icons</span> = <span class="i">icons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">@icons</span> = <span class="i">@defaults</span><span class="sc">;</span>

        <span class="c"># Dynamicly get the department module path and name</span>

        <span class="k">my</span> <span class="s">(</span> <span class="i">$path</span><span class="cm">,</span> <span class="i">$module</span> <span class="s">)</span> = <span class="i">get_dept_module</span><span class="s">(</span><span class="i">$dept</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">require</span> <span class="i">$path</span><span class="sc">;</span>

        <span class="i">$module</span> = <span class="i">$module</span><span class="sc">;</span>

        <span class="k">my</span> <span class="i">$icons_ref</span> = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>

        <span class="i">$icons_ref</span> = <span class="i">$module</span><span class="i">-&gt;get_icons</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$icon_class</span> = <span class="i">$module</span><span class="i">-&gt;get_icon_class</span><span class="s">(</span><span class="s">)</span> || <span class="q">'dropnav'</span><span class="sc">;</span>

        <span class="k">eval</span><span class="s">(</span><span class="q">&quot;\$custom_icons = \$module-&gt;get_custom_icons();&quot;</span><span class="s">)</span><span class="sc">;</span>

        <span class="k">if</span> <span class="s">(</span><span class="i">$icons_ref</span><span class="s">)</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@icons</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$icons_ref</span>} <span class="s">}</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$custom_icons</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$custom_icons</span>} <span class="s">)</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> !<span class="k">grep</span> <span class="q">/^$key$/</span><span class="cm">,</span> <span class="i">@icons</span> <span class="s">)</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@icons</span><span class="cm">,</span> <span class="i">$key</span> <span class="s">}</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">%Icons</span><span class="cm">,</span> <span class="i">@icon_list</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">## This controls the various sections under which ALL icons should appear - some of this may be loaded dynamically via config files instead ##</span>
    <span class="i">$Icons</span>{<span class="w">Home</span>}      = <span class="s">[</span><span class="q">qw(Home Current_Dept)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Admin</span>}     = <span class="s">[</span><span class="q">qw(RNA_DNA_Collections Projects Submission Pipeline Protocols Employee Sources Contacts Subscription JIRA Issues Sample_Request)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Lab</span>}       = <span class="s">[</span><span class="q">qw(Rack Rearrays Plates Tubes Equipment_App Solutions_App Libraries  Pool_ReArray Pool_ReArray_to_Tube Barcodes)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Shipments</span>} = <span class="s">[</span><span class="q">qw(Shipments Receive_Shipment Export In_Transit)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Database</span>}  = <span class="s">[</span><span class="q">qw(Database_BC Database Queries DBField Import Custom_Import Template XRef System_Monitor Session Modules)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Views</span>}     = <span class="s">[</span><span class="q">qw(Views)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Summaries</span>} = <span class="s">[</span><span class="q">qw(Last_24h Daily_Planner Seq_Stat Solexa_Summary_App Stat_App Ion_Torrent_Summary Summary_App Bioinformatics_Stat Solexa_Summary_App_NO_filter Solid_Summary_App_NO_filter Solid_Summary_App Bioanalyzer_Run_App QPCR_Run_App)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Tracking</span>}  = <span class="s">[</span><span class="q">qw(Funding Study_App Submission_Volume_App)</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Runs</span>}      = <span class="s">[</span><span class="q">qw()</span><span class="s">]</span><span class="sc">;</span>
    <span class="i">$Icons</span>{<span class="w">Help</span>}      = <span class="s">[</span><span class="q">qw( LIMS_Help )</span><span class="s">]</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$dept</span><span class="s">)</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@</span>{ <span class="i">$Icons</span>{<span class="w">Summaries</span>} }<span class="cm">,</span> <span class="q">&quot;${dept}_Stat&quot;</span><span class="cm">,</span> <span class="q">&quot;${dept}_Summary&quot;</span> <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$dept</span><span class="s">)</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@</span>{ <span class="i">$Icons</span>{<span class="w">Help</span>} }<span class="cm">,</span> <span class="q">&quot;${dept}_Help&quot;</span> <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$label</span><span class="cm">,</span> <span class="i">@headers</span> <span class="s">)</span> = <span class="s">(</span><span class="q">'short'</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$icon_class</span> =~ <span class="q">/^drop/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">@headers</span> = <span class="s">(</span> <span class="q">'Home'</span><span class="cm">,</span> <span class="q">'Lab'</span><span class="cm">,</span> <span class="q">'Tracking'</span><span class="cm">,</span> <span class="q">'Admin'</span><span class="cm">,</span> <span class="q">'Database'</span><span class="cm">,</span> <span class="q">'Shipments'</span><span class="cm">,</span> <span class="q">'Runs'</span><span class="cm">,</span> <span class="q">'Views'</span><span class="cm">,</span> <span class="q">'Summaries'</span><span class="cm">,</span> <span class="q">'Help'</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$label</span> = <span class="q">'long'</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">%Links</span><span class="cm">,</span> <span class="i">@dropdown_icons</span> <span class="s">)</span><span class="sc">;</span>
    <span class="c">## build dropdown menu ## skip this block if just showing icons at top of page... ##</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span><span class="i">@headers</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@available_icons</span> = <span class="i">@</span>{ <span class="i">$Icons</span>{<span class="i">$key</span>} }<span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$icon</span> <span class="s">(</span><span class="i">@available_icons</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">if</span> <span class="s">(</span> <span class="i">@icons</span> &amp;&amp; !<span class="k">grep</span> <span class="q">/^$icon$/</span><span class="cm">,</span> <span class="i">@icons</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>    <span class="c">## only include it if it is in the specified list of icons</span>

            <span class="k">my</span> <span class="i">$hash</span> = <span class="i">icons</span><span class="s">(</span> <span class="i">$icon</span><span class="cm">,</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$width</span><span class="cm">,</span> -<span class="w">custom_icons</span> <span class="cm">=&gt;</span> <span class="i">$custom_icons</span><span class="cm">,</span> -<span class="w">hash</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">label</span> <span class="cm">=&gt;</span> <span class="i">$label</span> <span class="s">)</span><span class="sc">;</span>

            <span class="k">push</span> <span class="i">@</span>{ <span class="i">$Links</span>{<span class="i">$key</span>} }<span class="cm">,</span> <span class="i">$hash</span><span class="sc">;</span>
            <span class="k">push</span> <span class="i">@dropdown_icons</span><span class="cm">,</span> <span class="i">$icon</span><span class="sc">;</span>
        <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span> <span class="i">$key</span> <span class="k">eq</span> <span class="q">'Views'</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">## Add Personal Views to Menu if available ##</span>
            <span class="k">my</span> <span class="i">@views</span> = <span class="i">load_user_views</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">dept</span> <span class="cm">=&gt;</span> <span class="i">$dept</span> <span class="s">)</span><span class="sc">;</span>
            <span class="k">if</span> <span class="s">(</span><span class="i">@views</span><span class="s">)</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@</span>{ <span class="i">$Links</span>{<span class="i">$key</span>} }<span class="cm">,</span> <span class="i">@views</span> <span class="s">}</span>     <span class="c">## format eg: @views = ({'A' =&gt; 'B'}, {'C' =&gt; 'D'});</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span><span class="i">@headers</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$Links</span>{<span class="i">$key</span>} &amp;&amp; <span class="k">int</span><span class="s">(</span> <span class="i">@</span>{ <span class="i">$Links</span>{<span class="i">$key</span>} } <span class="s">)</span> &gt;= <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$added</span> = <span class="s">{</span> <span class="i">$key</span> <span class="cm">=&gt;</span> <span class="i">$Links</span>{<span class="i">$key</span>} <span class="s">}</span><span class="sc">;</span>
            <span class="k">push</span> <span class="i">@icon_list</span><span class="cm">,</span> <span class="i">$added</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">else</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@icon_list</span><span class="cm">,</span> <span class="i">$Links</span>{<span class="i">$key</span>}-&gt;[<span class="n">0</span>] <span class="s">}</span>
    <span class="s">}</span>

    <span class="c"># Go through all icons to be included in case any of them were missed above....</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$type</span> <span class="s">(</span><span class="i">@icons</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">grep</span> <span class="q">/^$type$/</span><span class="cm">,</span> <span class="i">@dropdown_icons</span> <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>

        <span class="c">#Special check for admin icon</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$type</span> =~ <span class="q">/Admin/</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$Access</span> = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'Access'</span><span class="s">)</span><span class="sc">;</span>
            <span class="k">unless</span> <span class="s">(</span> <span class="s">(</span> <span class="k">grep</span><span class="s">(</span> <span class="q">/Admin/</span><span class="cm">,</span> <span class="i">@</span>{ <span class="i">$Access</span>-&gt;{<span class="i">$dept</span>} } <span class="s">)</span> <span class="s">)</span> || <span class="i">$Access</span>-&gt;{<span class="q">'LIMS Admin'</span>} <span class="s">)</span> <span class="s">{</span><span class="k">next</span><span class="s">}</span>
        <span class="s">}</span>

        <span class="k">my</span> <span class="i">$image</span> = <span class="i">icons</span><span class="s">(</span> <span class="i">$type</span><span class="cm">,</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$width</span><span class="cm">,</span> -<span class="w">custom_icons</span> <span class="cm">=&gt;</span> <span class="i">$custom_icons</span><span class="cm">,</span> -<span class="w">hash</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">label</span> <span class="cm">=&gt;</span> <span class="i">$label</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">push</span> <span class="i">@icon_list</span><span class="cm">,</span> <span class="i">$image</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="s">(</span> \<span class="i">@icon_list</span><span class="cm">,</span> <span class="i">$icon_class</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">###############################</span>
<a name="alDente_header_bar_title-"></a><span class="k">sub </span><span class="m">alDente_header_bar_title</span> <span class="s">{</span>
<span class="c">###############################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'font_colour'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$font_colour</span> = <span class="i">$args</span>{-<span class="w">font_colour</span>} || <span class="i">$headerfontc</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$title</span><span class="sc">;</span>
    <span class="i">$title</span> .= <span class="q">&quot;&lt;font color='$font_colour'&gt;&quot;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$scanner_mode</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$title</span> .= <span class="q">&quot;\nDB: &lt;B&gt;$dbase&lt;/B&gt; &amp;nbsp;&quot;</span><span class="sc">;</span>
        <span class="i">$title</span> .= <span class="q">&quot;\nUser: &lt;B&gt;$user&lt;/B&gt; &amp;nbsp;&quot;</span><span class="sc">;</span>
        <span class="i">$title</span> .= <span class="q">&quot;\nVer: $version_number&quot;</span><span class="sc">;</span>
        <span class="i">$title</span> .= <span class="q">&quot;\nDep: $Current_Department&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="k">return</span> <span class="q">''</span><span class="sc">;</span>    <span class="c">## header bar already exists on desktop...</span>

        <span class="c">#	$title .= &quot;\nDB: &lt;B&gt;$dbase\@$Defaults{mySQL_HOST}&lt;/B&gt;&quot; . &amp;hspace(5);</span>
        <span class="c">#	$title .= &quot;\nUser: &lt;B&gt;$user&lt;/B&gt;&quot; . &amp;hspace(5);</span>
        <span class="c">#	$title .= &quot;\nVer: $version_number&quot; . &amp;hspace(5);</span>
    <span class="s">}</span>

    <span class="c">#    if($URL_version =~ /Dev/i) {</span>
    <span class="c">#	$title  .= &quot;&lt;font color='red'&gt; PID: $$ &amp;nbsp;&lt;a href='/kill.pl?ID=$$'&gt;(KILL)&lt;/a&gt; &lt;/font&gt;&quot;;</span>
    <span class="c">#    }</span>
    <span class="i">$title</span> .= <span class="q">&quot;&lt;/font&gt;\n&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$title</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##########################</span>
<a name="alDente_header_bar-"></a><span class="k">sub </span><span class="m">alDente_header_bar</span> <span class="s">{</span>
<span class="c">##########################</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="c">## header options appear as footer options in scanner mode ##</span>
    <span class="k">my</span> <span class="i">$start</span> = <span class="i">alDente::Form::start_alDente_form</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'header'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$end</span> = <span class="q">&quot;\n&quot;</span> . <span class="w">end_form</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$ps_button</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$Configs</span>{<span class="w">protocol_tracking</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$ps_button</span> .= <span class="i">Show_Tool_Tip</span><span class="s">(</span> <span class="i">textfield</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Plate Set Number'</span><span class="cm">,</span> -<span class="w">size</span> <span class="cm">=&gt;</span> <span class="n">6</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span><span class="cm">,</span> <span class="i">$Tool_Tips</span>{<span class="w">Load_Set</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="i">$ps_button</span> .= <span class="q">' '</span> . <span class="i">&amp;submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Grab Plate Set'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">&quot;Grab Plate Set&quot;</span><span class="cm">,</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="q">'Std'</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$ps_button</span> .= <span class="i">&amp;hspace</span><span class="s">(</span><span class="n">10</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$ps_button</span> .= <span class="i">hspace</span><span class="s">(</span><span class="n">50</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#    my $err_button = Show_Tool_Tip( textfield( -name =&gt; 'Error Notes', -size =&gt; 30, -force =&gt; 1 ), &quot;$Tool_Tips{Error_Notification_Field}&quot; );</span>
    <span class="c">#    $err_button .= ' ' . submit( -name =&gt; 'Error Notification', -label =&gt; 'Error', -class =&gt; 'Action' );</span>
    <span class="c">#    $err_button .= &amp;hspace(10);</span>

    <span class="k">my</span> <span class="i">$BS</span> = <span class="w">new</span> <span class="i">Bootstrap</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$search_button</span> = <span class="i">$BS</span><span class="i">-&gt;search_element</span><span class="s">(</span> -<span class="w">append</span>  <span class="cm">=&gt;</span> <span class="q">'icon-search'</span><span class="cm">,</span> -<span class="w">placeholder</span> <span class="cm">=&gt;</span> <span class="q">'Search DB'</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'DB Search String'</span><span class="cm">,</span> -<span class="w">run_mode</span> <span class="cm">=&gt;</span> <span class="q">'Search Database'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$scan_button</span>   = <span class="i">$BS</span><span class="i">-&gt;search_element</span><span class="s">(</span> -<span class="w">prepend</span> <span class="cm">=&gt;</span> <span class="q">'icon-search'</span><span class="cm">,</span> -<span class="w">placeholder</span> <span class="cm">=&gt;</span> <span class="q">'Scan'</span><span class="cm">,</span>      -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Barcode'</span><span class="cm">,</span>          -<span class="w">run_mode</span> <span class="cm">=&gt;</span> <span class="q">'Scan'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$err_button</span>    = <span class="i">$BS</span><span class="i">-&gt;search_element</span><span class="s">(</span> -<span class="w">append</span>  <span class="cm">=&gt;</span> <span class="q">'icon-search'</span><span class="cm">,</span> -<span class="w">placeholder</span> <span class="cm">=&gt;</span> <span class="q">'Error'</span><span class="cm">,</span>     -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Error Notes'</span><span class="cm">,</span>      -<span class="w">run_mode</span> <span class="cm">=&gt;</span> <span class="q">'Error Notification'</span><span class="cm">,</span> -<span class="w">button_class</span> <span class="cm">=&gt;</span> <span class="q">'Action'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$bar</span> = <span class="w">new</span> <span class="i">HTML_Table</span><span class="s">(</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="q">'100%'</span><span class="cm">,</span> -<span class="w">colour</span> <span class="cm">=&gt;</span> <span class="i">$headerbg</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$bar</span><span class="i">-&gt;Set_Row</span><span class="s">(</span> <span class="s">[</span> <span class="i">$scan_button</span><span class="cm">,</span> <span class="i">$start</span> . <span class="i">$ps_button</span> . <span class="i">$end</span><span class="cm">,</span> <span class="i">$start</span> . <span class="i">$err_button</span> . <span class="i">$end</span><span class="cm">,</span> <span class="i">$start</span> . <span class="i">$search_button</span> . <span class="i">$end</span> <span class="s">]</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$header</span> = <span class="q">&quot;&lt;div id='headerform'&gt;&quot;</span> . <span class="i">$bar</span><span class="i">-&gt;Printout</span><span class="s">(</span><span class="n">0</span><span class="s">)</span> . <span class="q">'&lt;/div&gt;'</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$header</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#################</span>
<a name="scan_button-"></a><span class="k">sub </span><span class="m">scan_button</span> <span class="s">{</span>
<span class="c">#################</span>
    <span class="k">my</span> <span class="i">%args</span>   = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,prompt,size,rows'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>    = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$prompt</span> = <span class="i">$args</span>{-<span class="w">prompt</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$size</span>   = <span class="i">$args</span>{-<span class="w">size</span>} || <span class="n">20</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$rows</span>   = <span class="i">$args</span>{-<span class="w">rows</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$output</span> = <span class="i">alDente::Form::start_alDente_form</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'scan'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$prompt</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$output</span> .= <span class="i">$prompt</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$rows</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$output</span> .= <span class="i">Show_Tool_Tip</span><span class="s">(</span> <span class="i">textarea</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Barcode'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">''</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">cols</span> <span class="cm">=&gt;</span> <span class="i">$size</span><span class="cm">,</span> -<span class="w">rows</span> <span class="cm">=&gt;</span> <span class="i">$rows</span> <span class="s">)</span><span class="cm">,</span> <span class="i">$Tool_Tips</span>{<span class="w">Scan_Button_Field</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$output</span> .= <span class="i">Show_Tool_Tip</span><span class="s">(</span> <span class="i">textfield</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Barcode'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">''</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">size</span> <span class="cm">=&gt;</span> <span class="i">$size</span> <span class="s">)</span><span class="cm">,</span> <span class="i">$Tool_Tips</span>{<span class="w">Scan_Button_Field</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$output</span> .= <span class="q">' '</span> . <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'cgi_application'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">'alDente::Scanner_App'</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span> . <span class="i">submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'rm'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">'Scan'</span><span class="cm">,</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="q">'Std'</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$output</span> .= <span class="i">end_form</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$output</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">########################################</span>
<span class="c">#</span>
<span class="c"># Generate Standard Header Bar</span>
<span class="c">#</span>
<span class="c"># (Displays Database, User, Release)</span>
<span class="c">#  Header sections are:</span>
<span class="c">#  * header1 (main logo)</span>
<span class="c">#  * headerform (part of header with user input fields)</span>
<span class="c">#  * header2 (department tabs)</span>
<span class="c">#</span>
<span class="c">######################</span>
<a name="app_info_bar-"></a><span class="k">sub </span><span class="m">app_info_bar</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,offset'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="i">$args</span>{-<span class="w">dbc</span>} || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span> = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="i">$Settings</span>{<span class="w">PAGE_WIDTH</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$offset</span>          = <span class="i">$args</span>{-<span class="w">offset</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$section</span>         = <span class="i">$args</span>{-<span class="w">section</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sections</span>        = <span class="i">$args</span>{-<span class="w">sections</span>}<span class="sc">;</span>            <span class="c">## defaults to departments...</span>
    <span class="k">my</span> <span class="i">$font_colour_on</span>  = <span class="i">$args</span>{-<span class="w">font_colour_on</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$font_colour_off</span> = <span class="i">$args</span>{-<span class="w">font_colour_off</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$hover_colour</span>    = <span class="i">$args</span>{-<span class="w">hover_colour</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$left_icon</span>       = <span class="i">$args</span>{-<span class="w">left_icon</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$icon_width</span>      = <span class="i">$args</span>{-<span class="w">icon_width</span>} || <span class="n">150</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$include</span>         = <span class="i">$args</span>{-<span class="w">include</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$title</span> = <span class="i">$args</span>{-<span class="w">title</span>} || <span class="i">&amp;alDente_header_bar_title</span><span class="s">(</span> -<span class="w">font_colour</span> <span class="cm">=&gt;</span> <span class="i">$font_colour_on</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header</span> = <span class="k">defined</span> <span class="i">$args</span>{-<span class="w">header</span>} ? <span class="i">$args</span>{-<span class="w">header</span>} <span class="co">:</span> <span class="i">&amp;alDente_header_bar</span><span class="s">(</span><span class="i">$dbc</span><span class="s">)</span><span class="sc">;</span>

    <span class="c">#my $bar_colour = $args{-colour} || &quot;#777777&quot;; ## &quot;#6699cc&quot;;  ## blue pastell</span>
    <span class="k">my</span> <span class="i">$bar_colour</span>   = <span class="i">$args</span>{-<span class="w">colour</span>}       || <span class="i">$header_bar_colour</span><span class="sc">;</span>    <span class="c">## &quot;#6699cc&quot;;  ## blue pastell</span>
    <span class="k">my</span> <span class="i">$off_colour</span>   = <span class="i">$args</span>{-<span class="w">off_colour</span>}   || <span class="q">&quot;#CCCCCC&quot;</span><span class="sc">;</span>             <span class="c">## &quot;#6699cc&quot;;  ## blue pastell</span>
    <span class="k">my</span> <span class="i">$link</span>         = <span class="i">$args</span>{ -<span class="k">link</span> }       || <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$tab_position</span> = <span class="i">$args</span>{-<span class="w">tab_position</span>} || <span class="q">'top'</span><span class="sc">;</span>

    <span class="c">## may use tabs below) instead of sections...</span>
    <span class="k">my</span> <span class="i">$tabs</span> = <span class="i">$args</span>{-<span class="w">tabs</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$tab_limit</span> = <span class="i">$args</span>{-<span class="w">tab_limit</span>} || <span class="n">10</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$left_icon</span><span class="s">)</span> <span class="s">{</span> <span class="i">$width</span> -= <span class="i">$icon_width</span> <span class="s">}</span>

    <span class="k">my</span> <span class="i">$full_width</span> = <span class="i">$width</span> + <span class="i">$offset</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$colspan</span> = <span class="i">$tab_limit</span> * <span class="n">2</span> + <span class="n">2</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$p</span> .= <span class="q">&quot;\n&lt;!--------- app_info_bar() ---------&gt;\n&quot;</span><span class="sc">;</span>

    <span class="c">## set up tab bar at top of header for departments ##</span>

    <span class="k">my</span> <span class="i">$dept_offset</span> = <span class="n">100</span><span class="sc">;</span>    <span class="c">## offset department tabs to line up with header</span>

    <span class="k">unless</span> <span class="s">(</span> <span class="i">$tab_position</span> =~ <span class="q">/bottom/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$p</span> .= <span class="i">&amp;Tab_Bar</span><span class="s">(</span>
            -<span class="w">dbc</span>             <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span>
            -<span class="w">link</span>            <span class="cm">=&gt;</span> <span class="i">$link</span><span class="cm">,</span>
            -<span class="w">section</span>         <span class="cm">=&gt;</span> <span class="i">$section</span><span class="cm">,</span>
            -<span class="w">sections</span>        <span class="cm">=&gt;</span> <span class="i">$sections</span><span class="cm">,</span>
            -<span class="w">width</span>           <span class="cm">=&gt;</span> <span class="i">$width</span> - <span class="i">$dept_offset</span><span class="cm">,</span>
            -<span class="w">offset</span>          <span class="cm">=&gt;</span> <span class="i">$dept_offset</span><span class="cm">,</span>
            -<span class="w">bar_colour</span>      <span class="cm">=&gt;</span> <span class="i">$bar_colour</span><span class="cm">,</span>
            -<span class="w">font_colour_on</span>  <span class="cm">=&gt;</span> <span class="i">$font_colour_on</span><span class="cm">,</span>
            -<span class="w">font_colour_off</span> <span class="cm">=&gt;</span> <span class="i">$font_colour_off</span><span class="cm">,</span>
            -<span class="w">off_colour</span>      <span class="cm">=&gt;</span> <span class="i">$off_colour</span><span class="cm">,</span>
            -<span class="w">hover_colour</span>    <span class="cm">=&gt;</span> <span class="i">$hover_colour</span><span class="cm">,</span>
            -<span class="w">class</span>           <span class="cm">=&gt;</span> <span class="q">'tabmenu'</span><span class="cm">,</span>
        <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">## add block in middle of header ##</span>
    <span class="i">$p</span> .= <span class="q">&quot;\n&lt;table border='0'  cellpadding='0' cellspacing='0' width='$width'&gt;&quot;</span><span class="sc">;</span>
    <span class="i">$p</span> .= <span class="q">&quot;&lt;tr&gt;\n&quot;</span><span class="sc">;</span>
    <span class="i">$p</span> .= <span class="q">&quot;&lt;td width=100 rowspan=4&gt;$left_icon&lt;/td&gt;&lt;td colspan=20&gt;&quot;</span> . <span class="i">show_topbar</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">include</span> <span class="cm">=&gt;</span> <span class="i">$include</span><span class="cm">,</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$width</span> <span class="s">)</span> . <span class="q">&quot;&lt;/TD&gt;&lt;/tr&gt;&lt;tr&gt;\n&quot;</span> <span class="k">if</span> <span class="i">$left_icon</span><span class="sc">;</span>
    <span class="i">$p</span> .= <span class="q">&quot;&lt;td&gt;&quot;</span> . <span class="i">&amp;hspace</span><span class="s">(</span><span class="i">$offset</span><span class="s">)</span> . <span class="q">&quot;&lt;/td&gt;\n&quot;</span><span class="sc">;</span>
    <span class="i">$p</span> .= <span class="q">&quot;\n&lt;td class='small' bgcolor=$bar_colour colspan=$colspan width='100%'&gt;&quot;</span><span class="sc">;</span>

    <span class="i">$p</span> .= <span class="i">$title</span><span class="sc">;</span>

    <span class="i">$p</span> .= <span class="q">&quot;&lt;/td&gt;\n&lt;/tr&gt;\n&quot;</span><span class="sc">;</span>
    <span class="k">unless</span> <span class="s">(</span><span class="i">$scanner_mode</span><span class="s">)</span> <span class="s">{</span>

        <span class="i">$p</span> .= <span class="q">&quot;&lt;/table&gt;\n&quot;</span><span class="sc">;</span>

        <span class="k">if</span> <span class="s">(</span><span class="i">$header</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$p</span> .= <span class="q">&quot;&lt;tr&gt;\n&quot;</span><span class="sc">;</span>
            <span class="i">$p</span> .= <span class="q">&quot;&lt;td&gt;&quot;</span> . <span class="i">&amp;hspace</span><span class="s">(</span><span class="i">$offset</span><span class="s">)</span> . <span class="q">&quot;&lt;/td&gt;\n&quot;</span><span class="sc">;</span>
            <span class="i">$p</span> .= <span class="q">&quot;&lt;td bgcolor=$bar_colour align=left colspan=$colspan&gt;&quot;</span><span class="sc">;</span>
            <span class="i">$p</span> .= <span class="i">$header</span><span class="sc">;</span>
            <span class="i">$p</span> .= <span class="q">&quot;\n&lt;/td&gt;&lt;/div&gt;&lt;/tr&gt;\n&quot;</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="c">## add another row (to make thicker) ##</span>
        <span class="i">$p</span> .= <span class="q">&quot;&lt;tr&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$p</span> .= <span class="q">&quot;&lt;td&gt;&quot;</span> . <span class="i">&amp;hspace</span><span class="s">(</span><span class="i">$offset</span><span class="s">)</span> . <span class="q">&quot;&lt;/td&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$p</span> .= <span class="q">&quot;&lt;td bgcolor=$bar_colour width='100%' colspan=$colspan&gt; &lt;/td&gt;&quot;</span><span class="sc">;</span>
        <span class="i">$p</span> .= <span class="q">&quot;\n&lt;/tr&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$p</span> .= <span class="q">&quot;&lt;/table&gt;\n&quot;</span><span class="sc">;</span>

    <span class="k">unless</span> <span class="s">(</span> <span class="i">$scanner_mode</span> || <span class="i">$tab_position</span> =~ <span class="q">/top/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$p</span> .= <span class="i">&amp;Tab_Bar</span><span class="s">(</span>
            -<span class="w">dbc</span>             <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span>
            -<span class="w">link</span>            <span class="cm">=&gt;</span> <span class="i">$link</span><span class="cm">,</span>
            -<span class="w">section</span>         <span class="cm">=&gt;</span> <span class="i">$section</span><span class="cm">,</span>
            -<span class="w">sections</span>        <span class="cm">=&gt;</span> <span class="i">$sections</span><span class="cm">,</span>
            -<span class="w">width</span>           <span class="cm">=&gt;</span> <span class="i">$width</span> - <span class="i">$dept_offset</span><span class="cm">,</span>
            -<span class="w">offset</span>          <span class="cm">=&gt;</span> <span class="i">$dept_offset</span><span class="cm">,</span>
            -<span class="w">bar_colour</span>      <span class="cm">=&gt;</span> <span class="i">$bar_colour</span><span class="cm">,</span>
            -<span class="w">font_colour_on</span>  <span class="cm">=&gt;</span> <span class="i">$font_colour_on</span><span class="cm">,</span>
            -<span class="w">font_colour_off</span> <span class="cm">=&gt;</span> <span class="i">$font_colour_off</span><span class="cm">,</span>
            -<span class="w">off_colour</span>      <span class="cm">=&gt;</span> <span class="i">$off_colour</span><span class="cm">,</span>
            -<span class="w">hover_colour</span>    <span class="cm">=&gt;</span> <span class="i">$hover_colour</span><span class="cm">,</span>
            -<span class="w">class</span>           <span class="cm">=&gt;</span> <span class="q">'dropnav'</span><span class="cm">,</span>
        <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">## print bottom tab bar with icons ##</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$tabs</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$p</span> .= <span class="i">&amp;Tab_Bar</span><span class="s">(</span>
            -<span class="w">dbc</span>             <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span>
            -<span class="w">offset</span>          <span class="cm">=&gt;</span> <span class="n">100</span><span class="cm">,</span>
            -<span class="w">link</span>            <span class="cm">=&gt;</span> <span class="i">$link</span><span class="cm">,</span>
            -<span class="w">section</span>         <span class="cm">=&gt;</span> <span class="i">$section</span><span class="cm">,</span>
            -<span class="w">sections</span>        <span class="cm">=&gt;</span> <span class="i">$tabs</span><span class="cm">,</span>
            -<span class="w">limit</span>           <span class="cm">=&gt;</span> <span class="i">$tab_limit</span><span class="cm">,</span>
            -<span class="w">bar_colour</span>      <span class="cm">=&gt;</span> <span class="i">$bar_colour</span><span class="cm">,</span>
            -<span class="w">off_colour</span>      <span class="cm">=&gt;</span> <span class="i">$off_colour</span><span class="cm">,</span>
            -<span class="w">width</span>           <span class="cm">=&gt;</span> <span class="i">$width</span> - <span class="n">100</span><span class="cm">,</span>
            -<span class="w">font_colour_on</span>  <span class="cm">=&gt;</span> <span class="i">$font_colour_on</span><span class="cm">,</span>
            -<span class="w">font_colour_off</span> <span class="cm">=&gt;</span> <span class="i">$font_colour_off</span><span class="cm">,</span>
            -<span class="w">hover_colour</span>    <span class="cm">=&gt;</span> <span class="i">$hover_colour</span><span class="cm">,</span>
            -<span class="w">class</span>           <span class="cm">=&gt;</span> <span class="q">'dropnav'</span><span class="cm">,</span>
        <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#    $p .= &quot;&lt;/font&gt;\n&quot;;</span>

    <span class="k">return</span> <span class="i">$p</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#######################</span>
<a name="header_messages-"></a><span class="k">sub </span><span class="m">header_messages</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$messages</span><span class="sc">;</span>

    <span class="i">$messages</span> .= <span class="i">validate_Printers</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$messages</span> .= <span class="i">show_current_messages</span><span class="s">(</span><span class="i">$dbc</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$messages</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">########################</span>
<a name="validate_Printers-"></a><span class="k">sub </span><span class="m">validate_Printers</span> <span class="s">{</span>
<span class="c">########################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$messages</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$session</span> = <span class="i">$dbc</span><span class="i">-&gt;session</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$warning</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$printer_group</span>   = <span class="i">$session</span>-&gt;{<span class="w">user_settings</span>}{<span class="w">PRINTER_GROUP</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$current_printer</span> = <span class="i">$session</span>-&gt;{<span class="w">printer_group</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$prompt</span> = <span class="q">'Set'</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$current_printer</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span><span class="i">$printer_group</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$warning</span> = <span class="q">&quot;Set Default Printer Group to $printer_group&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$ok</span> = <span class="i">alDente::Barcoding::reset_Printer_Group</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$printer_group</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$ok</span><span class="s">)</span> <span class="s">{</span> <span class="i">$prompt</span> = <span class="q">'Change'</span> <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$warning</span> = <span class="q">'Printer Group not defined'</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$messages</span> .= <span class="i">alDente::Barcode_Views::reset_Printer_button</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">warning</span> <span class="cm">=&gt;</span> <span class="i">$warning</span><span class="cm">,</span> -<span class="w">prompt</span> <span class="cm">=&gt;</span> <span class="i">$prompt</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$messages</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<a name="show_current_messages-"></a><span class="k">sub </span><span class="m">show_current_messages</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="k">shift</span> || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$p</span> = <span class="q">''</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># Print Messages    #</span>

    <span class="k">my</span> <span class="i">$removed_messages</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">param</span><span class="s">(</span><span class="q">&quot;Remove Message&quot;</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span> <span class="i">$removed_messages</span> = <span class="k">join</span> <span class="q">','</span><span class="cm">,</span> <span class="i">param</span><span class="s">(</span><span class="q">&quot;Message&quot;</span><span class="s">)</span> <span class="s">}</span>

    <span class="k">my</span> <span class="i">$homelink</span> = <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="sc">;</span>

    <span class="k">require</span> <span class="w">alDente::Messaging</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$msg_obj</span> = <span class="w">alDente::Messaging</span><span class="w">-&gt;new</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$msgref</span><span class="s">)</span> = <span class="i">$msg_obj</span><span class="i">-&gt;get_messages</span><span class="s">(</span> -<span class="w">exclude</span> <span class="cm">=&gt;</span> <span class="i">$removed_messages</span><span class="cm">,</span> -<span class="w">homelink</span> <span class="cm">=&gt;</span> <span class="i">$homelink</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#      if (int(@$msgref)) {</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$msgref</span> &amp;&amp; <span class="i">@$msgref</span> &amp;&amp; !<span class="i">$scanner_mode</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@Messages</span> = <span class="i">@$msgref</span><span class="sc">;</span>
        <span class="i">$p</span> .= <span class="q">&quot;&lt;hr/&gt;&quot;</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$remove_link</span> = <span class="i">Link_To</span><span class="s">(</span> <span class="i">$dbc</span><span class="i">-&gt;config</span><span class="s">(</span><span class="q">'homelink'</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;Remove Messages (Mark as Read)&quot;</span><span class="cm">,</span> <span class="q">&quot;&amp;Message+Removal+Window=1&quot;</span><span class="cm">,</span> <span class="i">$Settings</span>{<span class="w">LINK_COLOUR</span>}<span class="cm">,</span> <span class="s">[</span><span class="q">&quot;newwin&quot;</span><span class="s">]</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$p</span> .= <span class="i">create_tree</span><span class="s">(</span> -<span class="w">tree</span> <span class="cm">=&gt;</span> <span class="s">{</span> <span class="q">'Active Message(s):'</span> <span class="cm">=&gt;</span> <span class="i">$remove_link</span> . <span class="i">Cast_List</span><span class="s">(</span> -<span class="w">list</span> <span class="cm">=&gt;</span> \<span class="i">@Messages</span><span class="cm">,</span> -<span class="w">to</span> <span class="cm">=&gt;</span> <span class="q">'UL'</span> <span class="s">)</span> <span class="s">}</span><span class="cm">,</span> -<span class="w">default_open</span> <span class="cm">=&gt;</span> <span class="q">'Active Message(s):'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$p</span> .= <span class="q">&quot;&lt;hr/&gt;&quot;</span><span class="sc">;</span>

<span class="c">#### set login_name for mysql if permissions allow updates... ####</span>
    <span class="k">return</span> <span class="i">$p</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">###########</span>
<a name="Menu-"></a><span class="k">sub </span><span class="m">Menu</span> <span class="s">{</span>
<span class="c">###########</span>
    <span class="k">my</span> <span class="i">%args</span>            = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$sections</span>        = <span class="i">$args</span>{-<span class="w">sections</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>            = <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>             = <span class="i">$args</span>{-<span class="w">dbc</span>} || <span class="i">$Connection</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$style</span>           = <span class="i">$args</span>{-<span class="w">style</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$id</span>              = <span class="i">$args</span>{-<span class="w">id</span>} || <span class="k">rand</span><span class="s">(</span><span class="n">100</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$include_options</span> = <span class="i">$args</span>{-<span class="w">include_options</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$class</span>           = <span class="i">$args</span>{-<span class="w">class</span>} || <span class="q">'tabmenu'</span><span class="sc">;</span>    <span class="c">## two menu types being used are iconmenu, dropnav and tabmenu for now...</span>
    <span class="k">my</span> <span class="i">$inverse</span>         = <span class="i">$args</span>{-<span class="w">inverse</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$user_id</span>   = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'userid'</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dept</span>      = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'current_department'</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$timestamp</span> = <span class="i">date_time</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$menu_items</span> = <span class="s">[</span><span class="s">]</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$menu</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$link</span> =~ <span class="q">/Target_Department/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">### Department Menu at top of header ###</span>
        <span class="i">$style</span> = <span class="q">'topmenu'</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$dept</span> <span class="s">(</span><span class="i">@$sections</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$link</span> =~ <span class="q">s/Target_Department=([\w\s]+)/Target_Department=$dept/</span><span class="sc">;</span>
            <span class="k">push</span> <span class="i">@</span>{<span class="i">$menu_items</span>}<span class="cm">,</span> <span class="s">{</span> <span class="i">$dept</span> <span class="cm">=&gt;</span> <span class="q">&quot;$link&quot;</span> <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="c">### Icon Menu at bottom of header ###</span>
        <span class="i">$style</span>           = <span class="q">'bottommenu'</span><span class="sc">;</span>
        <span class="i">$link</span>            = <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="sc">;</span>
        <span class="i">$menu_items</span>      = <span class="i">$sections</span><span class="sc">;</span>
        <span class="i">$include_options</span> = <span class="n">1</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$BS</span> = <span class="w">new</span> <span class="i">Bootstrap</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$BS</span><span class="i">-&gt;menu</span><span class="s">(</span> <span class="i">$menu_items</span><span class="cm">,</span> -<span class="w">inverse</span> <span class="cm">=&gt;</span> <span class="i">$inverse</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$menu</span> = <span class="q">&quot;\n&lt;div id='$class'&gt;\n&lt;ul id='$style'&gt;\n&quot;</span><span class="sc">;</span>    <span class="c">## open menu</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$include_options</span> &amp;&amp; <span class="i">$class</span> =~ <span class="q">/^drop/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">## dropdown menu section ##</span>
        <span class="i">$id</span> = <span class="i">$style</span><span class="sc">;</span>

        <span class="c">## for now this hides the div elements: header1 and header2 ##</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$hide1</span><span class="cm">,</span> <span class="i">$unhide1</span> <span class="s">)</span> = <span class="i">hide_element</span><span class="s">(</span> <span class="q">'header1'</span><span class="cm">,</span> <span class="q">'Top Header'</span><span class="cm">,</span> <span class="q">'miniheader'</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$hide2</span><span class="cm">,</span> <span class="i">$unhide2</span> <span class="s">)</span> = <span class="i">hide_element</span><span class="s">(</span> <span class="q">'headerform'</span><span class="cm">,</span> <span class="q">'Main Scanner Header'</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$hide3</span><span class="cm">,</span> <span class="i">$unhide3</span> <span class="s">)</span> = <span class="i">hide_element</span><span class="s">(</span> <span class="q">'topmenu'</span><span class="cm">,</span>    <span class="q">'Department Tabs'</span> <span class="s">)</span><span class="sc">;</span>

        <span class="k">my</span> <span class="i">$userid</span> = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'user_id'</span><span class="s">)</span><span class="sc">;</span>
        <span class="c">## Add personal options:  eg: control header visibility, change printer group, adjust personal settings ... ##</span>
        <span class="k">push</span> <span class="i">@$menu_items</span><span class="cm">,</span> <span class="s">{</span>
            <span class="q">'Personal Options'</span> <span class="cm">=&gt;</span> <span class="s">[</span>
                <span class="s">{</span> <span class="q">'Change Password'</span>      <span class="cm">=&gt;</span> <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>} . <span class="q">&quot;&amp;cgi_application=SDB::Session_App&amp;rm=Change Password&quot;</span> <span class="s">}</span><span class="cm">,</span>
                <span class="s">{</span> <span class="q">'Change Printer Group'</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>} . <span class="q">&quot;&amp;cgi_application=alDente::Barcode_App&amp;rm=Change Printer Group&quot;</span> <span class="s">}</span><span class="cm">,</span>
                <span class="s">{</span> <span class="q">'Refresh Settings'</span>     <span class="cm">=&gt;</span> <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>} . <span class="q">&quot;&amp;Refresh+Parameters=1&amp;Database_Mode=$dbc-&gt;{dbase_mode}&amp;Home=Default&quot;</span> <span class="s">}</span><span class="cm">,</span>

                <span class="c"># Edit personal information should use a simple generic editor (DB_Object_App), but this isn't actually working yet... #</span>
                <span class="c"># { 'Edit Personal Information' =&gt; $dbc-&gt;{homelink} . &quot;&amp;cgi_application=SDB::DB_Object_App&amp;rm=Edit Records&amp;&amp;Table=Employee&amp;ID=$userid&quot; },</span>

                <span class="s">{</span>   <span class="q">'Show / Hide Headers'</span> <span class="cm">=&gt;</span>
                        <span class="s">[</span> <span class="s">{</span> <span class="q">'Hide Top Header'</span> <span class="cm">=&gt;</span> <span class="i">$hide1</span> <span class="s">}</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Show Top Header'</span> <span class="cm">=&gt;</span> <span class="i">$unhide1</span> <span class="s">}</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Hide Main Header'</span> <span class="cm">=&gt;</span> <span class="i">$hide2</span> <span class="s">}</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Show Main Header'</span> <span class="cm">=&gt;</span> <span class="i">$unhide2</span> <span class="s">}</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Hide Department Tabs'</span> <span class="cm">=&gt;</span> <span class="i">$hide3</span> <span class="s">}</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Show Department Tabs'</span> <span class="cm">=&gt;</span> <span class="i">$unhide3</span> <span class="s">}</span> <span class="s">]</span>
                <span class="s">}</span>
            <span class="s">]</span>
        <span class="s">}</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$active</span> = <span class="n">0</span><span class="sc">;</span>    <span class="c">## active menu item;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$d</span> <span class="s">(</span><span class="i">@$menu_items</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$menu</span> .= <span class="i">add_sub_labels</span><span class="s">(</span> -<span class="w">hash</span> <span class="cm">=&gt;</span> <span class="i">$d</span><span class="cm">,</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="i">$class</span><span class="cm">,</span> -<span class="w">link</span> <span class="cm">=&gt;</span> <span class="i">$link</span><span class="cm">,</span> -<span class="w">dept</span> <span class="cm">=&gt;</span> <span class="i">$dept</span><span class="cm">,</span> -<span class="w">active</span> <span class="cm">=&gt;</span> <span class="i">$active</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$menu</span> .= <span class="q">&quot;\n&lt;/ul&gt;\n&lt;/div&gt;\n&quot;</span><span class="sc">;</span>    <span class="c">## close menu</span>

    <span class="k">return</span> <span class="i">$menu</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Wrapper to generate hide / unhide elements on the current page</span>
<span class="c"># (eg. can be used to enable options to hide / show headers on page)</span>
<span class="c"># Return: (hide_element_string, unhide_element_string)</span>
<span class="c">#</span>
<span class="c">####################</span>
<a name="hide_element-"></a><span class="k">sub </span><span class="m">hide_element</span> <span class="s">{</span>
<span class="c">####################</span>
    <span class="k">my</span> <span class="i">%args</span>           = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'element,content,unhide'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$element</span>        = <span class="i">$args</span>{-<span class="w">element</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$content</span>        = <span class="i">$args</span>{-<span class="w">content</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$unhide_element</span> = <span class="i">$args</span>{-<span class="w">unhide</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$hide</span>   = <span class="q">&quot;&lt;a href='#' class='button' id='hide.$element'  style='color:black; font-weight:bold;' onclick=\&quot;HideElement('$element'); this.style.color='white'; getElementById('unhide.$element').style.color='black';&quot;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$unhide</span> = <span class="q">&quot;&lt;a href='#' class='button' id='unhide.$element' style='color:white; font-weight:bold;' onclick=\&quot;unHideElement('$element'); this.style.color='white'; getElementById('hide.$element').style.color='black'; &quot;</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$unhide</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$hide</span>   .= <span class="q">&quot; unHideElement('$unhide_element');&quot;</span><span class="sc">;</span>
        <span class="i">$unhide</span> .= <span class="q">&quot; HideElement('$unhide_element');&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$hide</span>   .= <span class="q">&quot;\&quot;&gt;\n&lt;span&gt;Hide $content&lt;/span&gt;&lt;/a&gt;\n&quot;</span><span class="sc">;</span>
    <span class="i">$unhide</span> .= <span class="q">&quot;\&quot;&gt;\n&lt;span&gt;Show $content&lt;/span&gt;&lt;/a&gt;\n&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="s">(</span> <span class="i">$hide</span><span class="cm">,</span> <span class="i">$unhide</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#######################</span>
<a name="add_sub_labels-"></a><span class="k">sub </span><span class="m">add_sub_labels</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="k">my</span> <span class="i">%args</span>      = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$d</span>         = <span class="i">$args</span>{-<span class="w">hash</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$class</span>     = <span class="i">$args</span>{-<span class="w">class</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$link</span>      = <span class="i">$args</span>{ -<span class="k">link</span> }<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dept</span>      = <span class="i">$args</span>{-<span class="w">dept</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$active</span>    = <span class="i">$args</span>{-<span class="w">active</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$recursive</span> = <span class="i">$args</span>{-<span class="w">recursive</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$label</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> !<span class="i">$d</span> <span class="s">)</span> <span class="s">{</span><span class="k">return</span><span class="s">}</span>

    <span class="k">my</span> <span class="i">$menu</span><span class="sc">;</span>

    <span class="c"># Print the tabs</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$display_section</span><span class="cm">,</span> <span class="i">$display_target</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">ref</span> <span class="i">$d</span> <span class="k">eq</span> <span class="q">'ARRAY'</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$display_section</span> = <span class="i">$d</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span>
        <span class="i">$display_target</span>  = <span class="i">$d</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="k">ref</span> <span class="i">$d</span> <span class="k">eq</span> <span class="q">'HASH'</span> <span class="s">)</span> <span class="s">{</span>
        <span class="s">(</span><span class="i">$display_section</span><span class="s">)</span> = <span class="k">keys</span> <span class="i">%$d</span><span class="sc">;</span>
        <span class="s">(</span><span class="i">$display_target</span><span class="s">)</span>  = <span class="k">values</span> <span class="i">%$d</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$display_section</span> = <span class="i">$d</span><span class="sc">;</span>
        <span class="i">$display_target</span>  = <span class="q">''</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$this_class</span><span class="cm">,</span> <span class="i">@sub_labels</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$dept</span> <span class="k">eq</span> <span class="i">$display_section</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">### dept menu only ###</span>
        <span class="i">$this_class</span> = <span class="q">&quot;id='activelabel' style='background-color:$headerbg'&quot;</span><span class="sc">;</span>    <span class="c">#  match active label with colour of core header (differs from other tabs...);</span>
        <span class="i">$active</span>     = <span class="n">1</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$thislink</span> = <span class="i">$link</span><span class="sc">;</span>
        <span class="i">$thislink</span> =~ <span class="q">s/Target_Department=(\w+)/Target_Department=$dept/</span><span class="sc">;</span>
        <span class="i">$label</span> .= <span class="i">&amp;Link_To</span><span class="s">(</span> <span class="i">$thislink</span><span class="cm">,</span> <span class="i">$display_section</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span> <span class="k">ref</span> <span class="i">$display_target</span> <span class="k">eq</span> <span class="q">'ARRAY'</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">### sub menus included ###</span>
        <span class="i">@sub_labels</span> = <span class="i">@$display_target</span><span class="sc">;</span>
        <span class="i">$this_class</span> = <span class="q">&quot;class='has-sub '&quot;</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span><span class="i">$recursive</span><span class="s">)</span> <span class="s">{</span> <span class="i">$display_section</span> .= <span class="q">' &gt;&gt;'</span> <span class="s">}</span>                           <span class="c">## after top menu - indicates expandable option...</span>
        <span class="i">$label</span> .= <span class="i">$display_section</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$display_target</span> ||= <span class="i">$link</span><span class="sc">;</span>
        <span class="i">$label</span> .= <span class="i">&amp;Link_To</span><span class="s">(</span> <span class="i">$display_target</span><span class="cm">,</span> <span class="i">$display_section</span> <span class="s">)</span><span class="sc">;</span>

        <span class="k">if</span> <span class="s">(</span> !<span class="i">$active</span> <span class="s">)</span> <span class="s">{</span>
            <span class="c">### first of list in lower menu (not sure if necessary) ###</span>
            <span class="i">$this_class</span> = <span class="q">&quot;class='active '&quot;</span><span class="sc">;</span>
            <span class="i">$active</span>     = <span class="n">1</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="i">$menu</span> .= <span class="q">&quot;\t&lt;li $this_class&gt;$label\n&quot;</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">@sub_labels</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$menu</span> .= <span class="q">&quot;\n\t\t&lt;ul&gt;\n&quot;</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$sub_label</span> <span class="s">(</span><span class="i">@sub_labels</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="s">(</span><span class="i">$sub_text</span><span class="s">)</span>   = <span class="k">keys</span> <span class="i">%</span>{<span class="i">$sub_label</span>}<span class="sc">;</span>
            <span class="k">my</span> <span class="s">(</span><span class="i">$sub_target</span><span class="s">)</span> = <span class="k">values</span> <span class="i">%</span>{<span class="i">$sub_label</span>}<span class="sc">;</span>

            <span class="k">if</span> <span class="s">(</span> <span class="k">ref</span> <span class="i">$sub_target</span> <span class="k">eq</span> <span class="q">'ARRAY'</span> <span class="s">)</span> <span class="s">{</span>
                <span class="i">$menu</span> .= <span class="i">add_sub_labels</span><span class="s">(</span> -<span class="w">hash</span> <span class="cm">=&gt;</span> <span class="s">{</span> <span class="i">$sub_text</span> <span class="cm">=&gt;</span> <span class="i">$sub_target</span> <span class="s">}</span><span class="cm">,</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="i">$class</span><span class="cm">,</span> -<span class="w">link</span> <span class="cm">=&gt;</span> <span class="i">$link</span><span class="cm">,</span> -<span class="w">dept</span> <span class="cm">=&gt;</span> <span class="i">$dept</span><span class="cm">,</span> -<span class="w">active</span> <span class="cm">=&gt;</span> <span class="i">$active</span><span class="cm">,</span> -<span class="w">recursive</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">else</span> <span class="s">{</span>
                <span class="k">if</span> <span class="s">(</span> <span class="i">$sub_target</span> =~ <span class="q">/\&lt;a href/i</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="c">## target contains a link .. leave it alone ##</span>
                    <span class="i">$sub_text</span> = <span class="i">$sub_target</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">elsif</span> <span class="s">(</span> <span class="i">$sub_target</span> =~ <span class="q">/^http:/i</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="c">## target is fully qualified link ##</span>
                    <span class="i">$sub_text</span> = <span class="i">&amp;Link_To</span><span class="s">(</span> <span class="i">$sub_target</span><span class="cm">,</span> <span class="i">$sub_text</span> <span class="s">)</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">else</span> <span class="s">{</span>
                    <span class="i">$sub_text</span> = <span class="i">&amp;Link_To</span><span class="s">(</span> <span class="i">$link</span><span class="cm">,</span> <span class="i">$sub_text</span><span class="cm">,</span> <span class="i">$sub_target</span> <span class="s">)</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="i">$menu</span> .= <span class="q">&quot;\n\t\t\t&lt;li&gt;$sub_text&lt;/li&gt;\n&quot;</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
        <span class="i">$menu</span> .= <span class="q">&quot;\n\t\t&lt;/ul&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="i">$menu</span> .= <span class="q">&quot;\t&lt;/li&gt;\n&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$menu</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Load user views into the dropdown menu</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># Return array of hashes for LI elements as</span>
<span class="c">#######################</span>
<a name="load_user_views-"></a><span class="k">sub </span><span class="m">load_user_views</span> <span class="s">{</span>
<span class="c">#######################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>  = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dept</span> = <span class="i">$args</span>{-<span class="w">dept</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$View</span> = <span class="w">new</span> <span class="i">alDente::View</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@views</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$homelink</span> = <span class="i">$dbc</span><span class="i">-&gt;homelink</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="i">$Benchmark</span>{<span class="w">load_user_views</span>} = <span class="w">new</span> <span class="i">Benchmark</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@Eviews</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$user_id</span> = <span class="i">$dbc</span><span class="i">-&gt;get_local</span><span class="s">(</span><span class="q">'user_id'</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$Eviews</span> = <span class="i">$View</span><span class="i">-&gt;get_available_employee_views</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$Eviews</span> &amp;&amp; <span class="k">values</span> <span class="i">%$Eviews</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">%Eviews</span> = <span class="i">%</span>{ <span class="i">$Eviews</span>-&gt;{<span class="i">$user_id</span>} }<span class="sc">;</span>    <span class="c">## only one</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%Eviews</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">$val</span> = <span class="i">$Eviews</span>{<span class="i">$key</span>}<span class="sc">;</span>
            <span class="k">push</span> <span class="i">@Eviews</span><span class="cm">,</span> <span class="s">{</span> <span class="i">$val</span> <span class="cm">=&gt;</span> <span class="i">$homelink</span> . <span class="q">'&amp;cgi_application=alDente::View_App&amp;rm=Display&amp;File='</span> . <span class="i">$key</span> . <span class="q">'&amp;Generate+Results=1'</span> <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">@Eviews</span><span class="s">)</span> <span class="s">{</span> <span class="k">push</span> <span class="i">@views</span><span class="cm">,</span> <span class="s">{</span> <span class="q">'Personal Views'</span> <span class="cm">=&gt;</span> \<span class="i">@Eviews</span> <span class="s">}</span> <span class="s">}</span>

    <span class="i">$Benchmark</span>{<span class="w">load_public_views</span>} = <span class="w">new</span> <span class="i">Benchmark</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@Pviews</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$Pviews</span> = <span class="i">$View</span><span class="i">-&gt;get_available_group_views</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">department</span> <span class="cm">=&gt;</span> <span class="q">'GSC'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$Pviews</span> &amp;&amp; <span class="k">keys</span> <span class="i">%$Pviews</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@groups</span> = <span class="k">keys</span> <span class="i">%$Pviews</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$group</span> <span class="s">(</span><span class="i">@groups</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">%Pviews</span> = <span class="i">%</span>{ <span class="i">$Pviews</span>-&gt;{<span class="i">$group</span>} }<span class="sc">;</span>
            <span class="k">my</span> <span class="i">$group_ref</span> = <span class="i">$dbc</span><span class="i">-&gt;get_FK_info</span><span class="s">(</span> -<span class="w">field</span> <span class="cm">=&gt;</span> <span class="q">'FK_Grp__ID'</span><span class="cm">,</span> -<span class="w">id</span> <span class="cm">=&gt;</span> <span class="i">$group</span> <span class="s">)</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="k">keys</span> <span class="i">%Pviews</span> <span class="s">)</span> <span class="s">{</span>
                <span class="k">push</span> <span class="i">@Pviews</span><span class="cm">,</span> <span class="s">{</span> <span class="i">$Pviews</span>{<span class="i">$key</span>} <span class="cm">=&gt;</span> <span class="i">$homelink</span> . <span class="q">'&amp;cgi_application=alDente::View_App&amp;rm=Display&amp;File='</span> . <span class="i">$key</span> . <span class="q">'&amp;Generate+Results=1'</span> <span class="s">}</span><span class="sc">;</span>
            <span class="s">}</span>
            <span class="k">push</span> <span class="i">@views</span><span class="cm">,</span> <span class="s">{</span> <span class="q">&quot;$group_ref Views&quot;</span> <span class="cm">=&gt;</span> \<span class="i">@Pviews</span> <span class="s">}</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="i">$Benchmark</span>{<span class="w">load_group_views</span>} = <span class="w">new</span> <span class="i">Benchmark</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$dept</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$Gviews</span> = <span class="i">$View</span><span class="i">-&gt;get_available_group_views</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">department</span> <span class="cm">=&gt;</span> <span class="i">$dept</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$Gviews</span> &amp;&amp; <span class="k">keys</span> <span class="i">%$Gviews</span> <span class="s">)</span> <span class="s">{</span>
            <span class="k">my</span> <span class="i">@groups</span> = <span class="k">keys</span> <span class="i">%$Gviews</span><span class="sc">;</span>
            <span class="k">foreach</span> <span class="k">my</span> <span class="i">$group</span> <span class="s">(</span><span class="i">@groups</span><span class="s">)</span> <span class="s">{</span>
                <span class="k">my</span> <span class="i">@Gviews_list</span><span class="sc">;</span>
                <span class="k">my</span> <span class="i">%Gviews</span> = <span class="i">%</span>{ <span class="i">$Gviews</span>-&gt;{<span class="i">$group</span>} }<span class="sc">;</span>
                <span class="k">my</span> <span class="i">$group_ref</span> = <span class="i">$dbc</span><span class="i">-&gt;get_FK_info</span><span class="s">(</span> -<span class="w">field</span> <span class="cm">=&gt;</span> <span class="q">'FK_Grp__ID'</span><span class="cm">,</span> -<span class="w">id</span> <span class="cm">=&gt;</span> <span class="i">$group</span> <span class="s">)</span><span class="sc">;</span>
                <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="k">sort</span> <span class="k">keys</span> <span class="i">%Gviews</span> <span class="s">)</span> <span class="s">{</span>
                    <span class="k">push</span> <span class="i">@Gviews_list</span><span class="cm">,</span> <span class="s">{</span> <span class="i">$Gviews</span>{<span class="i">$key</span>} <span class="cm">=&gt;</span> <span class="i">$homelink</span> . <span class="q">'&amp;cgi_application=alDente::View_App&amp;rm=Display&amp;File='</span> . <span class="i">$key</span> . <span class="q">'&amp;Generate+Results=1'</span> <span class="s">}</span><span class="sc">;</span>
                <span class="s">}</span>
                <span class="k">push</span> <span class="i">@views</span><span class="cm">,</span> <span class="s">{</span> <span class="q">&quot;$group_ref Views&quot;</span> <span class="cm">=&gt;</span> \<span class="i">@Gviews_list</span> <span class="s">}</span><span class="sc">;</span>
            <span class="s">}</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="i">$Benchmark</span>{<span class="w">loaded_views</span>} = <span class="w">new</span> <span class="i">Benchmark</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="c">#    Clearly delineate section with views (?)</span>
    <span class="c">#    if (@views) { unshift @views, { 'Custom Views' =&gt; &quot;&lt;a href='#'&gt;--- Custom Views ---&lt;/a&gt;&quot; } }</span>

    <span class="k">return</span> <span class="i">@views</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Refactored and redirected to new Menu method ...</span>
<span class="c">#</span>
<span class="c">#########################</span>
<a name="Tab_Bar-"></a><span class="k">sub </span><span class="m">Tab_Bar</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="c">#</span>
    <span class="c"># Refactored into new Menu method</span>
    <span class="c">#</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">Menu</span><span class="s">(</span><span class="i">%args</span><span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#######################</span>
<span class="c">#</span>
<span class="c"># Provide a quick page that simply prompts for fields that are missing.</span>
<span class="c"># This resubmits input parameters along with the prompted field(s)</span>
<span class="c"># &lt;snip&gt;</span>
<span class="c"># Example:</span>
<span class="c">#    unless (param('FK_Employee__ID') {</span>
<span class="c">#       alDente::Web::reload_parameters($dbc, 'FK_Employee__ID',-prompt=&gt;'Who',-values=&gt;['me','you'])</span>
<span class="c">#    }</span>
<span class="c">#</span>
<span class="c">#  or  alDente::Web::reload_parameters($dbc, 'FK_Employee__ID,FK_Library__Name',</span>
<span class="c">#                                      -parameters=&gt;{&amp;Set_Parameters()</span>
<span class="c">#                                      -prompt=&gt;{'FK_Employee__ID'=&gt;'Who','FK_Library__Name'=&gt;&quot;Library:&quot;},</span>
<span class="c">#                                      -values=&gt;{'FK_Employee__ID' =&gt; ['me','you'],'FK_Library__Name'=&gt;$Dbc-&gt;get_library_list(-project=&gt;1)} );</span>
<span class="c">########################</span>
<a name="reload_parameters-"></a><span class="k">sub </span><span class="m">reload_parameters</span> <span class="s">{</span>
<span class="c">########################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,required'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>        = <span class="i">$args</span>{-<span class="w">dbc</span>} || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$required</span>   = <span class="i">$args</span>{-<span class="w">required</span>}<span class="sc">;</span>                                                                <span class="c">## fields that should be required (regenerates page, prompting for these fields to be entered...</span>
    <span class="k">my</span> <span class="i">$values</span>     = <span class="i">$args</span>{ -<span class="k">values</span> }<span class="sc">;</span>                                                                <span class="c">## hash (keyed on fields required) indicating values applicable - generates popup_menu ## (scalar ok if only 1 required field)</span>
    <span class="k">my</span> <span class="i">$prompt</span>     = <span class="i">$args</span>{-<span class="w">prompt</span>}<span class="sc">;</span>                                                                  <span class="c">## hash (keyed on fields required) indicating prompts to use.. ## (scalar ok if only 1 required field)</span>
    <span class="k">my</span> <span class="i">$parameters</span> = <span class="i">$args</span>{-<span class="w">parameters</span>}<span class="sc">;</span>                                                              <span class="c">## input parameters</span>

    <span class="k">my</span> <span class="i">%Prompt</span> = <span class="i">%</span>{<span class="i">$prompt</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">%Values</span> = <span class="i">%</span>{<span class="i">$values</span>}<span class="sc">;</span>

    <span class="k">unless</span> <span class="s">(</span> <span class="i">$required</span> =~ <span class="q">/,/</span> <span class="s">)</span> <span class="s">{</span>                                                                     <span class="c">## allow scalar if only one field</span>
        <span class="i">$Prompt</span>{<span class="i">$required</span>} = <span class="i">$prompt</span> <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$Prompt</span>{<span class="i">$required</span>} <span class="s">)</span><span class="sc">;</span>
        <span class="i">$Values</span>{<span class="i">$required</span>} = <span class="i">$values</span> <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$Values</span>{<span class="i">$required</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">@required_list</span> = <span class="i">Cast_List</span><span class="s">(</span> -<span class="w">list</span> <span class="cm">=&gt;</span> <span class="i">$required</span><span class="cm">,</span> -<span class="w">to</span> <span class="cm">=&gt;</span> <span class="q">'array'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#    print alDente::Form::start_alDente_form($dbc, 'ReLoad', -parameters =&gt; $parameters );</span>
    <span class="k">print</span> <span class="i">alDente::Form::start_alDente_form</span><span class="s">(</span> -<span class="w">dbc</span> <span class="cm">=&gt;</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'ReLoad'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">print</span> <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'carried'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">'over'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$key</span> <span class="s">(</span> <span class="i">param</span><span class="s">(</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">@values</span> = <span class="i">param</span><span class="s">(</span><span class="i">$key</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$value</span> <span class="s">(</span><span class="i">@values</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">print</span> <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$key</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$value</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$required_field</span> <span class="s">(</span><span class="i">@required_list</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$prompt</span> = <span class="i">$Prompt</span>{<span class="i">$required_field</span>} || <span class="i">$required_field</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$Values</span>{<span class="i">$required_field</span>} <span class="s">)</span> <span class="s">{</span> <span class="i">$prompt</span> .= <span class="i">popup_menu</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$prompt</span><span class="cm">,</span> -<span class="w">values</span> <span class="cm">=&gt;</span> <span class="i">$Values</span>{<span class="i">$required_field</span>}<span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span> <span class="s">}</span>
        <span class="k">else</span>                            <span class="s">{</span> <span class="i">$prompt</span> .= <span class="i">textfield</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$required_field</span><span class="cm">,</span> -<span class="w">size</span> <span class="cm">=&gt;</span> <span class="n">20</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span> <span class="s">}</span>
        <span class="k">print</span> <span class="i">standard_label</span><span class="s">(</span><span class="i">$prompt</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">print</span> <span class="i">submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'resubmit'</span><span class="cm">,</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="q">'Action'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="q">&quot;\n&quot;</span> . <span class="i">end_form</span><span class="s">(</span><span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>

    <span class="k">return</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">##########################</span>
<span class="c"># Initialize alDente-specific cookies</span>
<span class="c">##########################</span>
<a name="initialize_cookies-"></a><span class="k">sub </span><span class="m">initialize_cookies</span> <span class="s">{</span>
<span class="c">##########################</span>

    <span class="k">my</span> <span class="i">$cookie</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@cookies</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$user</span> <span class="s">)</span> &amp;&amp; <span class="s">(</span> <span class="i">$user</span> <span class="k">ne</span> <span class="q">'nobody'</span> <span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$cookie</span> = <span class="i">cookie</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">&quot;$URL_dir_name:user&quot;</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$user</span><span class="cm">,</span> -<span class="w">expires</span> <span class="cm">=&gt;</span> <span class="q">&quot;+1y&quot;</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@cookies</span><span class="cm">,</span> <span class="i">$cookie</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">$user</span> <span class="k">ne</span> <span class="q">'Guest'</span> &amp;&amp; <span class="i">$user</span> <span class="k">ne</span> <span class="q">'Auto'</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$cookie</span> = <span class="i">cookie</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">&quot;$URL_dir_name:active&quot;</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="k">time</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> -<span class="w">expires</span> <span class="cm">=&gt;</span> <span class="q">&quot;+1y&quot;</span> <span class="s">)</span><span class="sc">;</span>
            <span class="c">###Couldn't use &quot;-expires=&gt;'+5m' since doesn't work with IE!!!!</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@cookies</span><span class="cm">,</span> <span class="i">$cookie</span> <span class="s">)</span><span class="sc">;</span>

        <span class="s">}</span>
        <span class="k">my</span> <span class="i">$last_department</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="i">param</span><span class="s">(</span><span class="q">'Target_Department'</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
            <span class="i">$last_department</span> = <span class="i">param</span><span class="s">(</span><span class="q">'Target_Department'</span><span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
        <span class="k">elsif</span> <span class="s">(</span><span class="i">$Current_Department</span><span class="s">)</span> <span class="s">{</span> <span class="i">$last_department</span> = <span class="i">$Current_Department</span> <span class="s">}</span>

        <span class="k">if</span> <span class="s">(</span><span class="i">$last_department</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">$cookie</span> = <span class="i">cookie</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">&quot;$user_id:last_department&quot;</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$last_department</span><span class="cm">,</span> -<span class="w">expires</span> <span class="cm">=&gt;</span> <span class="q">&quot;+1y&quot;</span> <span class="s">)</span><span class="sc">;</span>    <span class="c"># Set last page the user was in</span>
            <span class="k">push</span><span class="s">(</span> <span class="i">@cookies</span><span class="cm">,</span> <span class="i">$cookie</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>

    <span class="k">return</span> \<span class="i">@cookies</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#################################</span>
<span class="c">### Moved from Submission::Public</span>
<span class="c"># Subroutine: Initialize cookie array for CGI</span>
<span class="c"># Return: An arrayref of cookies</span>
<span class="c">#################################</span>
<a name="gen_cookies-"></a><span class="k">sub </span><span class="m">gen_cookies</span> <span class="s">{</span>
<span class="c">#################################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'names,values,expires'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$names</span>   = <span class="i">$args</span>{-<span class="w">names</span>}<span class="sc">;</span>       <span class="c"># (ArrayRef) A list of names for the cookies</span>
    <span class="k">my</span> <span class="i">$values</span>  = <span class="i">$args</span>{ -<span class="k">values</span> }<span class="sc">;</span>    <span class="c"># (ArrayRef) A list of values of the cookies</span>
    <span class="k">my</span> <span class="i">$expires</span> = <span class="i">$args</span>{-<span class="w">expires</span>}<span class="sc">;</span>     <span class="c"># (ArrayRef) A list of expiry dates for the cookies</span>

    <span class="k">my</span> <span class="i">@names_list</span>   = <span class="i">&amp;Cast_List</span><span class="s">(</span> -<span class="w">list</span> <span class="cm">=&gt;</span> <span class="i">$names</span><span class="cm">,</span>   -<span class="w">to</span> <span class="cm">=&gt;</span> <span class="q">'array'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@values_list</span>  = <span class="i">&amp;Cast_List</span><span class="s">(</span> -<span class="w">list</span> <span class="cm">=&gt;</span> <span class="i">$values</span><span class="cm">,</span>  -<span class="w">to</span> <span class="cm">=&gt;</span> <span class="q">'array'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@expires_list</span> = <span class="i">&amp;Cast_List</span><span class="s">(</span> -<span class="w">list</span> <span class="cm">=&gt;</span> <span class="i">$expires</span><span class="cm">,</span> -<span class="w">to</span> <span class="cm">=&gt;</span> <span class="q">'array'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@cookies</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$counter</span> = <span class="n">0</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$name</span> <span class="s">(</span><span class="i">@names_list</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$value</span>  = <span class="i">$values_list</span>[<span class="i">$counter</span>]<span class="sc">;</span>
        <span class="k">my</span> <span class="i">$expire</span> = <span class="i">$expires_list</span>[<span class="i">$counter</span>]<span class="sc">;</span>
        <span class="k">push</span><span class="s">(</span> <span class="i">@cookies</span><span class="cm">,</span> <span class="i">&amp;cookie</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="i">$name</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$value</span><span class="cm">,</span> -<span class="w">expires</span> <span class="cm">=&gt;</span> <span class="i">$expire</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="i">$counter</span>++<span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> \<span class="i">@cookies</span><span class="sc">;</span>
<span class="s">}</span>
<span class="c">#########################</span>
<span class="c"># Initialize LIMS page</span>
<span class="c">#########################</span>
<a name="Initialize_page-"></a><span class="k">sub </span><span class="m">Initialize_page</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">%args</span>           = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>            = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$full_width</span>     = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="i">$Settings</span>{<span class="w">PAGE_WIDTH</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$cookie_ref</span>     = <span class="i">$args</span>{-<span class="w">cookie_ref</span>}<span class="sc">;</span>                            <span class="c"># (ArrayRef) Array of cookies to place into</span>
    <span class="k">my</span> <span class="i">$css_pragma_str</span> = <span class="i">$args</span>{-<span class="w">css_pragma_header</span>} || <span class="i">$html_header</span><span class="sc">;</span>     <span class="c"># (Scalar) String definition of css</span>
    <span class="k">my</span> <span class="i">$js_str</span>         = <span class="i">$args</span>{-<span class="w">java_header</span>} || <span class="i">$java_header</span><span class="sc">;</span>           <span class="c"># (Scalar) String definition of javascript source files</span>
    <span class="k">my</span> <span class="i">$topbar</span>         = <span class="i">$args</span>{-<span class="w">topbar</span>}<span class="sc">;</span>                                <span class="c"># (Scalar) [Optional] string definition of the topbar</span>
    <span class="k">my</span> <span class="i">$header</span>         = <span class="i">$args</span>{-<span class="w">header</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$offset</span>         = <span class="i">$args</span>{-<span class="w">offset</span>} || <span class="n">0</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$include</span>        = <span class="i">$args</span>{-<span class="w">include</span>} || <span class="q">'Home,Info,Contact,Help'</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$colspan</span> = <span class="n">10</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$width</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$offset</span><span class="s">)</span> <span class="s">{</span> <span class="i">$width</span> = <span class="i">$full_width</span> - <span class="i">$offset</span> <span class="s">}</span>

    <span class="c"># if no cookies, then use the default cookies from LIMS</span>
    <span class="k">unless</span> <span class="s">(</span><span class="i">$cookie_ref</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$cookie_ref</span> = <span class="i">&amp;initialize_cookies</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$str</span> = <span class="i">header</span><span class="s">(</span> -<span class="w">cookie</span> <span class="cm">=&gt;</span> <span class="i">$cookie_ref</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="q">&quot;&lt;HTML&gt;\n&quot;</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="q">&quot;&lt;!--- Initializing page ---&gt;\n&quot;</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="i">$css_pragma_str</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="i">$js_str</span><span class="sc">;</span>

    <span class="i">$str</span> .= <span class="q">&quot;\n&lt;BODY&gt;&quot;</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="q">&quot;&lt;noscript&gt;\n</span>
    <span class="q">    &lt;table width='100%' bgcolor=yellow&gt;&lt;tr&gt;&lt;td&gt;&lt;center&gt;</span>
    <span class="q">    &lt;font color=red size=+1&gt;&lt;b&gt;JavaScript has been Disabled!&lt;/b&gt;&lt;/font&gt;&lt;BR&gt;</span>
    <span class="q">    &lt;font color=red size=-1&gt;Please note that in order to take full advantage of alDente LIMS' functionalities, you need to enable JavaScript&lt;/font&gt;</span>
    <span class="q">    &lt;br&gt;</span>
    <span class="q">    &lt;font color=blue size=-1&gt;For more information, please visit &lt;a href='https://www.google.com/support/adsense/bin/answer.py?answer=12654'&gt;Enabling JavaScript&lt;/a&gt;&lt;/font&gt;</span>
    <span class="q">    &lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n&lt;/noscript&gt;\n&quot;</span><span class="sc">;</span>

    <span class="i">$str</span> .= <span class="q">&quot;&lt;Table width=$full_width Border=0 cellspacing=0 cellpadding=0&gt;\n&quot;</span><span class="sc">;</span>

    <span class="i">$str</span> .= <span class="q">&quot;&lt;TR&gt;\n&quot;</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="q">&quot;&quot;</span><span class="sc">;</span>
    <span class="i">$str</span> .= <span class="q">&quot;&lt;TD&gt;&quot;</span> . <span class="i">&amp;hspace</span><span class="s">(</span><span class="i">$offset</span><span class="s">)</span> . <span class="q">&quot;&lt;/TD&gt;&quot;</span><span class="sc">;</span>                               <span class="c">## left margin</span>
    <span class="i">$str</span> .= <span class="q">&quot;&lt;TD colspan=$colspan&gt;&lt;div id='navtxt' class='navtext'&gt;&lt;/div&gt;&quot;</span><span class="sc">;</span>    <span class="c">## allow three columns for topbar if necessary...</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$topbar</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="i">$topbar</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">elsif</span> <span class="s">(</span><span class="i">$header</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="i">&amp;show_topbar</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$width</span><span class="cm">,</span> -<span class="w">include</span> <span class="cm">=&gt;</span> <span class="i">$include</span><span class="cm">,</span> -<span class="w">header</span> <span class="cm">=&gt;</span> <span class="i">$header</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="i">&amp;show_topbar</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$width</span><span class="cm">,</span> -<span class="w">include</span> <span class="cm">=&gt;</span> <span class="i">$include</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$str</span> .= <span class="q">&quot;&lt;/TD&gt;&lt;/TR&gt;\n&quot;</span><span class="sc">;</span>

    <span class="c">## add alternative header (hidden) in case user wants to shrink main header ##</span>
    <span class="c">#    $str .= &quot;&lt;TR&gt;&quot; . &quot;&lt;div id='miniheader' style='display:none'&gt;&quot; . user_label( $dbc, $include ) . '&lt;/div&gt;' . '&lt;/TR&gt;';</span>

    <span class="i">$str</span> .= <span class="q">&quot;&lt;TR&gt;&lt;TD&gt;&lt;/TD&gt;&lt;TD colspan=$colspan&gt;\n&lt;div id='miniheader' style='display:none'&gt;\n&quot;</span> . <span class="i">user_label</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> <span class="i">$include</span> <span class="s">)</span> . <span class="q">&quot;&lt;/div&gt;\n&quot;</span><span class="sc">;</span>

    <span class="c">#    $str .= &quot;&lt;HR style=\&quot;margin-bottom:1px; margin-top:0px;\&quot;&gt;&quot;;</span>
    <span class="c">### set width for body of page... as defined</span>
    <span class="c">#$str .= &quot;&lt;Table width=$width cellpadding=5 border=0 cellspacing=0&gt;&lt;TR&gt;&lt;TD&gt;&quot;;</span>

    <span class="k">return</span> <span class="i">$str</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#########################</span>
<span class="c"># show bottom LIMS bar and close formatting tables</span>
<span class="c">#########################</span>
<a name="unInitialize_page-"></a><span class="k">sub </span><span class="m">unInitialize_page</span> <span class="s">{</span>
<span class="c">#########################</span>
    <span class="k">my</span> <span class="i">%args</span>   = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$botbar</span> = <span class="i">$args</span>{-<span class="w">botbar</span>}<span class="sc">;</span>         <span class="c"># (Scalar) Bottom bar</span>
    <span class="k">my</span> <span class="i">$width</span>  = <span class="i">$args</span>{-<span class="w">width</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$offset</span> = <span class="i">$args</span>{-<span class="w">offset</span>} || <span class="n">0</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$str</span> = <span class="q">''</span><span class="sc">;</span>

    <span class="c">### close body of page table..</span>
    <span class="i">$str</span> .= <span class="q">&quot;&lt;/TD&gt;&lt;/TR&gt;&lt;/Table&gt;&quot;</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$botbar</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="i">$botbar</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="i">alDente::Web::show_botbar</span><span class="s">(</span> -<span class="w">width</span> <span class="cm">=&gt;</span> <span class="i">$width</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">$str</span> .= <span class="q">&quot;&lt;/BODY&gt;&quot;</span><span class="sc">;</span>
    <span class="c">### close wrapper table ..</span>
    <span class="c">#    $str .= &quot;\n&lt;/TD&gt;&lt;/TR&gt;&lt;/Table&gt;\n&quot;;</span>

    <span class="k">return</span> <span class="i">$str</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">################################</span>
<span class="c"># Display topbar for LIMS</span>
<span class="c"># This should be customized for specific LIMS locales</span>
<span class="c">################################</span>
<a name="show_topbar-"></a><span class="k">sub </span><span class="m">show_topbar</span> <span class="s">{</span>
<span class="c">################################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">&amp;filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>        = <span class="i">$args</span>{-<span class="w">dbc</span>}        || <span class="i">SDB::Errors::log_deprecated_usage</span><span class="s">(</span> <span class="q">&quot;Connection&quot;</span><span class="cm">,</span> <span class="i">$Connection</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$image_path</span> = <span class="i">$args</span>{-<span class="w">image_dir</span>}  || <span class="q">&quot;$URL_dir_name/$image_dir&quot;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$about_URL</span>  = <span class="i">$args</span>{-<span class="w">about_link</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$contact_URL</span> = <span class="i">$args</span>{-<span class="w">contact_link</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$center_URL</span>  = <span class="i">$args</span>{-<span class="w">center_link</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$help_URL</span>    = <span class="i">$args</span>{-<span class="w">help_link</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$page_width</span>  = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="i">$Settings</span>{<span class="w">PAGE_WIDTH</span>} || <span class="n">800</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$include</span>     = <span class="i">$args</span>{-<span class="w">include</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$header</span>      = <span class="i">$args</span>{-<span class="w">header</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$home_URL</span>    = <span class="i">$args</span>{-<span class="w">homelink</span>} || <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="sc">;</span>

    <span class="c"># if the path does not start with a leading slash, add it in</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$image_path</span> !~ <span class="q">/^\//</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$image_path</span> = <span class="q">&quot;/$image_path&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$ind1</span><span class="cm">,</span> <span class="i">$ind2</span><span class="cm">,</span> <span class="i">$ind3</span> <span class="s">)</span> = <span class="s">(</span> <span class="q">&quot;\t&quot;</span><span class="cm">,</span> <span class="q">&quot;\t\t&quot;</span><span class="cm">,</span> <span class="q">&quot;\t\t\t&quot;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$dbase</span> ||= <span class="i">$Configs</span>{<span class="w">DATABASE</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$dbase_mode</span> = <span class="i">$dbc</span>-&gt;{<span class="w">dbase_mode</span>}<span class="sc">;</span>

    <span class="c"># LIMS-specific link</span>
    <span class="i">$about_URL</span>   ||= <span class="q">&quot;$Configs{URL_address}/sequencing.pl?Database_Mode=$dbase_mode&quot;</span><span class="sc">;</span>
    <span class="i">$contact_URL</span> ||= <span class="q">&quot;$URL_domain/$URL_dir_name/html/ContactUs.html&quot;</span><span class="sc">;</span>
    <span class="i">$center_URL</span>  ||= <span class="q">&quot;http://www.bcgsc.ca&quot;</span><span class="sc">;</span>
    <span class="i">$help_URL</span>    ||= <span class="q">&quot;$URL_domain/$URL_dir_name/cgi-bin/help.pl&quot;</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$str</span> = <span class="q">''</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$help_button</span> = <span class="q">''</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/Help/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$help_button</span>
            = <span class="i">alDente::Form::start_alDente_form</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'help'</span><span class="cm">,</span> -<span class="w">url</span> <span class="cm">=&gt;</span> <span class="i">$help_URL</span> <span class="s">)</span>
            . <span class="i">textfield</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Help'</span><span class="cm">,</span> -<span class="w">size</span> <span class="cm">=&gt;</span> <span class="n">10</span><span class="cm">,</span> -<span class="w">default</span> <span class="cm">=&gt;</span> <span class="q">'-- HELP --'</span><span class="cm">,</span> -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">&quot;this.value=''&quot;</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span> . <span class="q">' '</span>
            . <span class="i">submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'?'</span><span class="cm">,</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="q">'Search'</span> <span class="s">)</span> . <span class="q">&quot;\n&quot;</span>
            . <span class="i">end_form</span><span class="s">(</span><span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$home</span><span class="cm">,</span> <span class="i">$info</span><span class="cm">,</span> <span class="i">$site_map</span><span class="cm">,</span> <span class="i">$log</span><span class="cm">,</span> <span class="i">$contact</span> <span class="s">)</span> = <span class="s">(</span> <span class="q">''</span><span class="cm">,</span> <span class="q">''</span><span class="cm">,</span> <span class="q">''</span> . <span class="q">''</span><span class="cm">,</span> <span class="q">''</span><span class="cm">,</span> <span class="q">''</span> <span class="s">)</span><span class="sc">;</span>

    <span class="i">$home</span>     = <span class="i">Link_To</span><span class="s">(</span> <span class="i">$home_URL</span><span class="cm">,</span>                    <span class="q">&quot;&lt;B&gt;Home&lt;/B&gt;&quot;</span><span class="cm">,</span>     <span class="q">&quot;&amp;Home=Default&quot;</span><span class="cm">,</span> -<span class="w">colour</span> <span class="cm">=&gt;</span> <span class="q">'#333333'</span><span class="cm">,</span> -<span class="w">hover_colour</span> <span class="cm">=&gt;</span> <span class="q">'black'</span><span class="cm">,</span> -<span class="w">ul</span> <span class="cm">=&gt;</span> <span class="n">0</span> <span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/\bHome/i</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$info</span>     = <span class="i">Link_To</span><span class="s">(</span> <span class="q">&quot;$URL_address/sequencing.pl&quot;</span><span class="cm">,</span> <span class="q">&quot;&lt;B&gt;About&lt;/B&gt;&quot;</span><span class="cm">,</span>    <span class="q">&quot;&quot;</span><span class="cm">,</span>              -<span class="w">colour</span> <span class="cm">=&gt;</span> <span class="q">'#333333'</span><span class="cm">,</span> -<span class="w">hover_colour</span> <span class="cm">=&gt;</span> <span class="q">'black'</span><span class="cm">,</span> -<span class="w">ul</span> <span class="cm">=&gt;</span> <span class="n">0</span> <span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/\binfo/i</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$site_map</span> = <span class="i">Link_To</span><span class="s">(</span> <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>}<span class="cm">,</span>             <span class="q">&quot;&lt;B&gt;Site Map&lt;/B&gt;&quot;</span><span class="cm">,</span> <span class="q">&quot;&amp;Site Map=1&quot;</span><span class="cm">,</span>   -<span class="w">colour</span> <span class="cm">=&gt;</span> <span class="q">'#333333'</span><span class="cm">,</span> -<span class="w">hover_colour</span> <span class="cm">=&gt;</span> <span class="q">'black'</span><span class="cm">,</span> -<span class="w">ul</span> <span class="cm">=&gt;</span> <span class="n">0</span> <span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/\bSite/i</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$loginlink</span> = <span class="i">$dbc</span>-&gt;{<span class="w">homelink</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="i">$loginlink</span> =~ <span class="q">s/(.+?)\?(.*)/$1/</span><span class="sc">;</span>    <span class="c">## truncate all parameters when logging out.</span>

    <span class="i">$log</span> = <span class="i">Link_To</span><span class="s">(</span> <span class="i">$loginlink</span><span class="cm">,</span> <span class="q">&quot;&lt;B&gt;Logout&lt;/B&gt;&quot;</span><span class="cm">,</span> <span class="q">&quot;&amp;Re Log-In=1&amp;Database_Mode=$dbase_mode&quot;</span><span class="cm">,</span> -<span class="w">colour</span> <span class="cm">=&gt;</span> <span class="q">'#333333'</span><span class="cm">,</span> -<span class="w">hover_colour</span> <span class="cm">=&gt;</span> <span class="q">'black'</span><span class="cm">,</span> -<span class="w">ul</span> <span class="cm">=&gt;</span> <span class="n">0</span> <span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/\bLog/i</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">$contact</span> = <span class="i">&amp;Link_To</span><span class="s">(</span>
        <span class="q">'mailto:alDente@bcgsc.ca'</span><span class="cm">,</span>
        <span class="q">'&lt;B&gt;Contact Us&lt;/B&gt;'</span><span class="cm">,</span>
        <span class="q">''</span><span class="cm">,</span>
        -<span class="w">colour</span>       <span class="cm">=&gt;</span> <span class="q">'#333333'</span><span class="cm">,</span>
        -<span class="w">hover_colour</span> <span class="cm">=&gt;</span> <span class="q">'black'</span>
    <span class="s">)</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/\bContact/i</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@local_links</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@local_links</span><span class="cm">,</span> <span class="i">$home</span>     <span class="k">if</span> <span class="i">$home</span>     &amp;&amp; <span class="i">$include</span> =~ <span class="q">/home/i</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@local_links</span><span class="cm">,</span> <span class="i">$info</span>     <span class="k">if</span> <span class="i">$info</span>     &amp;&amp; <span class="i">$include</span> =~ <span class="q">/info/i</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@local_links</span><span class="cm">,</span> <span class="i">$site_map</span> <span class="k">if</span> <span class="i">$site_map</span> &amp;&amp; <span class="i">$include</span> =~ <span class="q">/site/i</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@local_links</span><span class="cm">,</span> <span class="i">$log</span>      <span class="k">if</span> <span class="i">$log</span>      &amp;&amp; <span class="i">$include</span> =~ <span class="q">/log/i</span><span class="sc">;</span>
    <span class="k">push</span> <span class="i">@local_links</span><span class="cm">,</span> <span class="i">$contact</span>  <span class="k">if</span> <span class="i">$contact</span>  &amp;&amp; <span class="i">$include</span> =~ <span class="q">/contact/i</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$llinks</span> = <span class="k">join</span> <span class="q">&quot; | &quot;</span><span class="cm">,</span> <span class="i">@local_links</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$header_image</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span><span class="i">$header</span><span class="s">)</span> <span class="s">{</span> <span class="i">$header_image</span> = <span class="i">$header</span> <span class="s">}</span>
    <span class="sc">;</span>    <span class="c">#  = &quot;vectorology_header.png&quot;;</span>
    <span class="k">my</span> <span class="i">$height</span>      = <span class="n">10</span><span class="sc">;</span>     <span class="c">## offset height from bottom..</span>
    <span class="k">my</span> <span class="i">$logo_height</span> = <span class="n">80</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$logo_width</span>  = <span class="n">1080</span><span class="sc">;</span>

    <span class="c">#    my $logo_height = 108;</span>
    <span class="c">#    my $logo_width = 853;</span>

    <span class="k">my</span> <span class="i">$user_label</span> = <span class="i">user_label</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">include</span> <span class="cm">=&gt;</span> <span class="i">$include</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">param</span><span class="s">(</span><span class="q">'Kill'</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>    <span class="c">#  $URL_version =~ /Dev/i ) {</span>
        <span class="i">$user_label</span> .= <span class="q">&quot; &lt;a href='/$URL_dir_name/cgi-bin/kill.pl?ID=$$'&gt; &lt;font color=red size=-3&gt; (KILL page)&lt;/font&gt;&lt;/a&gt; &quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span><span class="i">$header_image</span><span class="s">)</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="q">&quot;\n&lt;div id='header1'&gt;\n&quot;</span><span class="sc">;</span>

        <span class="c">#@        $str .= &amp;hspace(10);</span>
        <span class="i">$str</span> .= <span class="q">&quot;&lt;Table align=left width = $logo_width height=$logo_height background='$image_path/$header_image' border=0 cellspacing=0 cellpadding=0&gt;\n$ind1&lt;TR&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind2&lt;TD height=$height&gt; &lt;/TD&gt;\n&lt;/TR&gt;&lt;TR&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind2&lt;TD width=300&gt;&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind2&lt;TD width=300 align=left valign=top&gt;$user_label&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>                                                                                           <span class="c">## fill out full width...</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind2&lt;TD width=250 align=left nowrap valign=top&gt;$llinks&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>                                                                                        <span class="c">## fill out full width...</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind2&lt;TD width=200 align=left valign=top&gt;$help_button&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>                                                                                          <span class="c">## fill out full width...</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind2&lt;TD width=80&gt;&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>                                                                                                                             <span class="c">## fill out full width...</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind1&lt;/div&gt;&lt;/TR&gt;$ind1&lt;TR&gt;$ind2&lt;TD&gt;$ind2&lt;/TD&gt;\n&quot;</span><span class="sc">;</span>
        <span class="i">$str</span> .= <span class="q">&quot;$ind1&lt;/TR&gt;\n&lt;/Table&gt;&lt;/div&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span>
        <span class="i">$str</span>
            .= <span class="q">&quot;\n&lt;Table width=$page_width cellpadding=5 border=0 cellspacing=0&gt;\n$ind1&lt;TR&gt;\n$ind2&lt;TD bgcolor=#ffffff align=center&gt;\n$ind3&quot;</span>
            . <span class="q">&quot;&lt;Font color=white&gt;&lt;B&gt;$user_label&lt;/B&gt;&lt;/Font&gt;&lt;/TD&gt;\n$ind2&lt;TD bgcolor=#FFFFFF align=center&gt;\n$ind3&quot;</span>
            . <span class="q">&quot;&lt;Font color=Red size=-1&gt; Automated Laboratory Data Entry 'N Tracking Environment &lt;/Font&gt;&lt;/TD&gt;&lt;TD&gt;$llinks&lt;/TD&gt;&quot;</span>
            . <span class="q">&quot;\n$ind2&lt;/TD&gt;\n$ind1&lt;/TR&gt;\n&lt;/Table&gt;\n&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$dbc</span>-&gt;{<span class="w">host</span>} <span class="k">eq</span> <span class="i">$Configs</span>{<span class="w">BACKUP_HOST</span>} &amp;&amp; <span class="i">$dbc</span>-&gt;{<span class="w">dbase</span>} <span class="k">eq</span> <span class="i">$Configs</span>{<span class="w">BACKUP_DATABASE</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$str</span> .= <span class="i">$dbc</span><span class="i">-&gt;warning</span><span class="s">(</span> <span class="q">&quot;Connected to Replication Server with Read Only Privileges&quot;</span><span class="cm">,</span> -<span class="w">hide</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">## add hidden alternative header (which may replace full header if necessary)</span>
    <span class="k">return</span> <span class="i">$str</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">##################</span>
<a name="user_label-"></a><span class="k">sub </span><span class="m">user_label</span> <span class="s">{</span>
<span class="c">##################</span>
    <span class="k">my</span> <span class="i">%args</span>    = <span class="i">filter_input</span><span class="s">(</span> \<span class="i">@_</span><span class="cm">,</span> -<span class="w">args</span> <span class="cm">=&gt;</span> <span class="q">'dbc,include'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$dbc</span>     = <span class="i">$args</span>{-<span class="w">dbc</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$include</span> = <span class="i">$args</span>{-<span class="w">include</span>}<span class="sc">;</span>

    <span class="k">my</span> <span class="i">$user</span> = <span class="q">'?'</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$dbc</span> &amp;&amp; <span class="k">defined</span> <span class="i">$dbc</span>-&gt;{<span class="w">session</span>} <span class="s">)</span> <span class="s">{</span>
        <span class="i">$user</span> = <span class="i">$dbc</span><span class="i">-&gt;session</span>-&gt;{<span class="w">user</span>} || <span class="q">''</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="i">$user_label</span> = <span class="q">&quot;&lt;Font color=black&gt;&lt;B&gt;$user&lt;/B&gt;&quot;</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$include</span> =~ <span class="q">/\bhostinfo\b/i</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$user_label</span> .= <span class="q">&quot;&lt;B&gt;&quot;</span><span class="sc">;</span>
        <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$dbc</span><span class="i">-&gt;session</span> &amp;&amp; <span class="i">$dbc</span><span class="i">-&gt;session</span>-&gt;{<span class="w">site_name</span>} <span class="s">)</span> <span class="s">{</span> <span class="i">$user_label</span> .= <span class="q">&quot;@&quot;</span> . <span class="i">$dbc</span><span class="i">-&gt;session</span>-&gt;{<span class="w">site_name</span>} <span class="s">}</span>

        <span class="k">my</span> <span class="i">$host</span>    = <span class="i">$dbc</span>-&gt;{<span class="w">host</span>}    || <span class="q">''</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$dbase</span>   = <span class="i">$dbc</span>-&gt;{<span class="w">dbase</span>}   || <span class="q">''</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$db_user</span> = <span class="i">$dbc</span>-&gt;{<span class="w">db_user</span>} || <span class="q">''</span><span class="sc">;</span>
        <span class="i">$user_label</span> .= <span class="q">&quot;&lt;/B&gt; [$db_user\@$host:$dbase]&lt;/Font&gt;&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">return</span> <span class="i">$user_label</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">################################</span>
<span class="c"># Display bottom bar for LIMS</span>
<span class="c"># This should be customized for specific LIMS locales</span>
<span class="c">################################</span>
<a name="show_botbar-"></a><span class="k">sub </span><span class="m">show_botbar</span> <span class="s">{</span>
<span class="c">################################</span>
    <span class="k">my</span> <span class="i">%args</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$image_path</span>   = <span class="i">$args</span>{-<span class="w">image_dir</span>} || <span class="q">&quot;$URL_dir_name/$image_dir&quot;</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$center_URL</span>   = <span class="i">$args</span>{-<span class="w">center_link</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$width</span>        = <span class="i">$args</span>{-<span class="w">width</span>} || <span class="i">$Settings</span>{<span class="w">PAGE_WIDTH</span>}<span class="sc">;</span>
    <span class="k">my</span> <span class="i">$footer_image</span> = <span class="q">&quot;botbar_blue.png&quot;</span><span class="sc">;</span>

    <span class="i">$center_URL</span> ||= <span class="q">&quot;http://www.bcgsc.ca&quot;</span><span class="sc">;</span>

    <span class="c"># if the path does not start with a leading slash, add it in</span>
    <span class="k">if</span> <span class="s">(</span> <span class="i">$image_path</span> !~ <span class="q">/^\//</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$image_path</span> = <span class="q">&quot;/$image_path&quot;</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="k">my</span> <span class="s">(</span> <span class="i">$ind1</span><span class="cm">,</span> <span class="i">$ind2</span><span class="cm">,</span> <span class="i">$ind3</span> <span class="s">)</span> = <span class="s">(</span> <span class="q">&quot;\t&quot;</span><span class="cm">,</span> <span class="q">&quot;\t\t&quot;</span><span class="cm">,</span> <span class="q">&quot;\t\t\t&quot;</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$str</span> = <span class="q">''</span><span class="sc">;</span>
    <span class="i">$str</span>
        .= <span class="q">&quot;\n&lt;P/&gt;\n&lt;Table width=1100 &gt;\n$ind1&lt;TR&gt;\n$ind2&lt;TD colspan=2 align=right cellpadding=0 cellspacing=0&gt;&quot;</span>
        . <span class="q">&quot;&lt;A Href='$center_URL' border=0&gt;&quot;</span>
        . <span class="q">&quot;&lt;img src='$image_path/botbar-address.png' border=0&gt;&lt;/A&gt;\n&quot;</span>
        . <span class="q">&quot;$ind2&lt;/TD&gt;\n$ind1&lt;/TR&gt;\n$ind1&lt;TR&gt;\n$ind2&lt;TD nowrap&gt;&quot;</span>
        . <span class="q">&quot;&lt;img src='$image_path/botbar-white_to_blue.png'&gt;&quot;</span>
        . <span class="q">&quot;&lt;img src='$image_path/botbar-blue.png' border=0&gt;&quot;</span>
        . <span class="q">&quot;&lt;img src='$image_path/topbar-bcca.png' border=0&gt;&quot;</span>
        . <span class="q">&quot;\n$ind2&lt;/TD&gt;\n$ind1&lt;/TR&gt;\n&lt;/Table&gt;\n&quot;</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$str</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># Reloads given input in preparation for regenerating login page</span>
<span class="c">#  (clears information explicitly retrieved from login page)</span>
<span class="c">#</span>
<span class="c"># Return: Revised Input hash</span>
<span class="c">######################</span>
<a name="reload_input-"></a><span class="k">sub </span><span class="m">reload_input</span> <span class="s">{</span>
<span class="c">######################</span>
    <span class="k">my</span> <span class="i">$input</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@clear</span> = <span class="s">(</span> <span class="q">'Session'</span><span class="cm">,</span> <span class="q">'Method'</span><span class="cm">,</span> <span class="q">'url'</span><span class="cm">,</span> <span class="q">'Dest_URL'</span><span class="cm">,</span> <span class="q">'User List'</span><span class="cm">,</span> <span class="q">'Pwd'</span><span class="cm">,</span> <span class="q">'Log In'</span><span class="cm">,</span> <span class="q">'Database'</span><span class="cm">,</span> <span class="q">'Department'</span><span class="cm">,</span> <span class="q">'Printer_Group'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$input</span> &amp;&amp; <span class="k">ref</span> <span class="i">$input</span> <span class="k">eq</span> <span class="q">'HASH'</span> <span class="s">)</span> <span class="s">{</span>
        <span class="c">## clear login input parameters ##</span>
        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$par</span> <span class="s">(</span><span class="i">@clear</span><span class="s">)</span> <span class="s">{</span>
            <span class="k">delete</span> <span class="i">$input</span>-&gt;{<span class="i">$par</span>}<span class="sc">;</span>
        <span class="s">}</span>
    <span class="s">}</span>
    <span class="k">else</span> <span class="s">{</span> <span class="i">$input</span> = <span class="s">{</span><span class="s">}</span> <span class="s">}</span>

    <span class="k">return</span> <span class="i">$input</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c"># -&gt;alDente::Web (probably not used anywhere)</span>
<span class="c">########################</span>
<a name="login_password-"></a><span class="k">sub </span><span class="m">login_password</span> <span class="s">{</span>
<span class="c">########################</span>
    <span class="k">my</span> <span class="i">$dbc</span> = <span class="k">shift</span><span class="sc">;</span>

    <span class="k">print</span> <span class="i">h3</span><span class="s">(</span><span class="q">&quot;Login to Database:&quot;</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">alDente::Form::start_alDente_form</span><span class="s">(</span> <span class="i">$dbc</span><span class="cm">,</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'LoginPage'</span> <span class="s">)</span><span class="sc">;</span>

    <span class="c">#    print start_barcode_form('start','LoginPage');</span>
    <span class="k">print</span> <span class="i">submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Login'</span> <span class="s">)</span><span class="cm">,</span> <span class="i">br</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">popup_menu</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'User Choice'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@users</span><span class="s">]</span><span class="cm">,</span> -<span class="w">default</span> <span class="cm">=&gt;</span> <span class="q">&quot;$user&quot;</span> <span class="s">)</span><span class="cm">,</span> <span class="i">password_field</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'Password'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@users</span><span class="s">]</span><span class="cm">,</span> -<span class="w">force</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">default</span> <span class="cm">=&gt;</span> <span class="q">&quot;&quot;</span> <span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&lt;/FORM&gt;&quot;</span><span class="sc">;</span>

    <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<span class="k">return</span> <span class="n">1</span><span class="sc">;</span>

<a name="EOF-"></a></pre>
</body>
</html>
